import{u as B,G as W,r as v,O as ne,j as e,S as se,V as ie,ap as g,y as re,J as oe,aa as L,t as te,$ as a,a4 as i,ay as z,f as ce,T as d,al as Q,I as le,l as A,P as ae,n as Y,p as xe,o as Z,H as ue,cf as de,i as me,v as fe,cI as he,z as je}from"./index-4b3d7bc8.js";import{g as pe}from"./calculation-671db1b1.js";import{c as D}from"./capitalize-cfd5966b.js";import{u as ee}from"./usePermissions-36032956.js";import{A as ge}from"./ActionMenu-149e95aa.js";import{u as _e}from"./useSearchParam-ebfda256.js";import{u as ve}from"./useDetailPageProps-fa80b790.js";import{A as ye}from"./index-9f4b88aa.js";import{A as Ie}from"./AccessDenied-45b92511.js";const{VscClose:be}=le,{Text:P,Title:_}=d,{RECURRING_INVOICE:Ce}=A,Se=({detail:o,deleteItem:m,dataLength:y=0,handleFullScreen:c})=>{var x,j,T,t,p,R,N,k,O,u,V,w,$,F,G,M,U,H,q,X,J,K;const{callAxios:I}=B(),{bool:b}=W(),[f,S]=v.useState(!0),{curr_id:h}=JSON.parse(ne("obj")),[n,E]=v.useState();v.useEffect(()=>{var r;(!m||m&&y>1)&&((r=n==null?void 0:n.invoice_info)==null?void 0:r.id)!==h&&I({url:`${Ce}/${h||(o==null?void 0:o.id)}`}).then(l=>{E(l),S(!1)})},[o==null?void 0:o.id,b,m,y,h]);const s=v.useMemo(()=>[{title:"Items",dataIndex:"",width:150,ellipsis:!0,render:r=>e.jsxs(se,{children:[e.jsx(ie,{style:{width:30},onClick:l=>l.stopPropagation(),src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png",fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png"}),e.jsx(P,{children:r.item_name})]})},{title:"Qty",dataIndex:"quantity",width:30,ellipsis:!0},{title:"Price",dataIndex:"rate",width:50,ellipsis:!0,render:r=>{var l;return e.jsx(g,{value:r||0,valueStyle:{fontSize:"13px"},prefix:(l=n==null?void 0:n.base_currency)==null?void 0:l.symbol})}},{title:"Tax",dataIndex:"tax",width:30,ellipsis:!0,render:r=>{var l;return e.jsx(g,{value:(r==null?void 0:r.rate)||0,suffix:r&&`(${r.name})`,valueStyle:{fontSize:"13px"},prefix:(l=n==null?void 0:n.base_currency)==null?void 0:l.symbol})}},{title:"Amount",dataIndex:"amount",width:50,ellipsis:!0,render:r=>{var l;return e.jsx(g,{value:r||0,valueStyle:{fontSize:"13px"},prefix:(l=n==null?void 0:n.base_currency)==null?void 0:l.symbol})}}],[(x=n==null?void 0:n.base_currency)==null?void 0:x.symbol]);return e.jsx(e.Fragment,{children:f?e.jsx(re,{}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:D((j=n==null?void 0:n.invoice_info)==null?void 0:j.profile_name),subTitle:e.jsx(L,{color:((T=n==null?void 0:n.invoice_info)==null?void 0:T.status)==="draft"?"red":"green",children:D((t=n==null?void 0:n.invoice_info)==null?void 0:t.status)}),extra:[e.jsx(be,{size:20,onClick:()=>te(c)},"close")]}),e.jsxs(a,{children:[e.jsxs(i,{offset:1,children:[e.jsx(_,{level:4,style:{color:"green"},children:"INOVICE"}),e.jsx(_,{level:5,children:(R=(p=n==null?void 0:n.invoice_info)==null?void 0:p.customer)==null?void 0:R.display_name}),e.jsxs(_,{level:5,children:["Invoice No. ",(N=n==null?void 0:n.invoice_info)==null?void 0:N.invoice_no]}),e.jsx(L,{color:((k=n==null?void 0:n.invoice_info)==null?void 0:k.status)==="draft"?"red":"green",children:D((O=n==null?void 0:n.invoice_info)==null?void 0:O.status)})]}),e.jsxs(i,{offset:7,children:[e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(_,{level:5,children:"Start Date"})}),e.jsx(i,{style:{paddingLeft:"200px",marginTop:"30px"},children:e.jsx(P,{children:z((u=n==null?void 0:n.invoice_info)==null?void 0:u.start_date)})})]}),e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(_,{level:5,children:"End Date"})}),e.jsx(i,{style:{paddingLeft:"208px",marginTop:"30px"},children:e.jsx(P,{children:z((V=n==null?void 0:n.invoice_info)==null?void 0:V.end_date)})})]}),e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(_,{level:5,children:"Order No"})}),e.jsx(i,{style:{paddingLeft:"208px",marginTop:"30px"},children:e.jsx(P,{children:(w=n==null?void 0:n.invoice_info)==null?void 0:w.order_no})})]})]})]}),e.jsx(a,{style:{paddingTop:"30px"},children:e.jsx(i,{offset:1,children:e.jsx(ce,{bordered:!0,rowKey:"id",pagination:!1,columns:s,style:{marginTop:"8px"},dataSource:($=n==null?void 0:n.invoice_info)==null?void 0:$.invoice_details})})}),e.jsx(a,{style:{paddingTop:"10px"},children:e.jsx(i,{offset:16,children:e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"Sub Total"}),e.jsx(d,{children:"Adjustment"}),e.jsx(d,{children:"Shipping Charges"})]}),e.jsxs(i,{children:[e.jsx(g,{valueStyle:{fontSize:"15px"},style:{paddingLeft:"70px"},value:pe((F=n==null?void 0:n.invoice_info)==null?void 0:F.invoice_details)||0,prefix:(G=n==null?void 0:n.base_currency)==null?void 0:G.symbol}),e.jsx(g,{valueStyle:{fontSize:"15px"},style:{paddingLeft:"70px"},value:((M=n==null?void 0:n.invoice_info)==null?void 0:M.adjustment)||0,prefix:(U=n==null?void 0:n.base_currency)==null?void 0:U.symbol}),e.jsx(g,{valueStyle:{fontSize:"15px"},style:{paddingLeft:"70px"},value:((H=n==null?void 0:n.invoice_info)==null?void 0:H.shipping_charge)||0,prefix:(q=n==null?void 0:n.base_currency)==null?void 0:q.symbol})]})]})})}),e.jsx(Q,{}),e.jsxs(a,{children:[e.jsx(i,{offset:16,children:e.jsx(d,{children:"Total"})}),e.jsx(i,{offset:4,children:e.jsx(g,{valueStyle:{fontSize:"15px"},style:{paddingLeft:"24px"},value:(X=n==null?void 0:n.invoice_info)==null?void 0:X.total,prefix:(J=n==null?void 0:n.base_currency)==null?void 0:J.symbol})})]}),e.jsx(Q,{}),e.jsx(a,{children:e.jsxs(i,{offset:1,children:[e.jsx(_,{level:5,children:"Terms & Conditions"}),e.jsx(d,{children:(K=n==null?void 0:n.invoice_info)==null?void 0:K.terms_and_condition})]})})]})})},{NEW_RECURRING_INVOICE:Ee}=Y,{all_recurring_invoices:Te}=xe,{ADD_RECURRING_INVOICES:Re}=Z,Ne=({enable:o=!1})=>e.jsx(e.Fragment,{children:e.jsx(ae.SubHeader,{enabled:o,title:Te,btnText:Ee,navigateTo:Re})}),{Text:ke}=d,{RECURRING_INVOICE:Oe}=A,{NAME:C,CODE:Pe,DELETE:De,_INVOICES:Le}=Y,ze=({refetch:o,loading:m,listing:y,showDetail:c,handleClick:I,handleConfirm:b,bulkDeleteTrue:f,handleViewClick:S})=>{const{checkPermission:h}=ee(),{has_InvoiceDelete_permission:n}=h("InvoiceDelete"),E=v.useMemo(()=>[{title:"Customer Name",dataIndex:"display_name",key:C,ellipsis:!0},{title:"Profile Name",dataIndex:"profile_name",key:C,ellipsis:!0,width:c?110:120},{title:"Frequency",dataIndex:"repeat_duration",key:C,ellipsis:!0,width:c?0:120},{title:"Last Invoice Date",dataIndex:"start_date",key:C,ellipsis:!0,width:c?0:120,render:s=>z(s)},{title:"Next Invoice Date",dataIndex:"next_recurring_inv_date",key:C,ellipsis:!0,width:c?0:120},{title:"Status",dataIndex:"status",key:C,ellipsis:!0,width:c?0:110,render:s=>e.jsx(L,{autoCapitalize:"",color:s==="draft"?"red":"green",children:D(s)},s)},{title:"Amount",dataIndex:"",key:Pe,width:c?85:110,ellipsis:!0,render:s=>{var x,j;return e.jsxs(d,{children:[e.jsx(ue,{placement:"topLeft",title:(x=s==null?void 0:s.currency)==null?void 0:x.name,children:e.jsx(ke,{code:!0,children:(j=s==null?void 0:s.currency)==null?void 0:j.symbol})}),`${s.total}`]})}},{title:"",dataIndex:"",width:40,key:"x",align:"center",render:s=>e.jsx(ge,{data:s,handleClick:I,handleConfirm:b,canEdit:s.platform_type==="books",deletePermission:s.platform_type==="books"?n:!1,title:s.platform_type==="books"&&n?`${De} "${s.invoice_no}" ${Le} ?`:"Permisson Denied"})}],[I,b,n,c]);return e.jsx(e.Fragment,{children:e.jsx(de,{loading:m,refetch:o,listing:y,columns:E,url:Oe,bulkDeleteTrue:f,handleViewClick:S})})},{RECURRING_INVOICE:Ae}=A,{EDIT_RECURRING_INVOICES:Ve}=Z,Je=()=>{const o=me(),{getParams:m}=_e(""),{bool:y,handleConfirm:c}=B(),{checkPermission:I}=ee(),{bool:b,setTrue:f}=W(),{getCurrentModule:S,checkModulePermission:h}=fe(),{status:n=void 0}=S("recurring-invoices")||{},{memoizeHandleClick:E,detail:s,fullScreen:x,handleFullScreen:j}=ve(),{has_RecurringInvoicesView_permission:T}=I("RecurringInvoicesView"),{data:t,refetch:p,isLoading:R}=he(m(),{refetchOnMountOrArgChange:!0,skip:!T||h("recurring-invoices")}),N=u=>{je(u==null?void 0:u.id,!0,"invoices",null,null),o(`${Ve}?id=${u.id}`)},k=v.useCallback(N,[o]),O=v.useCallback(u=>c(u,Ae,p,f),[c,p,f]);return e.jsx(e.Fragment,{children:T?e.jsxs(e.Fragment,{children:[!n&&e.jsx(ye,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),e.jsx(Ne,{enable:!n}),e.jsxs(a,{children:[e.jsx(i,{span:x?10:24,children:(t==null?void 0:t.recurring_invoices)&&e.jsx(ze,{refetch:p,showDetail:x,handleClick:k,bulkDeleteTrue:f,loading:y||R,handleConfirm:O,handleViewClick:E,listing:(t==null?void 0:t.recurring_invoices)||[]})}),x&&e.jsx(e.Fragment,{children:e.jsx(i,{span:14,children:(t==null?void 0:t.recurring_invoices)&&e.jsx(Se,{detail:s,deleteItem:b,refetchInvoices:p,handleFullScreen:j,dataLength:t.recurring_invoices.data.length})})})]})]}):e.jsx(Ie,{})})};export{Je as default};
