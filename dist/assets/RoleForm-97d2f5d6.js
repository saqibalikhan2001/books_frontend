import{j as e,$ as j,a4 as i,al as k,C as p,T as N,i as O,F as g,r as P,a2 as B,A as L,n as c,p as _,D as $,ak as F,S as M,B as R,o as D}from"./index-4b3d7bc8.js";import{g as I}from"./usePermissions-36032956.js";import{A as U}from"./index-9f4b88aa.js";const Q=(n,s)=>{const{type:o,payload:r}=s;switch(o){case"settings":return{...n,settings:r};case"inventory":return{...n,inventory:r};case"sales":return{...n,sales:r};case"purchases":return{...n,purchases:r};case"clear":return{settings:r,inventory:r,sales:r,purchases:r};default:return n}},v=[{title:"Settings",permissions:["Preference","Currency","Warehouse","Tax","Account","PaymentMethod","PaymentMode","Role","User","Invite"]},{title:"Inventory",permissions:["Item"]},{title:"Sales",permissions:["Contact","Estimates","SalesOrder","Invoice","InvoicePaymentRecord","RecurringInvoices"]},{title:"Purchases",permissions:["Bill","PurchaseOrder","PaymentRecord","RecurringBills"]}],w=[];v.forEach(n=>{w.push(...n.permissions.map(s=>s))});const q=I(w),S=q.map(n=>({id:n,[n]:!1})),b=n=>{S.forEach(s=>n.forEach(o=>{if(s.id===o){s[o]=!0;return}}))},X=()=>{S.forEach(n=>{n[n.id]=!1})},Y=n=>{let s=[],o=[],r=[],x=[];for(let[m,h]of Object.entries(n))m==="settings"&&(s=h.filter(a=>a.includes("Preference")||a.includes("Currency")||a.includes("Warehouse")||a.includes("Tax")||a.includes("Account")||a.includes("PaymentMethod")||a.includes("PaymentMode")||a.includes("Role")||a.includes("User")||a.includes("Invite"))),m==="inventory"&&(o=h.filter(a=>a.includes("Item"))),m==="sales"&&(r=h.filter(a=>a.includes("Contact")||a.includes("Estimates")||a.includes("SalesOrder")||a.includes("Invoice")||a.includes("InvoicePaymentRecord")||a.includes("RecurringInvoices"))),m==="purchases"&&(x=h.filter(a=>a.includes("Bill")||a.includes("PaymentRecord")&&!a.includes("InvoicePaymentRecord")||a.includes("PurchaseOrder")||a.includes("RecurringBills")));return[].concat.apply([],[s,o,r,x])},{Group:V}=p,{Text:C}=N,W=({list:n,title:s,dispatch:o,itemPermissions:r})=>{const x=l=>{b(l),o({type:s.toLowerCase(),payload:l})};return e.jsxs("div",{className:"__add_role_row",children:[e.jsx(j,{children:e.jsx(i,{span:24,children:e.jsx("div",{className:"form_box pt-8 __add_role_title",children:e.jsx(C,{strong:!0,children:s})})})}),e.jsx(k,{style:{margin:0,border:0}}),e.jsx(V,{style:{width:"100%",display:"block"},onChange:x,value:r,children:e.jsx("div",{className:"form_box pl-9",children:n.map(l=>e.jsxs(j,{children:[e.jsx(i,{span:7,style:{paddingBottom:"3px",paddingTop:"5px"},children:e.jsx(C,{children:l})}),e.jsx(i,{span:9,offset:8,children:e.jsxs(j,{gutter:[30,2],align:"middle",children:[e.jsx(i,{span:6,children:e.jsx(p,{value:`${l}View`})}),e.jsx(i,{span:6,children:l!=="Preference"&&l!=="User"&&e.jsx(p,{value:`${l}Create`})}),e.jsx(i,{span:6,children:e.jsx(p,{value:`${l}Edit`})}),e.jsx(i,{span:6,children:l!=="Preference"&&e.jsx(p,{value:`${l}Delete`})})]})})]},l))})})]})},{Text:f}=N,{USERS:z}=D,G={name:"",sales_person:!1},Z=({loading:n,current:s,onSubmit:o,dispatch:r,roleAlert:x,itemPermissions:l})=>{const m=O(),[h]=g.useForm(),[a,y]=P.useState(!1);P.useEffect(()=>{const d=[];if(s&&Object.keys(s).length&&h.setFieldsValue({name:s.name,description:s.description,sales_person:(s==null?void 0:s.type)==="sales"}),s!=null&&s.name){for(const[u,t]of Object.entries(s.permissions))t&&d.push(`${u}`);r({type:"clear",payload:d})}(s==null?void 0:s.type)==="sales"&&y(!0)},[s,h]);const T=d=>{const{checked:u}=d.target;if(u){const t=v.find(A=>A.title==="Sales"),E=I(t==null?void 0:t.permissions);b(E),y((t==null?void 0:t.title)==="Sales"),r({type:t==null?void 0:t.title.toLowerCase(),payload:E})}else r({type:"sales",payload:[]}),y(!1),b([])};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"main_wrapper add_role_form",children:[e.jsx(B,{name:"Add new role"}),e.jsx("div",{className:"_container",children:e.jsxs(g,{form:h,layout:"vertical",onFinish:o,requiredMark:!1,name:"create-role-form",initialValues:G,children:[e.jsx(N.Title,{level:5,className:"form_heading",children:"Role Info"}),e.jsx("div",{className:"form_box",children:e.jsxs("div",{className:"role_form  flexbox form-row-container justify-content-between",children:[e.jsxs("div",{className:"role_field flex-47",children:[e.jsx(L,{size:"middle",name:"name",label:e.jsxs("label",{children:[`${c.ROLE} ${c.NAME}`,e.jsx("span",{className:"staric",children:"*"})]}),placeholder:_.enter_role_name,rules:$({message:_.role_name_required})}),e.jsx(g.Item,{name:"sales_person",valuePropName:"checked",wrapperCol:{span:16},style:{marginBottom:20},children:e.jsx(p,{checked:a,onChange:T,children:e.jsx("label",{children:c.IS_SALES_PERSON})})}),x&&e.jsx(U,{type:"error",closable:!0,message:e.jsx("div",{children:_.permissions_required})})]}),e.jsx("div",{className:"role_box flex-47",children:e.jsx(g.Item,{name:"description",className:"flex_root",label:e.jsx("label",{children:c.DESCRIPTION}),children:e.jsx(F.TextArea,{rows:4,showCount:!0,maxLength:255,placeholder:"Enter description"})})})]})}),e.jsx("h5",{className:"access_heading",children:" Access Rights"}),e.jsxs(j,{className:"access_table_header access-rights-container roles-bottom",children:[e.jsx(i,{span:7,offset:1,children:e.jsx(f,{strong:!0,className:"header_heading left ",children:"Module"})}),e.jsx(i,{span:9,offset:6,children:e.jsxs(j,{gutter:[10,0],children:[e.jsx(i,{span:6,children:e.jsx(f,{strong:!0,className:"header_heading",children:c.View})}),e.jsx(i,{span:6,children:e.jsx(f,{strong:!0,className:"header_heading",children:c.CREATE})}),e.jsx(i,{span:6,children:e.jsx(f,{strong:!0,className:"header_heading",children:c.EDIT})}),e.jsx(i,{span:6,children:e.jsx(f,{strong:!0,className:"header_heading",children:c.DELETE})})]})})]}),v.map(d=>{const u=d.title.toLowerCase();return e.jsx(W,{title:d.title,setSales:y,dispatch:r,list:d.permissions,is_sales_person:a,itemPermissions:l[u]},d.title)}),e.jsx("div",{className:"form_box pt-40",children:e.jsxs(M,{children:[e.jsx(R,{htmlType:"button",className:"btn_cancel",btnText:c.CANCEL,clickHandler:()=>m(`${z}?tab=2`)}),e.jsx(R,{block:!0,loading:n,className:"btn_create",btnText:s!=null&&s.name?c.UPDATE:c.CREATE})]})})]})})]})})};export{Z as R,S as a,X as b,Y as f,Q as r};
