import{u as ne,r as o,j as e,C as le,Y as pe,I as oe,_ as be,B as ie,H as je,s as te,M as Ce,S as de,T as _e,$ as ye,n as ce,X as ge}from"./index-4b3d7bc8.js";import{r as x,j as me,k as fe,b as ke,l as xe,m as ze,G as Re,o as ue,f as Se,g as he}from"./DetailPlusListingHeader-5d7935e9.js";import{D as Ne,C as Pe,P as He}from"./react-beautiful-dnd.esm-fdc0d50f.js";const{CiLock:ve}=oe;let ae;const Be=g=>{const{callAxios:m,toggle:H}=ne(),{setparam:k=()=>null}=g,{data:y,total:b,showDetail:r,colsHeader:z,pagination:$,preferences:c,tableSetting:f,setcolsheader:M,handleViewClick:v,sidebarPosition:u,detailPageColumns:T,defaultFreezTableWidth:L,colsHeaderForlockedCols:E}=g,O=o.useMemo(()=>g.columns,[c,E,r]),{handleTableFilterslockedcols:R,refetch:w,table_slug:j,actionPref:i}=g,[F,D]=o.useState(!1),[C,S]=o.useState(),N=JSON.parse(localStorage.getItem("obj")),a=JSON.parse(localStorage.getItem("params")),{rows:d,state:h,allColumns:n,prepareRow:A,headerGroups:G,getTableProps:V,selectedFlatRows:J,getTableBodyProps:Q,setColumnOrder:W}=x.useTable({columns:O,data:y||[],defaultColumn:L,manualSortBy:!0},x.useSortBy,x.useBlockLayout,x.useResizeColumns,x.useRowSelect,x.useColumnOrder,s=>{s.visibleColumns.push(t=>[{id:"selection",Header:({getToggleAllRowsSelectedProps:l})=>e.jsx("div",{children:e.jsx(le,{className:"tile_checkbox",...l()})}),Cell:({row:l})=>e.jsx("div",{onClick:p=>p.stopPropagation(),children:e.jsx(le,{...l.getToggleRowSelectedProps()})}),width:50,minWidth:50,resizable:!1,isResizing:!1,disableResizing:!0,getResizerProps:()=>{},defaultResizeableColumn:!1,locked:!0,icon:!1},...t])}),{columnResizing:{columnWidths:B,isResizingColumn:U,headerIdWidths:q},selectedRowIds:X,columnOrder:P}=h;o.useEffect(()=>{let s=document.getElementsByClassName("active_row");s[0]&&s[0].scrollIntoView({block:"nearest",inline:"nearest"})},[y]),o.useEffect(()=>{r&&W(T)},[r,T]),o.useEffect(()=>{const{setSelectedProducts:s}=g;s(J)},[X]),o.useEffect(()=>{ae=P==null?void 0:P.indexOf("action")},[P]);const Y=(s,t,l)=>{const p=[...l],I=p.splice(s,1)[0];return p.splice(t,0,I),p};o.useEffect(()=>{R(n);const s=n.map(p=>p.id),t=s.indexOf("action"),l=Y(t,i,s);W(l)},[c]);const K=o.useCallback(pe(s=>{H(),m({method:"post",url:"/table-setting",data:s}).then(t=>{t.status===403&&(t.show_popup&&D(!0),S(t))})},400),[]),Z=()=>{var _,re;const s=document.getElementById("resizeabletable"),t=Object.keys(B),l=Object.values(B),p=t.indexOf((_=q==null?void 0:q[0])==null?void 0:_[0]);let I={};if(t.length&&l.length&&p!==-1){let se;u!=null&&u.open,se=window.innerWidth-((u==null?void 0:u.width)+10),I={slug:j,freez_table_width_px:(f==null?void 0:f.freez_table_width_px)||null,unfreez_table_width_px:(s==null?void 0:s.clientWidth)||null,screen_resolution:se,preferences:{name:t[p],width:parseFloat((re=C==null?void 0:C.data)==null?void 0:re.suitable_width_px).toFixed(0),slug:t[p]}},m({method:"post",url:"/table-setting",data:I}).then(()=>{w()})}};o.useEffect(()=>{me(B,U,c,K,j,f,u)},[B]);const ee=s=>{k({...$,page:1,sort:(a==null?void 0:a.sort)==="asc"?"desc":"asc",sort_column:s})};return e.jsxs(o.Fragment,{children:[e.jsxs("table",{...V(),className:r?"hide_shadow":"",children:[e.jsx("thead",{children:G.map(s=>e.jsxs("tr",{...s.getHeaderGroupProps(),children:[!r&&s.headers.map(t=>t.locked&&t.id!=="action"&&e.jsxs("th",{...t.getHeaderProps({style:{width:t.id===P[ae-1]?t.width+30:t.width}}),className:`${a&&(a!=null&&a.sort)&&a.sort_column===t.id&&(a.sort==="asc"||a.sort==="desc")?"bg-color":""}
                    `,colSpan:`${t.id===P[ae-1]&&2}`,children:[e.jsxs("span",{...t.getSortByToggleProps(),onClick:l=>{l.stopPropagation(),t.id!=="selection"&&t.id!=="action"&&ee(t==null?void 0:t.id)},children:[e.jsx(e.Fragment,{children:t.render("Header")}),e.jsx("span",{children:a&&(a!=null&&a.sort)&&a.sort_column===t.id?(a==null?void 0:a.sort)==="asc"?e.jsx("span",{className:"arrow arrow-bar is-top"}):e.jsx("span",{className:"arrow arrow-bar is-bottom"}):""})]}),e.jsx("div",{onClick:l=>l.stopPropagation(),...t.getResizerProps({style:{userSelect:"none"}}),className:`${t.resizable===void 0?"resizer isResizing":"no-resize"}`}),t.id==="selection"||t.id==="action"?"":e.jsx("span",{style:{cursor:t.default?"not-allowed":"pointer"},onClick:()=>t.default?null:fe(t.id,c,z,M,m,w,R,E,W,j,H),children:e.jsx(ve,{size:20,className:"lock"})})]})),r&&s.headers.slice(0,3).map(t=>t.locked&&e.jsx("th",{...t.getHeaderProps(),children:e.jsxs("span",{children:[t.render("Header"),e.jsx("div",{onClick:l=>l.stopPropagation(),...t.getResizerProps({style:{userSelect:"none"}})})]})}))]}))}),e.jsx("tbody",{...Q(),children:d.map((s,t)=>{var l,p,I;return A(s),e.jsxs("tr",{...s.getRowProps(),onClick:()=>v(s==null?void 0:s.original,y),className:(s==null?void 0:s.original.id)===(N==null?void 0:N.curr_id)&&r?"active_row":""+j=="item"&&!r&&((l=s==null?void 0:s.original)==null?void 0:l.inventory_type)==="inventory"&&ke((p=s==null?void 0:s.original)==null?void 0:p.reorder_level,(I=s==null?void 0:s.original)==null?void 0:I.quantity_on_hand),style:{opacity:j!=="item"||s!=null&&s.original.is_active?1:.5},children:[!r&&s.cells.map(_=>_.column.locked===!0&&e.jsx("td",{..._.getCellProps(),className:_.column.id==="action"?"action-cell":"",children:_.render("Cell")})),r&&s.cells.slice(0,3).map(_=>_.column.locked===!0&&e.jsx("td",{..._.getCellProps(),children:_.render("Cell")}))]})})}),r&&e.jsx("tfoot",{className:"listing-count",children:e.jsx("tr",{children:e.jsx("td",{className:"w-100",children:e.jsx("div",{className:"listing-count-inner",children:j==="item"?`Total Products : ${b}`:j==="invoices"?`Total Invoices : ${b}`:`Total Estimates : ${b}`})})})})]}),e.jsx(xe,{content:C==null?void 0:C.message,isModalOpen:F,setIsModalOpen:D,handleSubmitSuitableWidth:Z})]})},{MdDragIndicator:Te}=oe,Ie=g=>{var N;const{refetch:m,columns:H,colsHeader:k,table_slug:y,preferences:b,tableSetting:r,ColumnhideRef:z,setcolsheader:$,ColumnOrderRef:c,freeze_table_width:f,column_reset_button:M}=g,{callAxios:v,toggle:u,bool:T}=ne(),[L,E]=o.useState(!1),[O,R]=o.useState([]),[w,j]=o.useState([]),[i,F]=o.useState(!1);o.useEffect(()=>{const a=g.preferences.map(h=>{if(h.show_status===!1)return h.slug}),d=a==null?void 0:a.filter(h=>!!h);R(d)},[]);const D=a=>{if(!a.destination)return;const d=Array.from(k),[h]=d.splice(a.source.index,1);d.splice(a.destination.index,0,h),$(d);const n=d.map(A=>A.id);j(n),c(n),r!=null&&r.change_auto&&ue(n,O,v,c,m,b,y,u,r)},C=a=>{E(a)},S=a=>{const d=b.filter(n=>n.slug!=="selection"&&n.slug!=="action"&&!n.locked).map(n=>({show_status:n.show_status,slug:n.slug,sort_order:n.sort_order})),h=k.map(n=>({show_status:n.isVisible,slug:n.id,sort_order:n.sort_order}));!a&&f===100&&!ge.isEqual(d,h)&&F(!0)};return e.jsxs(e.Fragment,{children:[!((N=g.selectedProducts)!=null&&N.length)&&e.jsx(be,{overlayClassName:"item_filter",placement:"bottomLeft",open:L,onVisibleChange:S,onOpenChange:C,content:e.jsx("div",{className:"product-filters",children:e.jsx(Ne,{onDragEnd:D,children:e.jsx(Pe,{droppableId:"droppable",children:a=>e.jsxs("div",{ref:a.innerRef,children:[k.map((d,h)=>e.jsx(He,{draggableId:d.id,index:h,children:n=>e.jsx("div",{className:"col_name",ref:n.innerRef,...n.draggableProps,...n.dragHandleProps,children:e.jsxs("div",{className:"__dragDrop",children:[e.jsx("div",{...n.dragHandleProps,className:"__dragDrop_iconParent",tabIndex:"-1",children:e.jsx(Te,{})}),e.jsx("div",{className:"__drag-righ",children:e.jsxs("label",{children:[e.jsx(le,{className:"custom_checkbox",...d.getToggleHiddenProps(),onChange:()=>{ze(d.id,O,R,k,$,H,z,f,r,w,v,c,m,b,y,u)},style:{cursor:d.locked?"not-allowed":"pointer"}})," ",d.Header]})})]})})},Re())),e.jsxs(e.Fragment,{children:[a.placeholder,!(r!=null&&r.change_auto)&&e.jsxs("div",{className:"button_flexbox ",children:[e.jsx(ie,{type:"default",btnText:"Reset",disabled:M||T,htmlType:"button",className:"btn-default btn-form-size mr-20",clickHandler:()=>m()}),e.jsx(ie,{btnText:"Apply",disabled:T,className:"btn-primary btn-form-size",clickHandler:()=>{E(!1),F(!0)}})]})]})]})})})}),trigger:"click",children:e.jsx(je,{placement:"bottom",title:"Show Columns",children:e.jsx(te,{className:"btn-filter",children:e.jsx("img",{src:"https://ims-development.s3.us-west-2.amazonaws.com/static/media/show-columns.png",alt:""})})})}),e.jsxs(Ce,{centered:!0,footer:null,destroyOnClose:!0,closable:!1,open:i,maskClosable:!1,width:400,className:"radius-5 default_modal",children:[e.jsx(de,{children:e.jsx(_e.Text,{children:"If you want to preview live changes, kindly press save button."})}),e.jsx(ye,{justify:"center",children:e.jsxs(de,{children:[e.jsx(te,{className:"btn-form-size btn-default",onClick:()=>F(!1),children:ce.CANCEL}),e.jsx(te,{className:"btn-form-size btn-primary",onClick:()=>{ue(w,O,v,c,m,b,y,u)},children:ce.SAVE})]})})]})]})},{CiUnlock:Ee}=oe,$e=g=>{const{callAxios:m,toggle:H}=ne(),{data:k,check:y,refetch:b,colsHeader:r,table_slug:z,pagination:$,preferences:c,tableSetting:f,setcolsheader:M,sidebarPosition:v,handleViewClick:u,setColumnHideRef:T,setColumnOrderRef:L,setSelectedProducts:E,setparam:O=()=>null,colsHeaderForlockedCols:R,defaultUnFreezTableWidth:w,handleTableFilterslockedcols:j}=g,i=JSON.parse(localStorage.getItem("params")),F=o.useMemo(()=>g.columns,[R]),[D,C]=o.useState(!1),[S,N]=o.useState(),{rows:a,state:d,prepareRow:h,allColumns:n,headerGroups:A,getTableProps:G,setColumnOrder:V,setHiddenColumns:J,selectedFlatRows:Q,getTableBodyProps:W}=x.useTable({columns:F,data:k||[],manualSortBy:!0,defaultColumn:w,initialState:{hiddenColumns:Se(c),columnOrder:he(c)}},x.useSortBy,x.useRowSelect,x.useColumnOrder,x.useBlockLayout,x.useResizeColumns);o.useEffect(()=>{L(()=>V),T(()=>J)},[]);const{columnResizing:{columnWidths:B,isResizingColumn:U},selectedRowIds:q}=d;o.useEffect(()=>{const s=Q.map(t=>t.original);E(s)},[q]),o.useEffect(()=>{V(he(c))},[c]);const X=n.map(s=>s.Header),P=r.map(s=>s.Header),Y=!!ge.isEqual(X,P);o.useEffect(()=>{Y||M(n)},[y]);const K=o.useCallback(pe(s=>{H(),m({method:"post",url:"/table-setting",data:s})},400),[]);o.useEffect(()=>{me(B,U,c,K,z,f,v)},[B]);const Z=s=>{O({...$,page:1,sort:i.sort==="asc"?"desc":"asc",sort_column:s})},ee=()=>{const{data:s}=S;let t={slug:z,freez_table_width_px:f==null?void 0:f.freez_table_width_px,preferences:s};m({method:"post",url:"/locked-columns",data:t}).then(()=>b())};return e.jsxs(o.Fragment,{children:[e.jsxs("table",{...G(),id:"resizeabletable",children:[e.jsx("thead",{children:A.map(s=>e.jsx("tr",{...s.getHeaderGroupProps(),children:s.headers.map(t=>e.jsxs("th",{...t.getHeaderProps(),className:`th ${t.isResizing?"--resizing":""} 
                ${i&&i.sort&&i.sort_column===t.id&&(i.sort==="asc"||i.sort==="desc")?"bg-color ":""}
                  ${t.Header==="Price"||t.Header==="Cost"?"right-align":""}
                ${t.Header==="Quanitity on hand"||t.Header==="Reorder level"?"justify-center":""}`,children:[e.jsxs("span",{...t.getSortByToggleProps(),onClick:l=>{l.stopPropagation(),Z(t==null?void 0:t.id)},children:[t.render("Header"),e.jsx("span",{children:i&&(i!=null&&i.sort)&&i.sort_column===t.id?(i==null?void 0:i.sort)==="asc"?e.jsx("span",{className:"arrow arrow-bar is-top"}):e.jsx("span",{className:"arrow arrow-bar is-bottom"}):""})]}),e.jsx("div",{onClick:l=>l.stopPropagation(),...t.getResizerProps({style:{userSelect:"none"}}),className:`${t.resizable===void 0?"resizer isResizing":"no-resize"}`}),t.is_lockable&&e.jsxs("span",{style:{cursor:"pointer"},onClick:()=>fe(t.id,c,r,M,m,b,j,R,V,z,H,C,N),children:[e.jsx(Ee,{size:18,style:{marginLeft:"10px"}})," "]})]}))}))}),e.jsx("tbody",{...W(),children:a.map((s,t)=>(h(s),e.jsx("tr",{...s.getRowProps(),onClick:()=>u(s==null?void 0:s.original,g.data),style:{opacity:z!=="item"||s!=null&&s.original.is_active?1:.5},children:s.cells.map(l=>l.column.locked===!1&&e.jsx("td",{...l.getCellProps(),valign:"middle",className:`${l.column.Header==="Price"||l.column.Header==="Cost"?"right-align":""}
                        ${l.column.Header==="Quanitity on hand"||l.column.Header==="Reorder level"?"justify-center":""}`,children:l.render("Cell")}))})))})]}),e.jsx(xe,{content:S==null?void 0:S.message,isModalOpen:D,setIsModalOpen:C,handleSubmitSuitableWidth:ee})]})};export{Be as F,$e as R,Ie as T};
