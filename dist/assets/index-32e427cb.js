import{i as E,u as F,r,ab as P,k as D,aD as N,j as o,l as $,h as s,p as w,am as d,aB as R,z as V}from"./index-4b3d7bc8.js";import{I as z}from"./InvoiceForm-947481b2.js";import{u as B}from"./usePermissions-36032956.js";import{A as G}from"./AccessDenied-45b92511.js";import"./AddressModal-12b3ae58.js";import"./CustomerTab-c6c321f7.js";import"./useListing-af775608.js";import"./useDelayUnmount-cb77ae7b.js";import"./index-b8658cbe.js";import"./progress-e3fed29d.js";import"./ImageUploader-b2d6894b.js";import"./Create-76ba1395.js";import"./ContactDetailModal-bc8d3392.js";import"./DetailPage-c0159ae7.js";import"./capitalize-cfd5966b.js";import"./Table-9972bb2a.js";import"./Processing-a1197381.js";import"./PaginateSelect-b668bdaf.js";import"./ItemTable-c0313657.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";import"./Create-8edeb959.js";import"./ItemForm-ceb885e2.js";import"./ImageCrop-db92a92e.js";import"./index-d9b76a87.js";import"./Create-93e4462e.js";import"./calculation-671db1b1.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";const{INVOICES:p}=$,jt=()=>{const _=E(),{callAxios:a}=F(),[g,h]=r.useState(0),[j,I]=P(),[f]=D(),b=f.get("id"),{checkPermission:x}=B(),[n,A]=r.useState([]),{has_InvoiceCreate_permission:C}=x("InvoiceCreate"),{data:S=[]}=N(""),y=r.useCallback(t=>h(t),[]),L=r.useCallback(t=>A(t),[]),O=({values:t})=>{var m,e;if(!(n!=null&&n.length))s({message:w.select_item,type:"error"});else{const T=n.filter(i=>i.id!==null).map(i=>({...i,item_obj:null,amount:0})),k={...t,total:g,items:T,discount_type:"",discount_level:"",discount_transaction_level:0,adjustment:(t==null?void 0:t.adjustment)||0,shipping_charge:(t==null?void 0:t.shipping_charge)||0,billing_address_id:(m=t==null?void 0:t.billing_address_id)==null?void 0:m.id,invoice_terms:typeof(t==null?void 0:t.invoice_terms)!="object"?S.find(i=>i.id===(t==null?void 0:t.invoice_terms))||{}:t.invoice_terms,due_date:d(t==null?void 0:t.due_date),invoice_date:d(t==null?void 0:t.invoice_date),status:(t==null?void 0:t.saveAs)==="sent"?"sent":"draft",customer_id:typeof(t==null?void 0:t.customer_id)=="object"?(e=t==null?void 0:t.customer_id)==null?void 0:e.id:t==null?void 0:t.customer_id};I(),a({method:"post",url:`${p}`,data:k}).then(i=>{var c;i&&((t==null?void 0:t.saveAs)==="email"&&R("email",!0),s({message:i.message}),V((c=i==null?void 0:i.data)==null?void 0:c.id,!0,"invoices"),_(-1))})}};return o.jsx(o.Fragment,{children:C?o.jsx(o.Fragment,{children:o.jsx(z,{item:n,loading:j,onSubmit:O,handleTotal:y,handleItemList:L,url:`${p}/${b}/clone`})}):o.jsx(G,{})})};export{jt as default};
