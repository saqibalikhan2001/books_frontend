import{j as e,M as te,n as F,r as d,u as R,l as w,am as z,h as K,ay as O,aa as M,G as X,O as J,S as ne,V as re,ap as v,cr as oe,y as ie,J as le,t as ae,al as P,aw as ce,ax as de,$ as k,a4 as f,f as me,T,I as W,P as ue,p as xe,o as Z,H as he,cf as pe,i as je,v as ye,cC as _e,z as fe}from"./index-4b3d7bc8.js";import{g as ge}from"./calculation-671db1b1.js";import{c as H}from"./capitalize-cfd5966b.js";import{I as be}from"./InvoiceForm-947481b2.js";import{A as q}from"./AccessDenied-45b92511.js";import{A as ee}from"./ActionMenu-149e95aa.js";import{T as Ce}from"./Table-9972bb2a.js";import{u as G}from"./usePermissions-36032956.js";import{u as Se}from"./useSearchParam-ebfda256.js";import{u as Ie}from"./useDetailPageProps-fa80b790.js";import{u as Ee}from"./usePersistItemDetail-b111bdde.js";import{A as ke}from"./index-9f4b88aa.js";import"./AddressModal-12b3ae58.js";import"./CustomerTab-c6c321f7.js";import"./useListing-af775608.js";import"./useDelayUnmount-cb77ae7b.js";import"./index-b8658cbe.js";import"./progress-e3fed29d.js";import"./ImageUploader-b2d6894b.js";import"./Create-76ba1395.js";import"./ContactDetailModal-bc8d3392.js";import"./DetailPage-c0159ae7.js";import"./Processing-a1197381.js";import"./PaginateSelect-b668bdaf.js";import"./ItemTable-c0313657.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";import"./Create-8edeb959.js";import"./ItemForm-ceb885e2.js";import"./ImageCrop-db92a92e.js";import"./index-d9b76a87.js";import"./Create-93e4462e.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";const se=({url:a,edit:c,loading:p,onSubmit:o,showModal:n,SOdetails:i,toggleModal:h,handleTotal:m,handleItemList:y,has_permission:l})=>e.jsx(e.Fragment,{children:e.jsx(te,{title:l?c?`${F.EDIT_INVOICE} | ${i==null?void 0:i.sales_order_no}`:`${F.CREATE_INVOICE} | ${i==null?void 0:i.sales_order_no}`:"",width:1200,footer:null,destroyOnClose:!0,onOk:h,open:n,style:{top:0},maskClosable:!1,onCancel:h,children:l?e.jsx(be,{isModal:!0,url:a,loading:p,close:h,onSubmit:o,handleTotal:m,handleItemList:y}):e.jsx(q,{})})}),{INVOICES:Q}=w,Te=({bool:a,SOdetails:c,refetchSO:p,toggleModal:o,InvoiceDetail:n,has_permission:i,refetchInvoices:h})=>{const[m,y]=d.useState(0),{callAxios:l,toggle:s,bool:t}=R(),[g,b]=d.useState([]),C=d.useCallback(r=>y(r),[]),S=d.useCallback(r=>b(r),[]),u=r=>{const I=g.map(_=>({..._,sales_order_id:c==null?void 0:c.id}));s(),l({method:"put",url:`${Q}/${n==null?void 0:n.id}/update`,data:{...r,total:m,discount_type:"",items:I,discount_transaction_level:0,due_date:z(r.due_date),invoice_date:z(r.invoice_date)}}).then(_=>{_&&(K({message:_.message}),o(),h(),p())})};return e.jsx(e.Fragment,{children:e.jsx(se,{edit:!0,showModal:a,loading:t,onSubmit:u,SOdetails:c,toggleModal:o,handleTotal:C,handleItemList:S,has_permission:i,url:`${Q}/${n==null?void 0:n.id}/edit`})})},{INVOICES:ve}=w,Ae=({url:a,bool:c,refetchSO:p,SOdetails:o,toggleModal:n,has_permission:i,refetchInvoices:h})=>{const[m,y]=d.useState(0),{callAxios:l,toggle:s,bool:t}=R(),[g,b]=d.useState([]),C=d.useCallback(r=>y(r),[]),S=d.useCallback(r=>b(r),[]),u=r=>{const I=g.map(_=>({..._,sales_order_id:o==null?void 0:o.id}));s(),l({method:"post",url:ve,data:{...r,total:m,discount_type:"",items:I,due_date:z(r.due_date),invoice_date:z(r.invoice_date)}}).then(_=>{_&&(K({message:_.message}),n(),h(),p())})};return e.jsx(e.Fragment,{children:e.jsx(se,{url:a,showModal:c,loading:t,onSubmit:u,SOdetails:o,toggleModal:n,handleTotal:C,handleItemList:S,has_permission:i})})},{NAME:V,SYMBOL:Le,DELETE:$e,_INVOICES:De}=F,we=({url:a,loading:c,fetchList:p,handleClick:o,handleCreate:n,toggleModal:i,handleConfirm:h,has_permission:m,hasViewPermission:y})=>{const l=d.useMemo(()=>[{title:"Invoice",dataIndex:"invoice_no",key:Le,width:130,ellipsis:!0},{title:"Customer Name",dataIndex:"customer_name",key:V,ellipsis:!0,width:200},{title:"Date",dataIndex:"invoice_date",key:V,width:120,ellipsis:!0,render:s=>O(s)},{title:"Due Date",dataIndex:"due_date",key:V,width:120,ellipsis:!0,render:s=>O(s)},{title:"Status",dataIndex:"status",key:V,ellipsis:!0,width:120,render:s=>e.jsx(M,{autoCapitalize:"",color:s==="draft"?"red":"green",children:H(s)},s)},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:s=>e.jsx(ee,{data:s,canEdit:!0,handleClick:o,handleConfirm:h,deletePermission:m,title:m?`${$e} "${s.invoice_no}" ${De} ?`:"Access Denied"})}],[m]);return e.jsx(e.Fragment,{children:y?e.jsx(Ce,{invoice:!0,url:a,fetchList:p,bool:c,columns:l,rowKey:"invoice_no",toggleModal:i,handleCreate:n}):e.jsx(q,{})})},{INVOICES:Fe,INVOICE_CREATE:Oe}=w,Re=({url:a,SOdetails:c,refetchSO:p,refetchInvoices:o,fetchList:n})=>{const{checkPermission:i}=G(),{bool:h,toggle:m}=X(),[y,l]=d.useState(!1),{callAxios:s,toggle:t,bool:g}=R(),[b,C]=d.useState(),{has_InvoiceView_permission:S}=i("InvoiceView"),{has_InvoiceEdit_permission:u}=i("InvoiceEdit"),{has_InvoiceCreate_permission:r}=i("InvoiceCreate"),{has_InvoiceDelete_permission:I}=i("InvoiceDelete"),_=d.useCallback(j=>l(j),[]),L=j=>{l(!1),C(j),m()},$=d.useCallback(L,[m]),D=j=>{t(),s({method:"delete",url:`${Fe}/${j.id}`}).then(E=>{E&&(K({message:E.message}),o(),p())})},x=d.useCallback(D,[]);return e.jsxs(e.Fragment,{children:[e.jsx(we,{url:a,loading:g,fetchList:n,toggleModal:m,handleClick:$,handleCreate:_,handleConfirm:x,has_permission:I,hasViewPermission:S}),h&&y&&e.jsx(Ae,{bool:h,SOdetails:c,refetchSO:p,toggleModal:m,refetchInvoices:o,has_permission:r,url:`${Oe}?sales_order_id=${c==null?void 0:c.id}`}),h&&!y&&e.jsx(Te,{bool:h,SOdetails:c,refetchSO:p,toggleModal:m,InvoiceDetail:b||{},refetchInvoices:o,has_permission:u})]})},{VscClose:Pe}=W,{Title:A,Text:N}=T,{SALES_ORDERS:Y,INVOICES:Ve,ACTIVITY:Ne}=w,ze=({detail:a,refetchSO:c,deleteItem:p,dataLength:o=0,handleFullScreen:n})=>{var r,I,_,L,$,D;const{callAxios:i}=R(),h=J("tab_key"),[m,y]=d.useState(!0),{curr_id:l}=JSON.parse(J("obj")),[s,t]=d.useState(),{bool:g,setTrue:b,setFalse:C}=X();d.useEffect(()=>{(g||(!p||p&&o>1)&&(s==null?void 0:s.id)!==l)&&i({url:`${Y}/${l||(a==null?void 0:a.id)}`}).then(x=>{t(x),y(!1),C()})},[a==null?void 0:a.id,g,l,p,o]);const S=d.useMemo(()=>[{title:"Items",dataIndex:"",width:100,ellipsis:!0,render:x=>e.jsxs(ne,{children:[e.jsx(re,{style:{width:30},onClick:j=>j.stopPropagation(),src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png",fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png"}),e.jsx(N,{children:x.item_name})]})},{title:"Warehouse",dataIndex:"warehouses",width:70,ellipsis:!0,render:x=>e.jsx(N,{children:x==null?void 0:x.name})},{title:"Qty",dataIndex:"quantity",width:30,ellipsis:!0},{title:"Price",dataIndex:"rate",width:40,ellipsis:!0,render:x=>{var j;return e.jsx(v,{value:x||0,valueStyle:{fontSize:"13px"},prefix:(j=s==null?void 0:s.base_currency)==null?void 0:j.symbol})}},{title:"Tax",dataIndex:"tax",width:50,ellipsis:!0,render:x=>{var j;return e.jsx(v,{value:(x==null?void 0:x.rate)||0,suffix:x&&`(${x.name})`,valueStyle:{fontSize:"13px"},prefix:(j=s==null?void 0:s.base_currency)==null?void 0:j.symbol})}},{title:"Amount",dataIndex:"amount",width:50,ellipsis:!0,render:x=>{var j;return e.jsx(v,{value:x||0,valueStyle:{fontSize:"13px"},prefix:(j=s==null?void 0:s.base_currency)==null?void 0:j.symbol})}}],[(r=s==null?void 0:s.base_currency)==null?void 0:r.symbol]),u=d.useMemo(()=>[{key:"1",label:"History",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(oe,{url:`${Y}/${s==null?void 0:s.id}${Ne}`})})},{key:"3",label:"Invoices",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(Re,{SOdetails:s,refetchSO:c,fetchList:g,refetchInvoices:b,url:`${Y}/${s==null?void 0:s.id}${Ve}`})})},{key:"4",label:"Attachment",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(e.Fragment,{children:"Attachment in progress"})})}],[s,b,c,g]);return e.jsx(e.Fragment,{children:m?e.jsx(ie,{}):e.jsxs(e.Fragment,{children:[e.jsx(le,{title:s==null?void 0:s.sales_order_no,subTitle:e.jsx(M,{color:(s==null?void 0:s.status)==="draft"?"red":"green",children:H(s==null?void 0:s.status)}),extra:[e.jsx(Pe,{size:20,onClick:()=>ae(n)},"close")],footer:e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(ce,{defaultActiveKey:h||"1",items:u,onChange:de})]})}),e.jsx(P,{}),e.jsxs(k,{children:[e.jsxs(f,{offset:1,children:[e.jsx(A,{level:4,style:{color:"green"},children:"SALES ORDER"}),e.jsx(A,{level:5,children:s==null?void 0:s.display_name}),e.jsxs(A,{level:5,children:["Sales Order No. ",s==null?void 0:s.sales_order_no]}),e.jsx(M,{color:(s==null?void 0:s.status)==="draft"?"red":"green",children:H(s==null?void 0:s.status)})]}),e.jsxs(f,{offset:7,children:[e.jsxs(k,{children:[e.jsx(f,{children:e.jsx(A,{level:5,style:{marginTop:0},children:"Order Date"})}),e.jsx(f,{style:{paddingLeft:"200px"},children:e.jsx(N,{children:O(s==null?void 0:s.order_date)})})]}),e.jsxs(k,{children:[e.jsx(f,{children:e.jsx(A,{level:5,style:{marginTop:0},children:"Expiry Date"})}),e.jsx(f,{style:{paddingLeft:"195px"},children:e.jsx(N,{children:O(s==null?void 0:s.expected_shipment_date)})})]})]})]}),e.jsx(k,{children:e.jsx(f,{offset:1,children:e.jsx(me,{bordered:!0,rowKey:"id",pagination:!1,columns:S,style:{marginTop:"8px"},dataSource:s==null?void 0:s.sales_order_details})})}),e.jsxs(k,{style:{paddingTop:"10px"},children:[e.jsx(f,{offset:1,children:e.jsxs(A,{level:5,children:["Total Items: ",(I=s==null?void 0:s.sales_order_details)==null?void 0:I.length]})}),e.jsx(f,{offset:16,children:e.jsxs(k,{children:[e.jsxs(f,{children:[e.jsx(T,{children:"Sub Total"}),e.jsx(T,{children:"Adjustment"}),e.jsx(T,{children:"Shipping Charges"})]}),e.jsxs(f,{children:[e.jsx(v,{style:{paddingLeft:"80px"},valueStyle:{fontSize:"15px"},prefix:(_=s==null?void 0:s.base_currency)==null?void 0:_.symbol,value:ge(s==null?void 0:s.sales_order_details)||0}),e.jsx(v,{style:{paddingLeft:"80px"},value:(s==null?void 0:s.adjustment)||0,valueStyle:{fontSize:"15px"},prefix:(L=s==null?void 0:s.base_currency)==null?void 0:L.symbol}),e.jsx(v,{style:{paddingLeft:"80px"},valueStyle:{fontSize:"15px"},value:(s==null?void 0:s.shipping_charge)||0,prefix:($=s==null?void 0:s.base_currency)==null?void 0:$.symbol})]})]})})]}),e.jsx(P,{}),e.jsxs(k,{children:[e.jsx(f,{offset:16,children:e.jsx(T,{children:"Total"})}),e.jsx(f,{offset:4,children:e.jsx(v,{value:s==null?void 0:s.total,valueStyle:{fontSize:15,paddingLeft:35},prefix:(D=s==null?void 0:s.base_currency)==null?void 0:D.symbol})})]}),e.jsx(P,{}),e.jsx(k,{children:e.jsxs(f,{offset:1,children:[e.jsx(A,{level:5,children:"Terms & Conditions"}),e.jsx(T,{children:s==null?void 0:s.terms_and_condition})]})})]})})},{NEW_SALE_ORDER:Me}=F,{all_sale_orders:He}=xe,{ADD_SALES_ORDER:Ye}=Z,{VscAdd:Be}=W,Ke=[{key:"filters",type:"group",label:"DEFAULT FILTERS",children:[{key:"1",label:"All"},{key:"2",label:"Draft"},{key:"3",label:"Pending Approval"},{key:"4",label:"Approved"},{key:"5",label:"Client Viewed"},{key:"6",label:"Accepted"},{key:"7",label:"Invoiced"},{key:"8",label:"Declined"},{key:"9",label:"Expired"}]},{type:"divider"},{key:"10",label:"New Custom View",icon:e.jsx(Be,{})}],Xe=({enable:a=!1})=>e.jsx(e.Fragment,{children:e.jsx(ue.SubHeader,{items:Ke,enabled:a,title:He,btnText:Me,navigateTo:Ye})}),{Text:qe}=T,{SALES_ORDERS:Ge}=w,{NAME:B,SYMBOL:Je,CODE:U,DELETE:Qe,_SALES_ORDERS:Ue}=F,We=({loading:a,refetch:c,listing:p,handleClick:o,showDetail:n,handleConfirm:i,bulkDeleteTrue:h,handleViewClick:m})=>{const{checkPermission:y}=G(),{has_SalesOrderDelete_permission:l}=y("SalesOrderDelete"),s=d.useMemo(()=>[{title:"Date",dataIndex:"order_date",key:B,width:80,ellipsis:!0,render:t=>O(t)},{title:"SalesOrder#",dataIndex:"sales_order_no",key:Je,width:130,ellipsis:!0},{title:"Refrence#",dataIndex:"reference",key:U,width:n?0:100,ellipsis:!0},{title:"Customer Name",dataIndex:"display_name",key:B,ellipsis:!0,width:n?0:200},{title:"Status",dataIndex:"status",key:B,ellipsis:!0,width:n?0:70,render:t=>e.jsx(M,{autoCapitalize:"",color:t==="draft"?"red":"green",children:H(t)},t)},{title:"Amount",dataIndex:"",key:U,ellipsis:!0,width:n?0:80,render:t=>{var g,b;return e.jsxs(T,{children:[e.jsx(he,{placement:"topLeft",title:(g=t==null?void 0:t.currency)==null?void 0:g.name,children:e.jsx(qe,{code:!0,children:(b=t==null?void 0:t.currency)==null?void 0:b.symbol})}),`${t.total}`]})}},{title:"",dataIndex:"",width:30,key:"x",align:"center",render:t=>e.jsx(ee,{data:t,handleClick:o,handleConfirm:i,canEdit:t.platform_type==="books",deletePermission:t.platform_type==="books"?l:!1,title:t.platform_type==="books"&&l?`${Qe} "${t.sales_order_no}" ${Ue} ?`:"Permission Denied"})}],[o,i,l,n]);return e.jsx(e.Fragment,{children:e.jsx(pe,{loading:a,refetch:c,listing:p,url:Ge,columns:s,bulkDeleteTrue:h,handleViewClick:m})})},{SALES_ORDERS:Ze}=w,{EDIT_SALES_ORDER:es}=Z,Fs=()=>{var j;const a=je(),{getParams:c}=Se(""),{bool:p,handleConfirm:o}=R(),{checkPermission:n}=G(),{checkModulePermission:i,getCurrentModule:h}=ye(),{status:m=void 0}=h("sales-order")||{},{has_SalesOrderView_permission:y}=n("SalesOrderView"),{bool:l,setTrue:s,setFalse:t}=X(),{memoizeHandleClick:g,detail:b,fullScreen:C,handleFullScreen:S}=Ie(),{data:u,refetch:r,isLoading:I,isFetching:_}=_e(c(),{refetchOnMountOrArgChange:!0,skip:!y||i("sales-order")}),{handleSessionState:L}=Ee(S,t,l);d.useEffect(()=>{!_&&l&&L(u==null?void 0:u.salesOrders,"salesorders")},[_,l,u==null?void 0:u.salesOrders]);const $=E=>{fe(E==null?void 0:E.id,!0,"salesOrder"),a(`${es}?id=${E.id}`)},D=d.useCallback($,[a]),x=d.useCallback(E=>o(E,Ze,r,s),[o,r,s]);return e.jsx(e.Fragment,{children:y?e.jsxs(e.Fragment,{children:[!m&&e.jsx(ke,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),e.jsx(Xe,{enable:!m}),e.jsxs(k,{children:[e.jsx(f,{span:C?10:24,children:(u==null?void 0:u.salesOrders)&&e.jsx(We,{refetch:r,showDetail:C,listing:u.salesOrders,handleClick:D,bulkDeleteTrue:s,loading:p||I,handleConfirm:x,handleViewClick:g})}),C&&e.jsx(e.Fragment,{children:e.jsx(f,{span:14,children:(u==null?void 0:u.salesOrders)&&e.jsx(ze,{detail:b,refetchSO:r,deleteItem:l,handleFullScreen:S,dataLength:(j=u.salesOrders.data)==null?void 0:j.length})})})]})]}):e.jsx(q,{})})};export{Fs as default};
