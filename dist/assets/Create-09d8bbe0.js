import{i as z,u as B,r as e,ab as G,aD as K,j as m,l as Q,h as x,p as U,z as I,aB as y,am as C}from"./index-4b3d7bc8.js";import{I as q}from"./InvoiceForm-947481b2.js";import{u as H}from"./usePermissions-36032956.js";import{A as J}from"./AccessDenied-45b92511.js";import"./AddressModal-12b3ae58.js";import"./CustomerTab-c6c321f7.js";import"./useListing-af775608.js";import"./useDelayUnmount-cb77ae7b.js";import"./index-b8658cbe.js";import"./progress-e3fed29d.js";import"./ImageUploader-b2d6894b.js";import"./Create-76ba1395.js";import"./ContactDetailModal-bc8d3392.js";import"./DetailPage-c0159ae7.js";import"./capitalize-cfd5966b.js";import"./Table-9972bb2a.js";import"./Processing-a1197381.js";import"./PaginateSelect-b668bdaf.js";import"./ItemTable-c0313657.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";import"./Create-8edeb959.js";import"./ItemForm-ceb885e2.js";import"./ImageCrop-db92a92e.js";import"./index-d9b76a87.js";import"./Create-93e4462e.js";import"./calculation-671db1b1.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";const{INVOICES:W,INVOICE_CREATE:X}=Q,yt=({isModal:n,estimateDetails:i,url:E,toggleModal:g})=>{const _=z(),{callAxios:S}=B(),[a,L]=e.useState(0),[T,f]=G(),{checkPermission:O}=H(),[r,F]=e.useState([]),{has_InvoiceCreate_permission:N}=O("InvoiceCreate"),{data:k=[]}=K(""),P=e.useCallback(t=>L(t),[]),R=e.useCallback(t=>F(t),[]),V=(t,d)=>{var p,c;return{...t,total:a,items:d,discount_type:"",discount_level:"",discount_transaction_level:0,adjustment:(t==null?void 0:t.adjustment)||0,shipping_charge:(t==null?void 0:t.shipping_charge)||0,billing_address_id:(p=t==null?void 0:t.billing_address_id)==null?void 0:p.id,invoice_terms:typeof(t==null?void 0:t.invoice_terms)!="object"?k.find(s=>s.id===(t==null?void 0:t.invoice_terms))||{}:t.invoice_terms,due_date:C(t==null?void 0:t.due_date),invoice_date:C(t==null?void 0:t.invoice_date),status:(t==null?void 0:t.saveAs)==="sent"?"sent":"draft",customer_id:typeof(t==null?void 0:t.customer_id)=="object"?(c=t==null?void 0:t.customer_id)==null?void 0:c.id:t==null?void 0:t.customer_id}},w=({values:t})=>{if(!(r!=null&&r.length))x({message:U.select_item,type:"error"});else{const d=r.filter(o=>o.id!==null),h=d.map(o=>({...o,item_obj:null,amount:0})),p=d.map(o=>({...o,item_obj:null,amount:0,estimate_item_detail_id:o==null?void 0:o.id})),c=V(t,h),s=n&&i?{...c,items:p,estimate_id:i==null?void 0:i.id}:c;f(),S({method:"post",url:W,data:s}).then(o=>{var j,b,A;f(),o&&(x({message:o.message}),(t==null?void 0:t.saveAs)==="email"&&!n?(I((j=o==null?void 0:o.data)==null?void 0:j.id,!0,"invoices"),y("email",!0),_(-1)):(t==null?void 0:t.saveAs)!=="email"&&!n?(I((b=o==null?void 0:o.data)==null?void 0:b.id,!0,"invoices"),_(-1)):(t==null?void 0:t.saveAs)==="email"&&n&&i?(I((A=o==null?void 0:o.data)==null?void 0:A.id,!0,"invoices"),y("email",!0),_("/invoices")):(t==null?void 0:t.saveAs)!=="email"&&n&&i&&g())})}};return m.jsx(m.Fragment,{children:N?m.jsx(m.Fragment,{children:m.jsx(q,{create:!0,item:r,isModal:n,loading:T,onSubmit:w,toggleModal:g,handleTotal:P,handleItemList:R,url:i?E:X})}):m.jsx(J,{})})};export{yt as default};
