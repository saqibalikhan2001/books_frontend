import{e as Ce,F as w,r as b,ai as Ie,j as e,y as Le,$ as f,a4 as i,A as M,aj as ke,D as ye,ak as Ae,al as H,S as Se,B as fe,M as $e,u as z,am as ve,h as Te,l as v,ay as N,T as p,H as Y,n as G,G as X,O as be,V as Be,ap as A,cr as Ee,J as Fe,aa as q,t as we,aw as Me,ax as Re,f as Ne,I as ze,cf as Oe,P as Ve,p as He,o as Pe,i as Ye,v as qe,cB as Ke,z as Ge}from"./index-4b3d7bc8.js";import{g as Xe}from"./calculation-671db1b1.js";import{c as K}from"./capitalize-cfd5966b.js";import{A as Je}from"./index-d9b76a87.js";import{A as J}from"./AccessDenied-45b92511.js";import{A as De}from"./ActionMenu-149e95aa.js";import{T as Qe}from"./Table-9972bb2a.js";import{u as Q}from"./usePermissions-36032956.js";import{u as We}from"./useSearchParam-ebfda256.js";import{u as Ue}from"./useDetailPageProps-fa80b790.js";import{u as Ze}from"./usePersistItemDetail-b111bdde.js";import{A as en}from"./index-9f4b88aa.js";const nn=Ce(new Date),sn={note:"",reference:"",payment_made:null,payment_mode:null,payment_date:nn},tn=({url:r,onSubmit:a,toggleModal:m,loading:o})=>{var t;const[x]=w.useForm(),[c,h]=b.useState(!0),{details:l,paymentModes:y}=Ie(r);return b.useEffect(()=>{var n;l!=null&&l.payment_details&&Object.keys(l==null?void 0:l.payment_details).length&&(x.setFieldsValue({...l==null?void 0:l.payment_details,payment_mode:(n=l.payment_methods[0])==null?void 0:n.value}),h(!1))},[l==null?void 0:l.payment_details]),c?e.jsx(Le,{}):e.jsxs(w,{name:"payement-received-form",autoComplete:"off",form:x,layout:"vertical",onFinish:a,initialValues:sn,children:[e.jsxs(f,{children:[e.jsxs(i,{offset:1,children:[e.jsx(M,{size:"middle",name:"total",disabled:!0,label:"Amount",className:"mb flex_root"}),e.jsx(ke,{isRequired:!0,disableDate:!0,name:"payment_date",label:"Payment Date"})]}),e.jsxs(i,{offset:1,children:[e.jsx(M,{size:"middle",name:"balance_due",disabled:!0,label:"Payment Due",className:"mb flex_root"}),e.jsx(w.Item,{name:"payment_mode",label:"Payment Mode",rules:ye({message:"Payment Mode is Required!"}),className:"flex_root",children:e.jsx(Je,{options:y,placeholder:"Select Payment Mode"})})]}),e.jsxs(i,{offset:1,children:[e.jsx(M,{size:"middle",type:"number",name:"payment_made",label:"Payment Received",className:"mb flex_root",max:(t=l==null?void 0:l.payment_details)==null?void 0:t.balance_due,rules:ye({message:"Payment Received Required"})}),e.jsx(M,{name:"reference",size:"middle",label:"Reference"})]})]}),e.jsx(f,{children:e.jsx(i,{span:12,offset:1,children:e.jsx(w.Item,{label:"Customer Notes",name:"note",className:"flex_root",children:e.jsx(Ae.TextArea,{rows:3})})})}),e.jsx(H,{}),e.jsxs(Se,{className:"steps-action",children:[e.jsx(fe,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:m}),e.jsx(fe,{block:!0,btnText:"Create",style:{width:"120px"},loading:o})]})]})},ln=({onSubmit:r,url:a,loading:m,toggleModal:o,showModal:x,has_permission:c})=>e.jsx(e.Fragment,{children:e.jsx($e,{width:1e3,footer:null,destroyOnClose:!0,onOk:o,open:x,style:{top:0},maskClosable:!1,onCancel:o,title:c&&"New Received Payment",children:c?e.jsx(tn,{url:a,loading:m,onSubmit:r,toggleModal:o}):e.jsx(J,{})})}),{BILLS:an,PAYMENT_RECORDS:rn}=v,on=({url:r,bill_id:a,showModal:m,toggleModal:o,refetchBills:x,has_permission:c,refetchBillPayments:h})=>{const{callAxios:l,bool:y,toggle:t}=z(),n=s=>{t(),l({method:"post",data:{...s,balance_due:s.balance_due,payment_date:ve(s.payment_date)},url:`${an}/${a}${rn}`}).then(u=>{u&&(Te({message:u.message}),o(),x(),h())})};return e.jsx(e.Fragment,{children:e.jsx(ln,{url:r,loading:y,onSubmit:n,showModal:m,toggleModal:o,has_permission:c})})},{Text:cn}=p,{NAME:O,SYMBOL:dn,DELETE:mn}=G,xn=({url:r,loading:a,fetchList:m,showButton:o,toggleModal:x,handleConfirm:c,has_permission:h,hasViewPermission:l})=>{const y=b.useMemo(()=>[{title:"Date",dataIndex:"payment_date",key:O,width:120,ellipsis:!0,render:t=>N(t)},{title:"Payment No",dataIndex:"payment_no",key:dn,width:130,ellipsis:!0},{title:"Payment Mode",dataIndex:"payment_mode",key:O,ellipsis:!0,width:200},{title:"Amount",dataIndex:"",key:O,width:120,ellipsis:!0,render:t=>{var n,s;return e.jsxs(p,{children:[e.jsx(Y,{placement:"topLeft",title:(n=t==null?void 0:t.currency)==null?void 0:n.name,children:e.jsx(cn,{code:!0,children:(s=t==null?void 0:t.currency)==null?void 0:s.symbol})}),`${t.payment_made}`]})}},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:t=>e.jsx(De,{data:t,handleConfirm:c,canEdit:!1,deletePermission:h,title:h?`${mn} "${t.payment_no}" Payments ?`:"Access Denied"})}],[]);return e.jsx(e.Fragment,{children:l?e.jsx(Qe,{url:r,bool:a,rowKey:"payment_no",fetchList:m,columns:y,showButton:o,toggleModal:x}):e.jsx(J,{})})},{BILLS:un,PAYMENT_RECORDS:_e}=v,hn=({url:r,detail:a,refetchBills:m,refetchBillPayments:o,fetchList:x})=>{var d,L,C;const{checkPermission:c}=Q(),{bool:h,toggle:l}=X(),{callAxios:y,bool:t,toggle:n}=z(),{has_PaymentRecordView_permission:s}=c("PaymentRecordView"),{has_PaymentRecordCreate_permission:u}=c("PaymentRecordCreate"),{has_PaymentRecordDelete_permission:_}=c("PaymentRecordDelete"),D=({id:I})=>{n(),y({method:"delete",url:`${_e}/${I}`}).then(k=>{k&&(Te({message:k.message}),o(),m())})},$=b.useCallback(D,[]);return e.jsxs(e.Fragment,{children:[e.jsx(xn,{url:r,loading:t,fetchList:x,toggleModal:l,handleConfirm:$,showButton:((d=a==null?void 0:a.bill_info)==null?void 0:d.status)!=="paid",has_permission:_,hasViewPermission:s}),h&&e.jsx(on,{showModal:h,toggleModal:l,refetchBills:m,bill_id:(L=a==null?void 0:a.bill_info)==null?void 0:L.id,refetchBillPayments:o,has_permission:u,url:`${un}/${(C=a==null?void 0:a.bill_info)==null?void 0:C.id}${_e}/create`})]})},{VscClose:jn}=ze,{Title:T,Text:P}=p,{BILLS:V,PAYMENT_RECORDS:yn,ACTIVITY_LOG:fn}=v,bn=({detail:r,deleteItem:a,refetchBills:m,dataLength:o=0,handleFullScreen:x})=>{var L,C,I,k,B,E,F,S,W,U,Z,ee,ne,se,te,le,ie,ae,re,oe,ce,de,me,xe,ue,he,je;const{callAxios:c}=z(),h=be("tab_key"),[l,y]=b.useState(!0),{curr_id:t}=JSON.parse(be("obj")),[n,s]=b.useState(),{bool:u,setTrue:_,setFalse:D}=X();b.useEffect(()=>{var j;(u||(!a||a&&o>1)&&((j=n==null?void 0:n.bill_info)==null?void 0:j.id)!==t)&&c({url:`${V}/${t||(r==null?void 0:r.id)}`}).then(g=>{s(g),y(!1),D()})},[r==null?void 0:r.id,u,a,o,t]);const $=b.useMemo(()=>[{title:"Items",dataIndex:"",width:130,ellipsis:!0,render:j=>e.jsxs(Se,{children:[e.jsx(Be,{style:{width:30},onClick:g=>g.stopPropagation(),src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png",fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png"}),e.jsx(P,{children:j.item_name})]})},{title:"Warehouse",dataIndex:"warehouses",width:80,ellipsis:!0,render:j=>e.jsx(P,{children:j==null?void 0:j.name})},{title:"Qty",dataIndex:"quantity",width:30,ellipsis:!0},{title:"Price",dataIndex:"rate",width:50,ellipsis:!0,render:j=>{var g;return e.jsx(A,{value:j||0,valueStyle:{fontSize:"13px"},prefix:(g=n==null?void 0:n.base_currency)==null?void 0:g.symbol})}},{title:"Amount",dataIndex:"amount",width:50,ellipsis:!0,render:j=>{var g;return e.jsx(A,{value:j||0,valueStyle:{fontSize:"13px"},prefix:(g=n==null?void 0:n.base_currency)==null?void 0:g.symbol})}}],[(L=n==null?void 0:n.base_currency)==null?void 0:L.symbol]),d=b.useMemo(()=>{var j,g;return[{key:"1",label:"History",children:e.jsx(e.Fragment,{children:n&&Object.keys(n).length>0&&e.jsx(Ee,{url:`${V}/${(j=n==null?void 0:n.bill_info)==null?void 0:j.id}${fn}`})})},{key:"2",label:"Payments",children:e.jsx(e.Fragment,{children:n&&Object.keys(n).length>0&&e.jsx(hn,{detail:n,fetchList:u,refetchBills:m,refetchBillPayments:_,url:`${V}/${(g=n==null?void 0:n.bill_info)==null?void 0:g.id}${yn}`})})}]},[n,u,m,_]);return e.jsx(e.Fragment,{children:l?e.jsx(Le,{}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{title:(C=n==null?void 0:n.bill_info)==null?void 0:C.bill_no,subTitle:e.jsx(q,{color:((I=n==null?void 0:n.bill_info)==null?void 0:I.status)==="draft"?"red":"green",children:K((k=n==null?void 0:n.bill_info)==null?void 0:k.status)}),extra:[e.jsx(jn,{size:20,onClick:()=>we(x)},"close")],footer:e.jsx(e.Fragment,{children:e.jsx(Me,{defaultActiveKey:h||"1",items:d,onChange:Re})})}),e.jsx(H,{}),e.jsxs(f,{children:[e.jsxs(i,{offset:1,children:[e.jsx(T,{level:4,style:{color:"green"},children:"BILL DETAILS"}),e.jsx(T,{level:5,children:(E=(B=n==null?void 0:n.bill_info)==null?void 0:B.vendor)==null?void 0:E.display_name}),e.jsxs(T,{level:5,children:["Bill No. ",(F=n==null?void 0:n.bill_info)==null?void 0:F.bill_no]}),e.jsx(q,{color:((S=n==null?void 0:n.bill_info)==null?void 0:S.status)==="draft"?"red":"green",children:K((W=n==null?void 0:n.bill_info)==null?void 0:W.status)})]}),e.jsxs(i,{offset:9,children:[e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Order No"})}),e.jsx(i,{style:{paddingLeft:"195px"},children:e.jsx(P,{children:(U=n==null?void 0:n.bill_info)==null?void 0:U.order_no})})]}),e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Bill Date"})}),e.jsx(i,{style:{paddingLeft:"200px"},children:e.jsx(P,{children:N((Z=n==null?void 0:n.bill_info)==null?void 0:Z.bill_date)})})]}),e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Due Date"})}),e.jsx(i,{style:{paddingLeft:"195px"},children:e.jsx(P,{children:N((ee=n==null?void 0:n.bill_info)==null?void 0:ee.due_date)})})]}),e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Created By"})}),e.jsx(i,{style:{paddingLeft:"185px"},children:e.jsx(P,{children:(se=(ne=n==null?void 0:n.bill_info)==null?void 0:ne.bill_created_by)==null?void 0:se.name})})]}),e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Total"})}),e.jsx(i,{style:{paddingLeft:"230px"},children:e.jsx(P,{children:(te=n==null?void 0:n.bill_info)==null?void 0:te.total})})]}),e.jsxs(f,{children:[e.jsx(i,{children:e.jsx(T,{level:5,style:{marginTop:0},children:"Balance Due"})}),e.jsx(i,{style:{paddingLeft:"175px"},children:e.jsx(P,{children:(le=n==null?void 0:n.bill_info)==null?void 0:le.balance_due})})]})]})]}),e.jsx(f,{children:e.jsx(i,{offset:1,children:e.jsx(Ne,{bordered:!0,rowKey:"id",pagination:!1,columns:$,style:{marginTop:"8px"},dataSource:(ie=n==null?void 0:n.bill_info)==null?void 0:ie.bill_item_details})})}),e.jsx(f,{style:{paddingTop:"10px"},children:e.jsx(i,{offset:16,children:e.jsxs(f,{children:[e.jsxs(i,{children:[e.jsx(p,{children:"Sub Total"}),e.jsx(p,{children:"Adjustment"}),e.jsx(p,{children:"Total"}),e.jsx(p,{children:"Payment Made"})]}),e.jsxs(i,{children:[e.jsx(A,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},prefix:(ae=n==null?void 0:n.base_currency)==null?void 0:ae.symbol,value:Xe((re=n==null?void 0:n.bill_info)==null?void 0:re.bill_item_details)||0}),e.jsx(A,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},prefix:(oe=n==null?void 0:n.base_currency)==null?void 0:oe.symbol,value:((ce=n==null?void 0:n.bill_info)==null?void 0:ce.adjustment)||0}),e.jsx(A,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},value:((de=n==null?void 0:n.bill_info)==null?void 0:de.total)||0,prefix:(me=n==null?void 0:n.base_currency)==null?void 0:me.symbol}),e.jsx(A,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},value:((xe=n==null?void 0:n.bill_info)==null?void 0:xe.total)||0,prefix:(ue=n==null?void 0:n.base_currency)==null?void 0:ue.symbol})]})]})})}),e.jsx(H,{}),e.jsxs(f,{children:[e.jsx(i,{offset:16,children:e.jsx(p,{children:"Balance Due"})}),e.jsx(i,{offset:3,children:e.jsx(A,{value:(he=n==null?void 0:n.bill_info)==null?void 0:he.balance_due,prefix:(je=n==null?void 0:n.base_currency)==null?void 0:je.symbol,valueStyle:{fontSize:15,paddingLeft:21}})})]})]})})},{Text:ge}=p,{BILLS:_n}=v,{NAME:R,CODE:pe,DELETE:gn,BILLS:pn}=G,Ln=({refetch:r,loading:a,listing:m,showDetail:o,handleClick:x,handleConfirm:c,bulkDeleteTrue:h,handleViewClick:l})=>{const{checkPermission:y}=Q(),{has_BillDelete_permission:t}=y("BillDelete"),n=b.useMemo(()=>[{title:"Due Date",dataIndex:"due_date",key:R,width:120,ellipsis:!0,render:s=>N(s)},{title:"Bill #",dataIndex:"bill_no",key:R,width:120,ellipsis:!0},{title:"Vendor",dataIndex:"display_name",key:R,ellipsis:!0},{title:"Status",dataIndex:"status",key:R,ellipsis:!0,width:o?0:110,render:s=>e.jsx(q,{autoCapitalize:"",color:s==="draft"?"red":"green",children:K(s)},s)},{title:"Amount",dataIndex:"",key:pe,width:o?0:150,ellipsis:!0,render:s=>{var u,_;return e.jsxs(p,{children:[e.jsx(Y,{placement:"topLeft",title:(u=s==null?void 0:s.currency)==null?void 0:u.name,children:e.jsx(ge,{code:!0,children:(_=s==null?void 0:s.currency)==null?void 0:_.symbol})}),`${s.total}`]})}},{title:"Balance Due",dataIndex:"",key:pe,width:o?0:150,ellipsis:!0,render:s=>{var u,_;return e.jsxs(p,{children:[e.jsx(Y,{placement:"topLeft",title:(u=s==null?void 0:s.currency)==null?void 0:u.name,children:e.jsx(ge,{code:!0,children:(_=s==null?void 0:s.currency)==null?void 0:_.symbol})}),`${s.balance_due}`]})}},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:s=>e.jsx(De,{data:s,handleClick:x,handleConfirm:c,canEdit:s.platform_type==="books",deletePermission:s.platform_type==="books"?t:!1,title:s.platform_type==="books"&&t?`${gn} "${s.bill_no}" ${pn} ?`:"Permission Denied"})}],[x,c,t,o]);return e.jsx(e.Fragment,{children:e.jsx(Oe,{url:_n,refetch:r,loading:a,listing:m,columns:n,bulkDeleteTrue:h,handleViewClick:l})})},{NEW_BILL:Sn}=G,{all_bills:Tn}=He,{ADD_BILLS:Pn}=Pe,Dn=({enable:r=!1})=>e.jsx(e.Fragment,{children:e.jsx(Ve.SubHeader,{enabled:r,title:Tn,btnText:Sn,navigateTo:Pn})}),{BILLS:Cn}=v,{EDIT_BILLS:In}=Pe,On=()=>{const r=Ye(),{bool:a,handleConfirm:m}=z(),{checkPermission:o}=Q(),{getParams:x}=We(""),{getCurrentModule:c,checkModulePermission:h}=qe(),{status:l=void 0}=c("bills")||{},{has_BillView_permission:y}=o("BillView"),{bool:t,setTrue:n,setFalse:s}=X(),{memoizeHandleClick:u,detail:_,fullScreen:D,handleFullScreen:$}=Ue(),{data:d,refetch:L,isLoading:C,isFetching:I}=Ke(x(),{refetchOnMountOrArgChange:!0,skip:!y||h("bills")}),{handleSessionState:k}=Ze($,s,t);b.useEffect(()=>{!I&&t&&k(d==null?void 0:d.bills,"bills")},[I,t,d==null?void 0:d.bills]);const B=S=>{Ge(S==null?void 0:S.id,!0,"bills"),r(`${In}?id=${S.id}`)},E=b.useCallback(B,[r]),F=b.useCallback(S=>m(S,Cn,L,n),[m,L,n]);return e.jsx(e.Fragment,{children:y?e.jsxs(e.Fragment,{children:[!l&&e.jsx(en,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),e.jsx(Dn,{enable:!l}),e.jsxs(f,{children:[e.jsx(i,{span:D?10:24,children:(d==null?void 0:d.bills)&&e.jsx(Ln,{refetch:L,listing:d.bills,showDetail:D,handleClick:E,bulkDeleteTrue:n,loading:a||C,handleConfirm:F,handleViewClick:u})}),D&&e.jsx(e.Fragment,{children:e.jsx(i,{span:14,children:(d==null?void 0:d.bills)&&e.jsx(bn,{detail:_,refetchBills:L,deleteItem:t,handleFullScreen:$,dataLength:d.bills.data.length})})})]})]}):e.jsx(J,{})})};export{On as default};
