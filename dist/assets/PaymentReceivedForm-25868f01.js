import{r as c,ay as te,j as s,S as O,ak as $,s as ne,f as le,n as k,e as z,F as p,i as oe,G as ie,u as me,ai as de,$ as x,a4 as o,D as I,bU as ce,C as pe,A as B,aA as xe,T as g,ap as b,al as re,B as V,o as ye,p as ue,l as fe}from"./index-4b3d7bc8.js";import{j as R}from"./calculation-671db1b1.js";import{P as he}from"./PaginateSelect-b668bdaf.js";import{A as je}from"./index-d9b76a87.js";const{NAME:_e,SYMBOL:ve,CODE:T}=k,ge=({loading:C,listing:A=[],handlePayInFull:h,handlePayment:j})=>{const r=c.useMemo(()=>[{title:"Date",dataIndex:"invoice_date",key:_e,ellipsis:!0,render:i=>i&&te(i),width:120},{title:"Invoice#",dataIndex:"invoice_no",key:ve,ellipsis:!0,width:100},{title:"Amount",dataIndex:"total",key:T,ellipsis:!0,width:100},{title:"Amount Due",dataIndex:"payment_due",key:T,ellipsis:!0,width:100},{title:"Payment",dataIndex:"payment",key:T,ellipsis:!0,width:100,render:(i,m,d)=>m&&s.jsxs(O,{className:"flex_root",children:[s.jsx($,{name:"payment",type:"number",placeholder:"$0.00",onChange:y=>j(y,d),value:i}),s.jsx(ne,{type:"link",onClick:y=>h(y,m,d),children:"Pay in Full"})]})}],[j,h]);return s.jsx(s.Fragment,{children:s.jsx(le,{size:"small",style:{marginLeft:"50px",marginRight:"340px",paddingBottom:"0px"},rowKey:"invoice_no",loading:C,pagination:!1,dataSource:A,columns:r})})},{TextArea:be}=$,{PAYMENTS_RECEIVED:Ce}=ye,{customer_notes:Ae}=ue,{ESTIMATE_CONTACT:Ee,PAYMENT_RECEIVED_CREATE:De}=fe,Re=z(new Date),Te={note:"",reference:"",payment:null,payment_no:null,customer_id:null,payment_mode:null,payment_date:Re},we=({url:C,loading:A,onSubmit:h,UsedAmount:j,handlePaymentId:r,handleUsedAmount:i,handleInvoiceList:m})=>{var S,w,M,P,Y;const[d]=p.useForm(),y=oe(),[N,E]=c.useState(0),[u,L]=c.useState(!1),{bool:q,setTrue:G,setFalse:D}=ie(!0),[_,H]=c.useState(0),{callAxios:K,bool:X,toggle:J}=me(),[v,f]=c.useState([]),{paymentModes:Q,details:e,details:{payment_no:F}}=de(C);c.useEffect(()=>{d.setFieldsValue({payment_no:F})},[F]),c.useEffect(()=>{var t,l,n;e!=null&&e.advance_payment&&Object.keys(e==null?void 0:e.advance_payment).length&&(d.setFieldsValue({...e==null?void 0:e.advance_payment,payment_date:z((t=e==null?void 0:e.advance_payment)==null?void 0:t.payment_date,"YYYY-MM-DD")}),f(e==null?void 0:e.invoices),m(e==null?void 0:e.invoices),r==null||r((l=e==null?void 0:e.advance_payment)==null?void 0:l.id),E((n=e==null?void 0:e.advance_payment)==null?void 0:n.payment),i(R(e==null?void 0:e.invoices)),D())},[e==null?void 0:e.advance_payment,d]);const W=t=>{J(),K({url:`${De}?customer_id=${t}`}).then(l=>{var a;H(l.received_full_amount.toFixed(2));const n=(a=l.invoices)==null?void 0:a.map(ae=>({...ae,payment:null}));f(n),m(n)}),D()},Z=(t,l)=>{const n=Number(t.target.value),a=[...v];a[l]={...a[l],[t.target.name]:n},f(a),m(a),i(R(a))},U=(t,{payment_due:l},n)=>{const a=[...v];a[n]={...a[n],payment:l},f(a),m(a),i(R(a))},ee=t=>{const l=[...v];L(t.target.checked),d.setFieldsValue({payment:u?0:_}),E(u?0:_),i(u?0:_);const n=l.map(a=>({...a,payment:a.payment_due}));f(n),m(n)},se=t=>{t&&E(Number(t))};return s.jsx(s.Fragment,{children:s.jsxs(p,{form:d,name:"item-form",layout:"vertical",autoComplete:"off",onFinish:h,initialValues:Te,children:[s.jsx(x,{children:s.jsx(o,{span:7,offset:1,children:s.jsx(he,{paymentReceived:!0,setTrue:G,name:"customer_id",setFalse:D,label:"Customer Name",url:Ee,handleChange:W,placeholder:"Select or Search Customer"})})}),s.jsxs("div",{className:q?"hide":"display",children:[s.jsxs(x,{children:[s.jsxs(o,{span:4,offset:1,children:[s.jsx(p.Item,{colon:!1,name:"payment",className:"flex_root",label:"Amount Received",rules:I({message:"Amount Received is Required!"}),children:s.jsx(ce,{min:1,value:N,disabled:u,onChange:se,addonAfter:(S=e==null?void 0:e.base_currency)==null?void 0:S.symbol,formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})}),s.jsxs(pe,{onChange:ee,checked:u,children:["Received Full Amount ",_||null]}),s.jsx(B,{name:"payment_no",size:"middle",label:"Payment #",rules:[],disabled:!0,colon:!1})]}),s.jsx(o,{span:4,offset:1,children:s.jsx(B,{name:"reference",size:"middle",label:"Reference#"})})]}),s.jsxs(x,{children:[s.jsx(o,{span:4,offset:1,children:s.jsx(p.Item,{name:"payment_date",label:"Payment Date",className:"flex_root",children:s.jsx(xe,{name:"payment_date",format:"YYYY-MM-DD",size:"middle"})})}),s.jsx(o,{span:4,offset:1,children:s.jsx(p.Item,{name:"payment_mode",label:"Payment Mode",className:"flex_root",rules:I({message:"Payment Mode is Required!"}),children:s.jsx(je,{options:Q,placeholder:"Select Payment Mode"})})})]}),s.jsx(ge,{loading:X,listing:v,handlePayInFull:U,handlePayment:Z}),s.jsxs(x,{children:[s.jsx(o,{span:8,offset:1,children:s.jsx(p.Item,{label:"Customer Notes",name:"note",className:"flex_root",children:s.jsx(be,{rows:2,placeholder:Ae})})}),s.jsx(o,{span:8,offset:4,children:s.jsxs(x,{children:[s.jsxs(o,{children:[s.jsx(g,{style:{paddingTop:"14px"},children:"Amount Received :"}),s.jsx(g,{style:{paddingTop:"14px"},children:"Amount used for Payments :"}),s.jsx(g,{style:{paddingTop:"14px"},children:"Amount Refunded :"}),s.jsx(g,{style:{paddingTop:"14px"},children:"Amount in Excess :"})]}),s.jsxs(o,{offset:3,children:[s.jsx(b,{value:N,prefix:(w=e==null?void 0:e.base_currency)==null?void 0:w.symbol}),s.jsx(b,{value:j,prefix:(M=e==null?void 0:e.base_currency)==null?void 0:M.symbol}),s.jsx(b,{value:0,prefix:(P=e==null?void 0:e.base_currency)==null?void 0:P.symbol}),s.jsx(b,{value:0,prefix:(Y=e==null?void 0:e.base_currency)==null?void 0:Y.symbol})]})]})})]}),s.jsx(re,{}),s.jsx(x,{children:s.jsx(o,{offset:1,children:s.jsxs(O,{style:{paddingLeft:"10px"},children:[s.jsx(V,{btnText:e!=null&&e.advance_payment&&Object.keys(e==null?void 0:e.advance_payment).length?k.UPDATE:k.CREATE,style:{width:"120px"},loading:A,block:!0}),s.jsx(V,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:()=>y(Ce)})]})})})]})]})})};export{we as P};
