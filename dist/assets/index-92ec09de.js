import{j as e,M as ae,n as F,u as v,r as i,l as A,am as H,h as U,U as te,an as re,aa as P,T as $,H as O,G as K,O as G,S as le,V as ce,ap as w,cr as de,y as ue,J as me,a0 as he,a1 as xe,t as je,aw as pe,ax as _e,al as J,$ as I,a4 as f,ay as Q,f as ge,I as ye,P as fe,p as be,o as ne,cf as Se,i as Ce,v as ke,ct as Ee,z as Te}from"./index-4b3d7bc8.js";import{B as Le}from"./BillForm-53909519.js";import{A as X}from"./AccessDenied-45b92511.js";import{c as Y}from"./capitalize-cfd5966b.js";import{A as oe}from"./ActionMenu-149e95aa.js";import{T as $e}from"./Table-9972bb2a.js";import{u as q}from"./usePermissions-36032956.js";import{g as Ie}from"./calculation-671db1b1.js";import{u as De}from"./useSearchParam-ebfda256.js";import{u as Ae}from"./useDetailPageProps-fa80b790.js";import{u as we}from"./usePersistItemDetail-b111bdde.js";import{A as Re}from"./index-9f4b88aa.js";import"./PaginateSelect-b668bdaf.js";import"./ItemTable-c0313657.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";import"./Create-8edeb959.js";import"./ItemForm-ceb885e2.js";import"./ImageCrop-db92a92e.js";import"./ImageUploader-b2d6894b.js";import"./progress-e3fed29d.js";import"./index-d9b76a87.js";import"./index-b8658cbe.js";import"./Create-93e4462e.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";import"./Processing-a1197381.js";const ie=({url:d,edit:r,create:m,loading:a,onSubmit:o,showModal:p,POdetail:l,toggleModal:h,handleTotal:_,handleItemList:x,has_permission:s})=>e.jsx(e.Fragment,{children:e.jsx(ae,{title:s?r?`${F.EDIT_BILL} | ${l==null?void 0:l.purchase_order_no}`:`${F.CREATE_BILL} | ${l==null?void 0:l.purchase_order_no}`:"",width:1400,footer:null,destroyOnClose:!0,onOk:h,open:p,style:{top:0},maskClosable:!1,onCancel:h,children:s?e.jsx(Le,{isModal:!0,url:d,create:m,loading:a,close:h,onSubmit:o,POdetails:l,handleTotal:_,handleItemList:x}):e.jsx(X,{})})}),{BILLS:W}=A,Fe=({bool:d,refetchPO:r,POdetail:m,toggleModal:a,BillDetail:o,refetchBills:p,has_permission:l})=>{const{callAxios:h,toggle:_,bool:x}=v(),[s,b]=i.useState(0),[t,j]=i.useState([]),y=i.useCallback(c=>b(c),[]),k=i.useCallback(c=>j(c),[]),u=c=>{const L=t.map(g=>{var S,C;return{...g,purchase_order_item_detail_id:(C=(S=m==null?void 0:m.purchase_order_item_details)==null?void 0:S.find(E=>E.item_id===g.item_id))==null?void 0:C.id}});_(),h({method:"put",url:`${W}/${o==null?void 0:o.id}`,data:{...c,total:s,items:L,discount_transaction_level:0,due_date:H(c.due_date),bill_date:H(c.bill_date)}}).then(g=>{g&&(U({message:g.message}),a(),p(),r())})};return e.jsx(e.Fragment,{children:e.jsx(ie,{edit:!0,showModal:d,loading:x,POdetail:m,onSubmit:u,toggleModal:a,handleTotal:y,handleItemList:k,has_permission:l,url:`${W}/${o==null?void 0:o.id}/edit`})})},{BILLS:ve}=A,Me=({url:d,bool:r,POdetail:m,refetchPO:a,toggleModal:o,refetchBills:p,has_permission:l})=>{const[h,_]=i.useState(0),{callAxios:x,toggle:s,bool:b}=v(),[t,j]=i.useState([]),y=i.useCallback(c=>{_(c)},[]),k=i.useCallback(c=>{j(c)},[]),u=c=>{const L=t.map(g=>{var S,C;return{...g,purchase_order_item_detail_id:(C=(S=m==null?void 0:m.purchase_order_item_details)==null?void 0:S.find(E=>E.item_id===g.item_id))==null?void 0:C.id}});s(),x({method:"post",url:ve,data:{...c,total:h,items:L,bill_date:H(c.bill_date),due_date:H(c.due_date)}}).then(g=>{g&&(U({message:g.message}),o(),p(),a())})};return e.jsx(e.Fragment,{children:e.jsx(ie,{create:!0,url:d,showModal:r,loading:b,POdetail:m,onSubmit:u,toggleModal:o,handleTotal:y,handleItemList:k,has_permission:l})})},{Text:Z}=$,{NAME:M,CODE:ee,DELETE:Be,BILLS:ze}=F,He=({url:d,loading:r,fetchList:m,showButton:a,handleClick:o,toggleModal:p,handleCreate:l,handleConfirm:h,has_permission:_,hasViewPermission:x})=>{const{org_date_format:s}=te(),b=i.useMemo(()=>[{title:"Bill NO.",dataIndex:"bill_no",key:M,width:100,ellipsis:!0},{title:"Due Date",dataIndex:"due_date",key:M,width:105,ellipsis:!0,render:t=>re(t,s)},{title:"Vendor",dataIndex:"display_name",key:M,width:100,ellipsis:!0},{title:"Status",dataIndex:"status",key:M,ellipsis:!0,width:80,render:t=>e.jsx(P,{autoCapitalize:"",children:Y(t)},t)},{title:"Amount",dataIndex:"",key:ee,width:85,ellipsis:!0,render:t=>{var j;return e.jsxs($,{children:[e.jsx(O,{placement:"topLeft",title:"Currency Symbol",children:e.jsx(Z,{code:!0,children:(j=t==null?void 0:t.currency)==null?void 0:j.symbol})}),`${t.total}`]})}},{title:"Balance Due",dataIndex:"",key:ee,width:115,ellipsis:!0,render:t=>{var j;return e.jsxs($,{children:[e.jsx(O,{placement:"topLeft",title:"Currency Symbol",children:e.jsx(Z,{code:!0,children:(j=t==null?void 0:t.currency)==null?void 0:j.symbol})}),`${t.balance_due}`]})}},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:t=>e.jsx(oe,{data:t,handleClick:o,handleConfirm:h,canEdit:!0,deletePermission:!!_,title:_?`${Be} "${t.bill_no}" ${ze} ?`:"Access Denied"})}],[_]);return e.jsx(e.Fragment,{children:x?e.jsx($e,{url:d,bool:r,rowKey:"bill_no",columns:b,fetchList:m,toggleModal:p,showButton:a,handleCreate:l}):e.jsx(X,{})})},{BILLS:V}=A,Ue=({url:d,POdetail:r,fetchList:m,refetchBills:a,refetchPO:o})=>{const{checkPermission:p}=q(),{bool:l,toggle:h}=K(),[_,x]=i.useState(!1),{callAxios:s,toggle:b,bool:t}=v(),[j,y]=i.useState(),{has_BillView_permission:k}=p("BillView"),{has_BillEdit_permission:u}=p("BillEdit"),{has_BillCreate_permission:c}=p("BillCreate"),{has_BillDelete_permission:L}=p("BillDelete"),g=i.useCallback(n=>x(n),[]),S=n=>{x(!1),y(n),h()},C=i.useCallback(S,[h]),E=n=>{b(),s({method:"delete",url:`${V}/${n.id}`}).then(T=>{T&&(U({message:T.message}),a(),o())})},D=i.useCallback(E,[a,o]);return e.jsxs(e.Fragment,{children:[e.jsx(He,{loading:t,url:`${d}${V}`,fetchList:m,toggleModal:h,handleClick:C,handleCreate:g,handleConfirm:D,has_permission:L,hasViewPermission:k,showButton:(r==null?void 0:r.status)==="issued"&&(r==null?void 0:r.bill_status)!=="billed"}),l&&_&&e.jsx(Me,{bool:l,POdetail:r,refetchPO:o,toggleModal:h,refetchBills:a,has_permission:c,url:`${V}/create?purchase_order_id=${r==null?void 0:r.id}`}),l&&!_&&e.jsx(Fe,{bool:l,POdetail:r,BillDetail:j,refetchPO:o,toggleModal:h,refetchBills:a,has_permission:u})]})},{VscClose:Ve}=ye,{Title:R,Text:B}=$,{PURCHASE_ORDERS:z,ACTIVITY:Ne,STATUS:Oe,ISSUED:Pe}=A,Ke=({detail:d,refetchPO:r,handleFullScreen:m,deleteItem:a,dataLength:o=0})=>{var g,S,C,E,D;const{callAxios:p}=v(),l=G("tab_key"),[h,_]=i.useState(!0),{curr_id:x}=JSON.parse(G("obj")),[s,b]=i.useState(),{bool:t,setTrue:j,setFalse:y}=K();i.useLayoutEffect(()=>{(t||(!a||a&&o>1)&&(s==null?void 0:s.id)!==x)&&p({url:`${z}/${(d==null?void 0:d.id)||x}`}).then(n=>{b(n),_(!1),y()})},[d==null?void 0:d.id,t,x,a,o]);const k=i.useMemo(()=>[{title:"Items",dataIndex:"",width:130,ellipsis:!0,render:n=>e.jsxs(le,{children:[e.jsx(ce,{style:{width:30},onClick:T=>T.stopPropagation(),src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png",fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png"}),e.jsx(B,{children:n.item_name})]})},{title:"Account",dataIndex:"account",width:60,ellipsis:!0,render:n=>e.jsx(B,{children:n==null?void 0:n.title})},{title:"Qty",dataIndex:"quantity",width:30,ellipsis:!0},{title:"Price",dataIndex:"rate",width:40,ellipsis:!0,render:n=>{var T;return e.jsx(w,{value:n||0,valueStyle:{fontSize:"13px"},prefix:(T=s==null?void 0:s.currency)==null?void 0:T.symbol})}},{title:"Amount",dataIndex:"amount",width:50,ellipsis:!0,render:n=>{var T;return e.jsx(w,{value:n||0,valueStyle:{fontSize:"13px"},prefix:(T=s==null?void 0:s.currency)==null?void 0:T.symbol})}}],[(g=s==null?void 0:s.currency)==null?void 0:g.symbol]),u=i.useCallback(()=>p({url:`${z}/${s==null?void 0:s.id}${Oe}${Pe}`,method:"put",data:s}).then(n=>{n&&(U({message:n.message}),r(),j())}),[s,r,j]),c=i.useMemo(()=>[{key:"0",onClick:u,label:"Mark as Issued",disabled:(s==null?void 0:s.status)==="issued"}],[s==null?void 0:s.status,u]),L=i.useMemo(()=>[{key:"1",label:"History",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(de,{url:`${z}/${s==null?void 0:s.id}${Ne}`})})},{key:"3",label:"Bills",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(Ue,{POdetail:s,refetchPO:r,fetchList:t,refetchBills:j,url:`${z}/${s==null?void 0:s.id}`})})}],[s,t,j,r]);return e.jsx(e.Fragment,{children:h?e.jsx(ue,{}):e.jsxs(e.Fragment,{children:[e.jsx(me,{title:s==null?void 0:s.purchase_order_no,tags:e.jsx(he,{menu:{items:c},trigger:["click"],children:e.jsx(xe,{})}),extra:[e.jsx(Ve,{size:20,onClick:()=>je(m)},"close")],footer:e.jsx(e.Fragment,{children:e.jsx(pe,{items:L,onChange:_e,defaultActiveKey:l||"0"})})}),e.jsx(J,{}),e.jsxs(I,{children:[e.jsxs(f,{offset:1,children:[e.jsx(R,{level:4,style:{color:"green"},children:"PURCHASE ORDER"}),e.jsx(R,{level:5,children:(S=s==null?void 0:s.vendor)==null?void 0:S.display_name}),e.jsxs(R,{level:5,children:["Purchase Order No. ",s==null?void 0:s.purchase_order_no]}),e.jsx(P,{color:(s==null?void 0:s.status)==="draft"?"red":"green",children:Y(s==null?void 0:s.status)})]}),e.jsxs(f,{offset:7,children:[e.jsxs(I,{children:[e.jsx(f,{children:e.jsx(R,{level:5,style:{marginTop:0},children:"Order Date"})}),e.jsx(f,{style:{paddingLeft:"190px"},children:e.jsx(B,{children:Q(s==null?void 0:s.order_date)})})]}),e.jsxs(I,{children:[e.jsx(f,{children:e.jsx(R,{level:5,style:{marginTop:0},children:"Delivery Date"})}),e.jsx(f,{style:{paddingLeft:"170px"},children:e.jsx(B,{children:Q(s==null?void 0:s.expected_delivery_date)})})]})]})]}),e.jsx(I,{style:{paddingTop:"20px"},children:e.jsx(f,{offset:1,children:e.jsx(ge,{bordered:!0,rowKey:"id",pagination:!1,columns:k,style:{marginTop:"8px"},dataSource:s==null?void 0:s.purchase_order_item_details})})}),e.jsx(I,{style:{paddingTop:"10px"},children:e.jsx(f,{offset:16,children:e.jsxs(I,{children:[e.jsxs(f,{children:[e.jsx($,{children:"Sub Total"}),e.jsx($,{children:"Adjustment"})]}),e.jsxs(f,{children:[e.jsx(w,{style:{paddingLeft:"105px"},valueStyle:{fontSize:"15px"},prefix:(C=s==null?void 0:s.currency)==null?void 0:C.symbol,value:Ie(s==null?void 0:s.purchase_order_item_details)||0}),e.jsx(w,{style:{paddingLeft:"105px"},value:(s==null?void 0:s.adjustment)||0,valueStyle:{fontSize:"15px"},prefix:(E=s==null?void 0:s.currency)==null?void 0:E.symbol})]})]})})}),e.jsx(J,{}),e.jsxs(I,{children:[e.jsx(f,{offset:16,children:e.jsx($,{children:"Total"})}),e.jsx(f,{offset:4,children:e.jsx(w,{value:s==null?void 0:s.total,prefix:(D=s==null?void 0:s.currency)==null?void 0:D.symbol,valueStyle:{fontSize:"15px",paddingLeft:30}})})]})]})})},{NEW_PURCHASE_ORDER:Xe}=F,{all_purchase_orders:Ye}=be,{ADD_PURCHASE_ORDER:qe}=ne,Ge=({enable:d=!1})=>e.jsx(e.Fragment,{children:e.jsx(fe.SubHeader,{enabled:d,title:Ye,btnText:Xe,navigateTo:qe})}),{PURCHASE_ORDERS:Je}=A,{Text:Qe}=$,{NAME:N,SYMBOL:We,CODE:se,DELETE:Ze,_PURCHSE_ORDERS:es}=F,ss=({loading:d,listing:r,refetch:m,showDetail:a,handleClick:o,handleConfirm:p,bulkDeleteTrue:l,handleViewClick:h})=>{const{checkPermission:_}=q(),{org_date_format:x}=te(),{has_PurchaseOrderDelete_permission:s}=_("PurchaseOrderDelete"),b=i.useMemo(()=>[{title:"Date",dataIndex:"order_date",key:N,width:120,ellipsis:!0,render:t=>re(t,x)},{title:"Purchase Order#",dataIndex:"purchase_order_no",key:We,width:150,ellipsis:!0},{title:"Refrence#",dataIndex:"reference",key:se,width:a?0:120,ellipsis:!0},{title:"Vendor",dataIndex:"display_name",key:N,ellipsis:!0},{title:"Status",dataIndex:"status",key:N,ellipsis:!0,width:a?0:120,render:t=>e.jsx(P,{autoCapitalize:"",color:t==="draft"?"red":"green",children:Y(t)},t)},{title:"Amount",dataIndex:"",key:se,width:a?0:150,ellipsis:!0,render:t=>{var j,y;return e.jsxs($,{children:[e.jsx(O,{placement:"topLeft",title:(j=t==null?void 0:t.currency)==null?void 0:j.name,children:e.jsx(Qe,{code:!0,children:(y=t==null?void 0:t.currency)==null?void 0:y.symbol})}),`${t.total}`]})}},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:t=>e.jsx(oe,{data:t,handleClick:o,handleConfirm:p,canEdit:t.platform_type==="books",deletePermission:t.platform_type==="books"?s:!1,title:t.platform_type==="books"&&s?`${Ze} "${t.invoice_no}" ${es} ?`:"Permisson Denied"})}],[o,p,s,a]);return e.jsx(e.Fragment,{children:e.jsx(Se,{refetch:m,loading:d,listing:r,url:Je,columns:b,bulkDeleteTrue:l,handleViewClick:h})})},{PURCHASE_ORDERS:ts}=A,{EDIT_PURCHASE_ORDER:rs}=ne,Ds=()=>{const d=Ce(),{bool:r,handleConfirm:m}=v(),{checkPermission:a}=q(),{getParams:o}=De(""),{getCurrentModule:p,checkModulePermission:l}=ke(),{status:h=void 0}=p("purchase-order")||{},{has_PurchaseOrderView_permission:_}=a("PurchaseOrderView"),{bool:x,setTrue:s,setFalse:b}=K(),{memoizeHandleClick:t,detail:j,fullScreen:y,handleFullScreen:k}=Ae(),{data:u,refetch:c,isLoading:L,isFetching:g}=Ee(o(),{refetchOnMountOrArgChange:!0,skip:!_||l("purchase-order")}),{handleSessionState:S}=we(k,b,x);i.useEffect(()=>{!g&&x&&S(u==null?void 0:u.purchaseOrders,"purchaserders")},[g,x,u==null?void 0:u.purchaseOrders]);const C=n=>{Te(n==null?void 0:n.id,!0,"purchaseorders"),d(`${rs}?id=${n.id}`)},E=i.useCallback(C,[d]),D=i.useCallback(n=>m(n,ts,c,s),[m,c,s]);return e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:_?e.jsxs(e.Fragment,{children:[!h&&e.jsx(Re,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),e.jsx(Ge,{enable:!h}),e.jsxs(I,{children:[e.jsx(f,{span:y?10:24,children:(u==null?void 0:u.purchaseOrders)&&e.jsx(ss,{refetch:c,showDetail:y,handleClick:E,bulkDeleteTrue:s,loading:r||L,listing:u.purchaseOrders,handleConfirm:D,handleViewClick:t})}),y&&e.jsx(e.Fragment,{children:e.jsx(f,{span:14,children:(u==null?void 0:u.purchaseOrders)&&e.jsx(Ke,{detail:j,refetchPO:c,deleteItem:x,handleFullScreen:k,dataLength:u.purchaseOrders.data.length})})})]})]}):e.jsx(X,{})})})};export{Ds as default};
