import{ab as P,u as R,ai as V,j as e,l as k,h as w,r as p,T as f,H as ae,f as v,S as G,n as h,F as D,M as oe,A as ne,D as ie,p as le,B as N,G as S,ce as de,J as ce,s as X,I as me,aw as xe}from"./index-4b3d7bc8.js";import{T as ge,C as Te}from"./Create-93e4462e.js";import{u as K}from"./useSearchParam-ebfda256.js";import{A as re}from"./ActionMenu-149e95aa.js";import{A as W}from"./AccessDenied-45b92511.js";import{u as he}from"./usePermissions-36032956.js";import{u as ue}from"./useTabs-bacf39f5.js";const{TAXES:O,EDIT:je}=k,_e=({bool:n,toggle:o,current:a,refetch:i,setCurrent:t,has_permission:d})=>{const[l]=P(),{callAxios:m}=R(),{details:g}=V(`${O}/${a==null?void 0:a.id}${je}`),T=x=>{o(),m({method:"put",data:x,url:`${O}/${a==null?void 0:a.id}`}).then(u=>{o(),u&&(o(),i==null||i(),w({message:u.message}))})};return e.jsx(e.Fragment,{children:e.jsx(ge,{bool:n,toggle:o,loading:l,current:g,onSubmit:T,setCurrent:t,has_permission:d})})},{Text:be}=f,{NAME:L,RATE:z,DELETE:pe,TAX:Ee,AUTHORITY:U}=h,Ae=({total:n,loading:o,handleClick:a,listing:i=[],handleConfirm:t,has_permission:d})=>{const{onChange:l,getParams:m}=K("tab"),{page:g,pageSize:T}=m(),x=p.useMemo(()=>[{key:L,title:L,width:350,dataIndex:"name"},{key:U,title:U,width:280,dataIndex:"authority"},{title:z,key:z,dataIndex:"",render:s=>{var c;return e.jsxs(f,{children:[s&&(s!=null&&s.rate)?s==null?void 0:s.rate:((c=s==null?void 0:s.tax_group_details)==null?void 0:c.reduce((_,j)=>{var b;return _+((b=j.tax_details)==null?void 0:b.rate)},0))||0,e.jsx(ae,{placement:"topLeft",title:"Tax Rate",children:e.jsx(be,{code:!0,children:"%"})})]})}},{key:"x",width:50,dataIndex:"",title:"",align:"center",render:s=>e.jsx(re,{data:s,handleClick:a,handleConfirm:t,canEdit:s.platform_type==="books",deletePermission:s.platform_type==="books"?d:!1,title:d&&s.platform_type==="books"?`${pe} "${s.name}" ${Ee} ?`:" Permission Denied"})}],[a,t,d]),u={onChange:(s,c)=>{console.log(`selectedRowKeys: ${s}`,"selectedRows: ",c)},getCheckboxProps:s=>({disabled:s.name==="Disabled User",name:s.name})};return e.jsx(e.Fragment,{children:e.jsx(v,{bordered:!0,loading:o,onChange:l,dataSource:i,columns:x,rowSelection:{type:"checkbox",...u,columnWidth:30},pagination:{total:n,current:g,pageSize:T,size:"small",showTotal:()=>e.jsx(G,{children:e.jsx(f.Title,{level:5,code:!0,children:`Total:  ${n}`})}),showLessItems:!0,position:["topRight"],showSizeChanger:!0,pageSizeOptions:["10","20","30","50"]},rowKey:s=>s.name})})},Ce=[{title:"Name",dataIndex:"name",key:"Name"},{title:"Rate",dataIndex:"rate",key:"Rate"}],$e=({data:n,setSelected:o,currSelected:a,setCurrSelected:i})=>{const d={selectedRowKeys:a,onChange:l=>{o(l),i(l)},onSelect:(l,m,g)=>{console.log({dt:l,current:m,selectedRows:g})}};return e.jsx(e.Fragment,{children:e.jsx(v,{pagination:!1,showHeader:!1,columns:Ce,dataSource:n,rowSelection:d,rowKey:l=>l.id})})},ye={name:""},J=({bool:n,toggle:o,loading:a,listing:i,current:t,onSubmit:d,setSelected:l,currSelected:m,has_permission:g,setCurrSelected:T})=>{const[x]=D.useForm();let u=i==null?void 0:i.filter(c=>!c.tax_group_details);p.useEffect(()=>{var c,_;t&&Object.keys(t).length&&(x.setFieldsValue({...t}),T((c=t==null?void 0:t.tax_group_details)==null?void 0:c.map(j=>j.tax_id)),l((_=t==null?void 0:t.tax_group_details)==null?void 0:_.map(j=>j.tax_id)))},[t,x]);const s=()=>{x.resetFields(),n&&o(),T([])};return e.jsx(oe,{title:`${t!=null&&t.name?h.UPDATE:h.ENTER} ${h.TAX}`,open:n,footer:null,destroyOnClose:!0,onCancel:o,style:{top:0},maskClosable:!1,afterClose:s,children:g?e.jsxs(D,{name:`${h.ENTER}-${h.TAX}`,initialValues:ye,form:x,layout:"vertical",onFinish:d,children:[e.jsx(ne,{name:"name",size:"middle",label:h.NAME,rules:ie({message:le.enter_name}),placeholder:`${h.ENTER} ${h.NAME}`}),e.jsx($e,{data:u,setSelected:l,currSelected:m,setCurrSelected:T}),e.jsxs(G,{className:"steps-action",children:[e.jsx(N,{type:"default",htmlType:"button",btnText:h.CANCEL,clickHandler:s}),e.jsx(N,{loading:a,style:{width:"120px"},btnText:t!=null&&t.name?h.UPDATE:h.CREATE})]})]}):e.jsx(W,{})})},{TAX_GROUP:M,EDIT:Se}=k,fe=({bool:n,toggle:o,current:a,refetch:i,listing:t,setCurrent:d,currSelected:l,has_permission:m,setCurrSelected:g})=>{const{callAxios:T}=R(),[x,,u,s]=P(),[c,_]=p.useState([]),{details:j}=V(`${M}/${a==null?void 0:a.id}${Se}`),b=E=>{const y={...E,_ids:c};u(),T({method:"put",data:y,url:`${M}/${a==null?void 0:a.id}`}).then($=>{s(),$&&(o(),i==null||i(),w({message:$.message}))})};return e.jsx(e.Fragment,{children:e.jsx(J,{bool:n,toggle:o,listing:t,loading:x,current:j,onSubmit:b,setCurrent:d,setSelected:_,currSelected:l,has_permission:m,setCurrSelected:g})})},{TAX_GROUP:Re}=k,ke=({bool:n,toggle:o,refetch:a,listing:i,setCurrent:t,currSelected:d,has_permission:l,setCurrSelected:m})=>{const{callAxios:g}=R(),[T,,x,u]=P(),[s,c]=p.useState([]),_=j=>{const b={...j,_ids:s};x(),g({method:"post",data:b,url:Re}).then(E=>{u(),E&&(c([]),o(),a==null||a(),w({message:E.message,type:"success"}))})};return e.jsx(J,{bool:n,toggle:o,listing:i,loading:T,onSubmit:_,setCurrent:t,setSelected:c,currSelected:d,has_permission:l,setCurrSelected:m})},{Title:we}=f,{TAXES:Fe,TAX_GROUP:Pe}=k,{HiReceiptTax:Ge,VscAdd:B}=me,{NEW_TAX:H,GROUP:Ie,TAX_RATE:De}=h,Ne=()=>{const{checkPermission:n}=he(),{callAxios:o,bool:a,toggle:i}=R(),[t,d]=p.useState({}),{bool:l,toggle:m}=S(),{total:g,getParams:T,setTotal:x}=K(""),{bool:u,toggle:s}=S(),{bool:c,toggle:_}=S(),{bool:j,toggle:b}=S(),[E,y]=p.useState([]),{has_TaxView_permission:$}=n("TaxView"),{has_TaxEdit_permission:Q}=n("TaxEdit"),{has_TaxCreate_permission:F}=n("TaxCreate"),{has_TaxDelete_permission:Y}=n("TaxDelete"),{data:r={},refetch:A,isLoading:q}=de(T(),{refetchOnMountOrArgChange:!0,skip:!$});p.useEffect(()=>{x(r==null?void 0:r.total)},[r.total]);const Z=C=>{d(C),C.tax_group_details?b():m()},ee=C=>{s(),o({method:"delete",url:C.tax_group_details?`${Pe}/${C.id}`:`${Fe}/${C.id}`}).then(I=>{I&&(A(),s(),i(),w({message:I.message}))})},se=p.useCallback(Z,[m,b]),te=p.useCallback(ee,[o,A,s,i]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:e.jsxs(G,{children:[e.jsx(Ge,{size:25}),e.jsx(we,{level:3,children:De})]}),extra:[e.jsx(X,{icon:e.jsx(B,{size:14}),className:"pr-color add_btn",onClick:i,children:H},"1"),e.jsx(X,{icon:e.jsx(B,{size:14}),className:"pr-color add_btn",onClick:_,children:`${H} ${Ie}`},"2")],style:{borderBottom:"1px solid gray",paddingBottom:"0"}}),$?e.jsx(Ae,{total:g,listing:(r==null?void 0:r.data)||[],handleClick:se,handleConfirm:te,loading:q||u,has_permission:Y}):e.jsx(W,{}),e.jsx(Te,{bool:a,toggle:i,current:t,refetch:A,has_permission:F}),e.jsx(ke,{refetch:A,bool:c,toggle:_,listing:(r==null?void 0:r.data)||[],setCurrent:d,currSelected:E,setCurrSelected:y,has_permission:F}),l&&e.jsx(_e,{bool:l,current:t,refetch:A,toggle:m,setCurrent:d,has_permission:Q}),j&&e.jsx(fe,{bool:j,refetch:A,current:t,setCurrent:d,toggle:b,listing:(r==null?void 0:r.data)||[],currSelected:E,setCurrSelected:y,has_permission:F})]})},Xe=[{key:"1",label:"Tax Rates",children:e.jsx(Ne,{})},{key:"2",label:"Tax Settings",children:e.jsx(e.Fragment,{children:"Tax Setting in progress"})}],Oe=({current:n,handleChange:o})=>e.jsx(e.Fragment,{children:e.jsx(xe,{tabPosition:"left",activeKey:n,items:Xe,onChange:o})}),ve=()=>{const{current:n,handleChange:o}=ue();return e.jsx(e.Fragment,{children:e.jsx(Oe,{handleChange:o,current:n})})};export{ve as default};
