import{F as i,u as Ye,j as e,M as ze,S as Y,ak as z,B as y,al as T,I as qe,l as ve,e as q,i as Ge,G as B,r as o,U as Ue,ai as He,b8 as We,aD as $e,$ as d,a4 as a,A as be,n as r,D as ue,E as pe,p as w,aj as je,C as Qe,T as he,ap as ge,o as Xe}from"./index-4b3d7bc8.js";import{R as Ze}from"./RepeatModal-0fdc96f9.js";import{P as Je}from"./PaginateSelect-b668bdaf.js";import{I as Ke}from"./ItemTable-c0313657.js";const{INVOICE_TERMS:es}=ve,{VscAdd:ss,MdOutlineRemoveCircleOutline:ls}=qe,ts=({visible:I,org_terms:_,refetch:D,toggle:v})=>{const[f]=i.useForm(),{callAxios:F,bool:N,toggle:m}=Ye(),l=b=>{m(),F({method:"put",url:es,data:b}).then(u=>{u&&(m(),D())})};return e.jsx(e.Fragment,{children:e.jsx(ze,{footer:null,destroyOnClose:!0,open:I,onCancel:v,title:"Payment Terms",maskClosable:!1,children:e.jsxs(i,{form:f,name:"dynamic_form_nest_item",onFinish:l,autoComplete:"off",children:[e.jsx(i.List,{name:"payment_terms",initialValue:_,children:(b,{add:u,remove:R})=>e.jsxs(e.Fragment,{children:[b.map(({key:A,name:p,...c})=>e.jsxs(Y,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(i.Item,{...c,name:[p,"name"],rules:[{required:!0,message:"Name Required"}],children:e.jsx(z,{placeholder:"Enter Term Name"})}),e.jsx(i.Item,{...c,name:[p,"value"],rules:[{required:!0,message:"Value Required"}],children:e.jsx(z,{placeholder:"Enter Value"})}),e.jsx(ls,{size:20,onClick:()=>R(p)})]},A)),e.jsx(i.Item,{children:e.jsx(y,{size:"middle",type:"ghost",icon:e.jsx(ss,{}),btnText:"Add New",clickHandler:()=>u()})})]})}),e.jsx(T,{}),e.jsxs(Y,{className:"steps-action",children:[e.jsx(y,{size:"middle",type:"default",btnText:"Cancel",htmlType:"button",clickHandler:v}),e.jsx(y,{size:"middle",btnText:"Save",loading:N})]})]})})})},{TextArea:Te}=z,ye=q(new Date),{RECURRING_BILLS:as}=Xe,{RECURRING_BILL_CONTACTS:is,RECURRING_BILL_ITEMS:ns}=ve,os={note:"",order_no:"",bill_no:null,adjustment:0,vendor_id:null,warehouse_id:"",bill_terms:null,end_date:ye,never_expires:!1,repeat_duration:null,start_date:ye,terms_and_condition:""},_s=({url:I,close:_,loading:D,onSubmit:v,handleTotal:f,handleItemList:F,create:N=!1,isModal:m=!1})=>{var W,$,Q,X,Z,J;const[l]=i.useForm(),b=Ge(),{bool:u,toggle:R}=B(!1),[A,p]=o.useState(0),{primary_organization:c}=Ue(),[Ne,Re]=o.useState([]),[V,Ee]=o.useState(0),{bool:Se,setTrue:Ce,setFalse:G}=B(!0),{bool:Ie,toggle:U}=B(!1),{taxes:De,warehouses:Fe,base_currency:L,repeat_duration:n,purchaseAccount:Ae,details:s}=He(I),{handleDate:Ve}=We((c==null?void 0:c.time_zone)||""),{data:x=[],refetch:Le}=$e(""),H=i.useWatch("bill_terms",l),j=i.useWatch("never_expires",l),M=o.useMemo(()=>x.filter(t=>t.id===H)[0]||{},[x,H]),k=l.getFieldValue("start_date"),E=Ve(M.value,k),Me=x.filter(({org_id:t})=>t)||[],ke=i.useWatch("adjustment",l),Oe=t=>{const S=n==null?void 0:n.find(C=>C.id===t);l.setFieldsValue({repeat_duration:S})};o.useEffect(()=>{var t,S,C,K,ee,se,le,te,ae,ie,ne,oe,de,re,me,ce,xe,_e,fe;if((t=s==null?void 0:s.bill_details)!=null&&t.bill_info&&Object.keys((S=s==null?void 0:s.bill_details)==null?void 0:S.bill_info).length){let O;/\d/.test((K=(C=s==null?void 0:s.bill_details)==null?void 0:C.bill_info)==null?void 0:K.repeat_duration)?O=((se=(ee=s==null?void 0:s.bill_details)==null?void 0:ee.bill_info)==null?void 0:se.repeat_duration.split(" ")[0])+" "+((le=n==null?void 0:n.find(P=>{var h,g;return P.value===((g=(h=s==null?void 0:s.bill_details)==null?void 0:h.bill_info)==null?void 0:g.repeat_duration.split(" ")[1])}))==null?void 0:le.label):O=(te=n==null?void 0:n.find(P=>{var h,g;return P.value===((g=(h=s==null?void 0:s.bill_details)==null?void 0:h.bill_info)==null?void 0:g.repeat_duration)}))==null?void 0:te.label,l.setFieldsValue({...(ae=s==null?void 0:s.bill_details)==null?void 0:ae.bill_info,never_expires:!((ne=(ie=s==null?void 0:s.bill_details)==null?void 0:ie.bill_info)!=null&&ne.end_date),repeat_duration:O,bill_terms:(de=(oe=s==null?void 0:s.bill_details)==null?void 0:oe.bill_info)==null?void 0:de.invoice_term_id,start_date:q((me=(re=s==null?void 0:s.bill_details)==null?void 0:re.bill_info)==null?void 0:me.start_date,"YYYY-MM-DD"),end_date:q((xe=(ce=s==null?void 0:s.bill_details)==null?void 0:ce.bill_info)==null?void 0:xe.end_date,"YYYY-MM-DD")}),Re((fe=(_e=s==null?void 0:s.bill_details)==null?void 0:_e.bill_info)==null?void 0:fe.bill_item_details),G()}},[(W=s==null?void 0:s.bill_details)==null?void 0:W.bill_info,l]),o.useEffect(()=>{E&&E.isValid()&&l.setFieldsValue({end_date:E}),j?l.setFieldsValue({end_date:null}):!j&&!M.value&&l.setFieldsValue({end_date:k})},[E,M,k,j]),o.useEffect(()=>{N&&l.setFieldsValue({bill_terms:x.filter(t=>t.name==="Net 30")[0]||{}})},[N,x]),o.useEffect(()=>{f==null||f(V)},[V]);const Pe=o.useCallback(t=>p(t),[]),Be=()=>R(),we=t=>{l.setFieldsValue({start_date:t}),t&&t>l.getFieldValue("end_date")&&l.setFieldsValue({end_date:t})};return e.jsxs(e.Fragment,{children:[e.jsx(ts,{visible:u,toggle:R,refetch:Le,org_terms:Me}),e.jsx(Ze,{form:l,visible:Ie,toggle:U,repeat_duration:n}),e.jsxs(i,{form:l,layout:"vertical",autoComplete:"off",onFinish:v,name:"invoice-form",initialValues:os,children:[e.jsx(d,{children:e.jsx(a,{span:8,offset:1,children:e.jsx(Je,{setTrue:Ce,name:"vendor_id",setFalse:G,label:"Vendor Name",url:is,placeholder:"Select or Search Vendor"})})}),e.jsxs("div",{className:Se?"hide":"display",children:[e.jsx(d,{children:e.jsx(a,{span:6,offset:1,children:e.jsx(be,{size:"middle",name:"profile_name",disabled:m,label:r.PROFILE_NAME,className:"mb flex_root",rules:ue({message:"Profile Name Required"})})})}),e.jsx(d,{children:e.jsx(a,{span:6,offset:1,children:e.jsx(pe,{repeat_opt:!0,name:"repeat_duration",label:"Repeat Every",className:"flex_root",handleToggle:U,options:n||[],placeholder:w.select_terms,handleChange:Oe,rules:ue({message:"Repeat Duration Required"})})})}),e.jsxs(d,{children:[e.jsxs(a,{span:6,offset:1,children:[e.jsx(je,{disableDate:!0,name:"start_date",label:r.START_DATE,onChange:we}),e.jsx(pe,{create_opt:!0,name:"bill_terms",label:"Payment Terms",options:x||[],className:"flex_root",disabled:j,handleToggle:Be,placeholder:w.select_terms})]}),e.jsx(a,{span:6,offset:1,children:e.jsx(je,{name:"end_date",label:r.END_DATE,disabled:j})}),e.jsx(a,{style:{paddingTop:35,paddingLeft:10},children:e.jsx(i.Item,{name:"never_expires",valuePropName:"checked",noStyle:!0,children:e.jsx(Qe,{children:"Never Expires"})})})]}),e.jsx(Ke,{taxes:De,itemList:Ne,adjustment:ke,warehouses:Fe,url:ns,setTotalAmount:Ee,handleSubTotal:Pe,currency:L==null?void 0:L.symbol,purchaseAccount:Ae,handleItemList:F}),e.jsx(T,{}),e.jsxs(d,{children:[e.jsx(a,{span:8,offset:1,children:e.jsx(i.Item,{label:r.NOTES,name:"note",className:"mb flex_root",children:e.jsx(Te,{rows:1})})}),e.jsxs(a,{span:8,offset:4,children:[e.jsxs(d,{children:[e.jsx(a,{children:e.jsx(he.Title,{level:5,style:{marginTop:8},children:"Sub Total"})}),e.jsx(a,{offset:14,children:e.jsx(ge,{value:A||0,prefix:($=s==null?void 0:s.base_currency)==null?void 0:$.symbol})})]}),e.jsx(d,{children:e.jsx(a,{span:6,children:e.jsx(be,{type:"number",size:"middle",name:"adjustment",label:"Adjustment",stringMode:!1,addonAfter:(Q=s==null?void 0:s.base_currency)==null?void 0:Q.symbol,placeholder:`${(X=s==null?void 0:s.base_currency)==null?void 0:X.symbol}0.00`})})})]})]}),e.jsx(T,{}),e.jsxs(d,{children:[e.jsx(a,{offset:13,children:e.jsx(he.Title,{level:4,style:{marginTop:3},children:"Total"})}),e.jsx(a,{offset:5,children:e.jsx(ge,{value:V||0,prefix:(Z=s==null?void 0:s.base_currency)==null?void 0:Z.symbol})})]}),e.jsx(T,{}),e.jsx(d,{children:e.jsx(a,{span:10,offset:1,children:e.jsx(i.Item,{label:r.TERMS_AND_CONDITIONS,name:"terms_and_condition",className:"flex_root",children:e.jsx(Te,{rows:4,name:"terms_and_condition",placeholder:w.terms_and_conditions})})})}),e.jsx(T,{}),e.jsxs(Y,{className:m?"steps-action":"",style:{paddingLeft:"46px"},children:[e.jsx(y,{btnText:(J=s==null?void 0:s.bill_details)!=null&&J.bill_info?r.UPDATE:r.CREATE,style:{width:"120px"},loading:D,block:!0}),e.jsx(y,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:()=>m?_==null?void 0:_():b(as)})]})]})]})]})};export{_s as R};
