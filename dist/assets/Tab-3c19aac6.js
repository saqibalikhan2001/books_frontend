import{r as u,j as e,aa as oe,f as Q,T as F,n as g,I as U,F as T,ai as le,A as $,D as A,p as G,E as Z,B as J,M as ae,u as w,ab as W,h as X,l as I,G as Y,i as L,o as O,aE as re,aF as ce,J as de,s as K,aw as me,aG as he}from"./index-4b3d7bc8.js";import{A as ee}from"./ActionMenu-149e95aa.js";import{A as D}from"./AccessDenied-45b92511.js";import{u as V}from"./usePermissions-36032956.js";import{u as ue}from"./useTabs-bacf39f5.js";import"./useSearchParam-ebfda256.js";const xe=(h,d="1")=>{const m=localStorage.getItem("params"),r=JSON.parse(m),[l,o]=u.useState({sort:(r==null?void 0:r.sort)??"",sort_column:(r==null?void 0:r.sort_column)??"",filter:(r==null?void 0:r.filter)??""});u.useEffect(()=>{const t={...l,sort_column:l.sort!==void 0?l.sort_column:""};localStorage.setItem("params",JSON.stringify(t));const n=`?tab=${d}&sort=${t.sort??""}&sort_column=${t.sort!==void 0?t.sort_column:""}&filter=${t.filter??""}`;let a=window.location.origin+window.location.pathname+n;history.pushState(history.state,h,a)},[l,d,h]);const s=u.useCallback((t,n,a)=>{o({...l,sort:a.order,sort_column:a.field||a.columnKey})},[l]),i=u.useCallback(t=>{o({...l,sort:t.sort,sort_column:t.sort_column,filter:t.filter})},[l]);return{onChange:s,sorting:l,handleParams:i}},{Text:ge}=F,{INVITATION:fe,DELETE:je}=g,{BsArrowDownCircle:k,BsArrowUpCircle:C}=U,be=({list:h,loading:d,onChange:m,handleConfirm:r,has_permission:l})=>{const o=localStorage.getItem("params"),s=JSON.parse(o),i=u.useMemo(()=>[{title:({sortColumns:t})=>{var a,c;const n=t&&((c=(a=t[0])==null?void 0:a.column)==null?void 0:c.key);return e.jsxs("div",{children:["Name",n==="name"?(s==null?void 0:s.sort)==="ascend"?e.jsx(k,{}):(s==null?void 0:s.sort)==="descend"?e.jsx(C,{}):"":""]})},sorter:!0,dataIndex:"name",key:"name",width:400},{title:({sortColumns:t})=>{var a,c;const n=t&&((c=(a=t[0])==null?void 0:a.column)==null?void 0:c.key);return e.jsxs("div",{children:["My Role",n==="role"?(s==null?void 0:s.sort)==="ascend"?e.jsx(k,{}):(s==null?void 0:s.sort)==="descend"?e.jsx(C,{}):"":""]})},dataIndex:"",key:"role",sorter:!0,width:150,render:t=>{var n;return e.jsx(ge,{children:t!=null&&t.role?(n=t==null?void 0:t.role)==null?void 0:n.name:t==null?void 0:t.role_name})}},{title:({sortColumns:t})=>{var a,c;const n=t&&((c=(a=t[0])==null?void 0:a.column)==null?void 0:c.key);return e.jsxs("div",{children:["Email",n==="email"?(s==null?void 0:s.sort)==="ascend"?e.jsx(k,{}):(s==null?void 0:s.sort)==="descend"?e.jsx(C,{}):"":""]})},dataIndex:"email",sorter:!0,key:"email",width:220},{title:({sortColumns:t})=>{var a,c;const n=t&&((c=(a=t[0])==null?void 0:a.column)==null?void 0:c.key);return e.jsxs("div",{children:["Status",n==="is_invited"?(s==null?void 0:s.sort)==="ascend"?e.jsx(k,{}):(s==null?void 0:s.sort)==="descend"?e.jsx(C,{}):"":""]})},dataIndex:"",key:"is_invited",sorter:!0,width:120,render:t=>e.jsx(oe,{color:t.is_invited?"orange":!t.is_invited&&t.status?"green":"grey",children:t.is_invited?"Invited":!t.is_invited&&t.status?"Active":"Inactive"},t==null?void 0:t.id),ellipsis:!0},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:t=>e.jsx(ee,{user:!0,data:t,canEdit:!1,handleConfirm:r,deletePermission:t.platform_type==="books"?l:!1,title:t.platform_type==="books"&&l?`${je} ${t.name} ${fe} ?`:"Permission Denied"})}],[r,l,s==null?void 0:s.sort]);return e.jsx(e.Fragment,{children:e.jsx(Q,{className:"users-table generic-table",bordered:!1,loading:d,onChange:m,dataSource:h,columns:i,pagination:!1,rowKey:t=>t.id})})},{Title:_e}=F,Ee={name:"",email:"",role_id:null},Ie=({url:h,onSubmit:d,toggle:m,loading:r,isEdit:l})=>{const[o]=T.useForm(),{details:s,roles:i}=le(h);return u.useEffect(()=>{l&&s&&Object.keys(s).length&&o.setFieldsValue({...s==null?void 0:s.user_info})},[o,s,l]),e.jsxs(T,{form:o,layout:"vertical",onFinish:d,requiredMark:!1,name:"invite-user-form",initialValues:Ee,className:"invite_user_form",children:[e.jsx(_e,{level:5,className:"h4 w-700",children:"Invite User"}),e.jsx($,{name:"name",size:"middle",className:"input_field",label:e.jsxs("label",{children:[g.NAME," ",e.jsx("span",{className:"staric",children:"*"})]}),rules:A({message:G.enter_name}),placeholder:`${g.ENTER} ${g._NAME}`}),e.jsx(Z,{name:"role_id",options:i,allowClear:!1,className:"input_field",label:e.jsxs("label",{children:[g.ROLE," ",e.jsx("span",{className:"staric",children:"*"})]}),placeholder:`${g.ENTER} ${g._ROLE}`,rules:A({message:G.role_required})}),e.jsx($,{name:"email",disabled:l,className:"input_field",rules:A({name:"email"}),label:e.jsxs("label",{children:[g.EMAIL," ",e.jsx("span",{className:"staric",children:"*"})]}),placeholder:`${g.ENTER} ${g._EMAIL}`}),e.jsxs("div",{className:"d-flex flex-end",children:[e.jsx(J,{htmlType:"button",clickHandler:m,btnText:g.CANCEL,className:"btn-form-size btn-default mr-20  mb-0"}),e.jsx(J,{btnText:g.SAVE,className:"btn-form-size btn-primary  mb-0",loading:r})]})]})},te=({url:h,bool:d,toggle:m,isEdit:r,loading:l,onSubmit:o,has_permission:s})=>{const[i]=T.useForm(),t=()=>{i.resetFields()};return e.jsx(e.Fragment,{children:e.jsx(ae,{open:d,footer:null,destroyOnClose:!0,onCancel:m,maskClosable:!1,afterClose:t,centered:!0,width:544,className:"radius-5",children:s?e.jsx(Ie,{url:h,toggle:m,isEdit:r,loading:l,onSubmit:o}):e.jsx(D,{})})})},{ORGANIZATIONS:ye,USERS:ve}=I,ke=({url:h,bool:d,toggle:m,current:r,refetch:l,has_permission:o})=>{const{callAxios:s}=w(),[i,,t,n]=W(),a=c=>{t(),s({method:"put",data:c,url:`${ye}${ve}/${r.id}`}).then(x=>{n(),x&&(m(),l(),X({message:x.message}))})};return e.jsx(e.Fragment,{children:e.jsx(te,{isEdit:!0,url:h,bool:d,toggle:m,loading:i,onSubmit:a,has_permission:o})})},{INVITE_USER:Ce}=I,we=({data:h,refetch:d,onChange:m,isLoading:r,isFetching:l})=>{const{handleConfirm:o}=w(),[s,i]=u.useState({}),{checkPermission:t}=V(),{bool:n,toggle:a}=Y(),{has_InviteView_permission:c}=t("InviteView"),{has_InviteEdit_permission:x}=t("InviteEdit"),{has_InviteDelete_permission:f}=t("InviteDelete"),N=j=>{i(j),a()},y=u.useCallback(N,[a]),_=u.useCallback(j=>o(j,Ce,d),[o,d]);return e.jsxs(e.Fragment,{children:[c?e.jsx(be,{list:h||[],onChange:m,handleClick:y,handleConfirm:_,loading:l||r,has_permission:f}):e.jsx(D,{}),n&&e.jsx(ke,{url:"",bool:n,refetch:d,current:s,toggle:a,has_permission:x})]})},{DELETE:Ne,ROLE:Re}=g,{BsArrowDownCircle:q,BsArrowUpCircle:H}=U,Se=({list:h,loading:d,onChange:m,handleClick:r,handleConfirm:l,has_permission:o})=>{const s=localStorage.getItem("params"),i=JSON.parse(s),t=u.useMemo(()=>[{title:({sortColumns:n})=>{var c,x;const a=n&&((x=(c=n[0])==null?void 0:c.column)==null?void 0:x.key);return e.jsxs("div",{children:["My Role",a==="name"?(i==null?void 0:i.sort)==="ascend"?e.jsx(q,{}):(i==null?void 0:i.sort)==="descend"?e.jsx(H,{}):"":""]})},sorter:!0,dataIndex:"name",key:"name",width:200},{title:"Description",dataIndex:"description",key:"description",width:450},{title:({sortColumns:n})=>{var c,x;const a=n&&((x=(c=n[0])==null?void 0:c.column)==null?void 0:x.key);return e.jsxs("div",{children:["Users",a==="total_users"?(i==null?void 0:i.sort)==="ascend"?e.jsx(q,{}):(i==null?void 0:i.sort)==="descend"?e.jsx(H,{}):"":""]})},sorter:!0,dataIndex:"total_users",key:"total_users",width:50},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:n=>e.jsx(ee,{role:!0,data:n,canEdit:n.platform_type==="books",handleClick:r,handleConfirm:l,deletePermission:n.platform_type==="books"?o:!1,title:n.platform_type==="books"&&o?`${Ne} ${n.name} ${Re} ?`:"Permission Denied"})}],[l,o,r,i==null?void 0:i.sort]);return e.jsx(e.Fragment,{children:e.jsx(Q,{className:"roles-table generic-table",bordered:!1,loading:d,onChange:m,dataSource:h,columns:t,pagination:!1,rowKey:n=>n.id})})},{ROLE:Ae}=I,{EDIT_ROLE:Te}=O,$e=({data:h,refetch:d,isLoading:m,isFetching:r,onChange:l})=>{const o=L(),{handleConfirm:s}=w(),{checkPermission:i}=V(),{has_RoleView_permission:t}=i("RoleView"),{has_RoleDelete_permission:n}=i("RoleDelete"),a=f=>{o(`${Te}?id=${f.id}`)},c=u.useCallback(a,[o]),x=u.useCallback(f=>s(f,Ae,d),[s,d]);return e.jsx(e.Fragment,{children:t?e.jsx(Se,{list:h||[],onChange:l,handleClick:c,handleConfirm:x,loading:r||m,has_permission:n}):e.jsx(D,{})})},{INVITE_USER:Fe}=I,{USERS:Ue}=O,Le=({url:h,bool:d,refetch:m,toggle:r,has_permission:l})=>{const o=L(),{callAxios:s}=w(),[i,t]=W(),n=a=>{t(),s({method:"post",data:{...a},url:Fe}).then(c=>{t(),c&&(m(),X({message:c.message}),r(),o(`${Ue}?tab=1`))})};return e.jsx(e.Fragment,{children:e.jsx(te,{url:h,bool:d,toggle:r,loading:i,onSubmit:n,has_permission:l})})},{VscAdd:Oe}=U,{Title:De}=F,{ADD_ROLE:Ve}=O,Me=[{id:"all",label:"All"},{id:"active",label:"Active"},{id:"in_active",label:"Inactive"},{id:"invited",label:"Invited"}],Ke=()=>{const h=L(),[d,m]=u.useState(),[r,l]=u.useState(),{current:o,handleChange:s}=ue(),{checkPermission:i}=V(),{bool:t,toggle:n}=Y(),{has_RoleView_permission:a}=i("RoleView"),{has_InviteView_permission:c}=i("InviteView"),{has_InviteCreate_permission:x}=i("InviteCreate"),{sorting:f,handleParams:N,onChange:y}=xe(o==="1"?"users":"roles",o),{data:_=[],refetch:j,isLoading:M,isFetching:P}=re(f,{refetchOnMountOrArgChange:!0,skip:!c||o==="2"}),{data:v=[],refetch:z,isLoading:B,isFetching:p}=ce(f,{refetchOnMountOrArgChange:!0,skip:!a||o==="1"});u.useEffect(()=>{o==="1"&&m(_)},[_]),u.useEffect(()=>{o==="2"&&l(v)},[v]);const se=R=>{const{value:E}=R.target;if(o==="1"){const S=_.filter(b=>b==null?void 0:b.name.includes(E.toLowerCase()||E.toUpperCase()));m(E?S:_)}if(o==="2"){const S=v.filter(b=>b==null?void 0:b.name.includes(E.toLowerCase()||E.toUpperCase()));l(E?S:v)}},ne=R=>N({...f,filter:R}),ie=u.useMemo(()=>[{key:"1",label:e.jsx("label",{children:"Users"}),children:e.jsx(we,{bool:t,data:d,onChange:y,toggle:n,refetch:j,isLoading:M,isFetching:P})},{key:"2",label:e.jsx("label",{children:"Roles"}),children:e.jsx($e,{data:r,onChange:y,refetch:z,isLoading:B,isFetching:p})}],[d,r,t,y,n,M,B,j,z,p,P]);return e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"tabs-header ml-10 mr-10  ",title:e.jsx(De,{level:5,children:"Users & Roles"}),extra:e.jsxs(e.Fragment,{children:[e.jsx(K,{onClick:n,className:"btn-default btn-form-size",children:"Invite User"}),e.jsx(K,{type:"primary",className:"btn-primary btn-form-size d-flex align-center",icon:e.jsx(Oe,{}),onClick:()=>h(Ve),children:"Add New"})]})}),e.jsx(me,{className:"user-tabs ml-10 mr-10 mt-12 pt-8 pb-8",tabBarExtraContent:e.jsxs(e.Fragment,{children:[e.jsx($,{size:"middle",name:"search",label:"",onChange:se,placeholder:"Search by name",suffix:e.jsx(he,{}),className:"w-300 mb-0 fields_field mr-20 w-300"}),o==="1"&&e.jsx(Z,{className:"w-36 mb-0 filter-field",name:"",defaultValue:"all",size:"middle",options:Me,label:e.jsx("label",{children:"Filter by status:"}),placeholder:"filter by order",handleChange:ne})]}),activeKey:o,items:ie,onTabClick:s}),t&&e.jsx(Le,{bool:t,toggle:n,refetch:j,has_permission:x,url:`${I.INVITE_USER}${I.CREATE}`})]})};export{Ke as default};
