import{r as x,j as a,az as T,bU as X,S as B,a3 as Z,s as z,f as M,I as ee,e as L,F as $,i as ae,aW as te,u as se,G as ne,ai as re,y as oe,$ as le,a4 as v,A as de,n as f,D as K,aj as ie,E as ce,al as N,B as G,p as I,o as ue,l as _e}from"./index-4b3d7bc8.js";const{Option:Y}=T,{RiDeleteBinLine:pe}=ee,he=({data:b,items:g,loader:E,isModal:l,warehouses:m,handleConfirm:c,handleSelectedItem:u,handleQuantityChange:k})=>{const C=x.useMemo(()=>[{title:"ITEMS",dataIndex:"item_id",width:l?300:500,ellipsis:!0,editable:!0,render:(i,_)=>a.jsx(T,{showSearch:!0,value:i,placeholder:"Select Item",style:{width:l?"250px":"450px"},onChange:d=>u(d,_),children:g.map((d,A)=>a.jsx(Y,{value:d.item_id,children:d.label},`option-${d.item_id}-${A}`))})},{title:"WAREHOUSE",dataIndex:"warehouse_id",ellipsis:!0,editable:!0,width:l?150:250,render:i=>a.jsx(T,{style:{width:l?120:180},placeholder:"Warehouse",value:i,disabled:!0,children:m.map((_,d)=>a.jsx(Y,{value:_.id,children:_.label},d))})},{title:"ORDERED",dataIndex:"ordered_quantity",ellipsis:!0,editable:!0,width:l?90:120},{title:"PACKED",dataIndex:"packed",ellipsis:!0,width:l?90:120},{title:"STOCK",dataIndex:"stock",ellipsis:!0,width:l?90:250},{title:"PACKED QUANTITY",dataIndex:"quantity",ellipsis:!0,width:l?90:120,render:(i,_)=>a.jsx(X,{min:0,name:"quantity",value:i,style:{width:l?"60px":"90px"},onChange:d=>k(d,_)})},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:i=>a.jsx(B,{align:"center",children:a.jsx(Z,{okText:"YES",cancelText:"NO",placement:"left",title:"Delete  Item ?",disabled:b.length===1,onConfirm:()=>c(i),children:a.jsx(z,{size:"small",shape:"circle","aria-disabled":"true",disabled:b.length===1,children:a.jsx(pe,{size:10})},"deletebtn")},"confirm")})}],[g,k,u,c]);return a.jsx(a.Fragment,{children:a.jsx(M,{bordered:!0,rowKey:"key",dataSource:b,pagination:!1,columns:C,loading:l?E:!1})})},xe=L(new Date),{PACKAGE_CREATE:ke}=_e,{select_sales_order:ye}=I,{PACKAGES:ge,ADD_PACKAGE:je}=ue,fe={package_no:"",sales_order_id:null,package_date:xe},we=({edit:b,close:g,loading:E,url:l="",onSubmit:m,handleItemsList:c,isModal:u=!1})=>{const[k]=$.useForm(),C=ae(),i=te(),{callAxios:_}=se(),{bool:d,toggle:A}=ne(),[j,y]=x.useState([]),[D,S]=x.useState([]),[F,w]=x.useState(!0),[P,O]=x.useState(1),[R,q]=x.useState([]),{sales_order_list:U,details:e}=re(l);x.useEffect(()=>{var o,r;if(u&&(e!=null&&e.sales_order)&&Object.keys(e==null?void 0:e.sales_order).length){w(!0),k.setFieldsValue({package_no:e.package_no,sales_order_id:(o=e==null?void 0:e.sales_order)==null?void 0:o.id}),q(e==null?void 0:e.warehouse_list);const n=(r=e==null?void 0:e.sales_order)==null?void 0:r.sales_order_details.map((t,s)=>{var p;return{...t,key:`${s}`,unit:(p=t==null?void 0:t.items)==null?void 0:p.unit,id:t.item_id,ordered_quantity:t==null?void 0:t.quantity,sales_order_item_detail_id:t==null?void 0:t.id}});S(n),y(n||[]),c(n),w(!1)}},[e==null?void 0:e.sales_order,u]),x.useEffect(()=>{var o,r;if(e!=null&&e.package&&Object.keys(e==null?void 0:e.package).length){w(!0),k.setFieldsValue({...e==null?void 0:e.package,package_date:L((o=e==null?void 0:e.package)==null?void 0:o.package_date,"YYYY-MM-DD")});const n=((r=e==null?void 0:e.sales_order_item_details)==null?void 0:r.map((t,s)=>({...t,key:`${s}`,ordered_quantity:t.quantity,quantity:t.packed,warehouse_id:t.warehouse_id})))||[];y(n),c(n),S(n),q(e==null?void 0:e.warehouse_list),w(!1)}},[e==null?void 0:e.package]);const V=o=>{A(),_({url:`${ke}?sales_order_id=${o}`}).then(r=>{var t;k.setFieldsValue({package_no:r.package_no}),q(r==null?void 0:r.warehouse_list);const n=(t=r==null?void 0:r.sales_order)==null?void 0:t.sales_order_details.map((s,p)=>{var h;return{...s,key:`${p}`,unit:(h=s==null?void 0:s.items)==null?void 0:h.unit,id:s.item_id,ordered_quantity:s==null?void 0:s.quantity,sales_order_item_detail_id:s==null?void 0:s.id}});S(n),y(n||[]),c(n),O(s=>s+(n.length-1)),A(),w(!1)})},W=o=>{const r=j.filter(n=>n.key!==o.key);y(r)},H=()=>{const o={key:`${P}`,item_obj:null,warehouse_id:null,quantity:0,dropshipped:0,packed:0,stock:[],unit:"",sales_order_item_detail_id:null};y([...j,o]),O(P+1)},Q=(o,r)=>{const n=R.find(h=>h.is_primary)||{};let t=D.find(h=>h.item_id===o);const s=[...j],p=s.findIndex(h=>h.key===r.key);s[p]={...s[p],key:`${p}`,unit:t.unit,packed:t.packed,item_id:t.item_id,stock:t.stock||[],quantity:t.quantity,warehouse_id:n.id,ordered_quantity:t.quantity,sales_order_item_detail_id:t.item_id},y(s),c(s)},J=(o,r)=>{const n=[...j];n[r.key]={...n[r.key],quantity:o},y(n),c(n)};return d||F&&i.pathname!==je?a.jsx(oe,{}):a.jsx(a.Fragment,{children:a.jsxs($,{form:k,name:"package-form",layout:"vertical",autoComplete:"off",onFinish:m,initialValues:fe,children:[a.jsxs(le,{children:[a.jsxs(v,{span:6,offset:1,children:[a.jsx(de,{disabled:!0,size:"middle",name:"package_no",label:f.PACKAGE_NO,placeholder:ye,rules:K({message:I.package_required})}),a.jsx(ie,{name:"package_date",label:f.PACKAGE_DATE})]}),a.jsx(v,{span:6,offset:1,children:a.jsx(ce,{name:"sales_order_id",className:"flex_root",label:f.SALES_ORDER,options:U,disabled:b||u,handleChange:V,rules:K({message:I.sales_order_required})})})]}),a.jsx(N,{}),a.jsx(he,{data:j,items:D,loader:F,isModal:u,warehouses:R,handleConfirm:W,handleSelectedItem:Q,handleQuantityChange:J}),D.length!==j.length&&a.jsx(z,{onClick:H,children:"Add a new Line"}),a.jsx(N,{}),a.jsxs(B,{style:{paddingLeft:"10px"},children:[a.jsx(G,{btnText:e.package&&Object.keys(e.package).length?f.UPDATE:f.CREATE,style:{width:"120px"},loading:E,block:!0}),a.jsx(G,{type:"default",htmlType:"button",btnText:f.CANCEL,clickHandler:()=>u?g==null?void 0:g():C(ge)})]})]})})};export{we as P};
