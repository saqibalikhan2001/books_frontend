import{i as D,r as o,u as R,aD as N,j as s,P as z,o as B,l as G,h as c,p as H,am as d,aB as K,z as O}from"./index-4b3d7bc8.js";import{E as Q}from"./EstimateForm-74a2693a.js";import{u as U}from"./usePermissions-36032956.js";import{A as X}from"./AccessDenied-45b92511.js";import"./AddressModal-12b3ae58.js";import"./CustomerTab-c6c321f7.js";import"./useListing-af775608.js";import"./useDelayUnmount-cb77ae7b.js";import"./index-b8658cbe.js";import"./progress-e3fed29d.js";import"./ImageUploader-b2d6894b.js";import"./Create-76ba1395.js";import"./ContactDetailModal-bc8d3392.js";import"./DetailPage-c0159ae7.js";import"./capitalize-cfd5966b.js";import"./Table-9972bb2a.js";import"./Processing-a1197381.js";import"./PaginateSelect-b668bdaf.js";import"./ItemTable-c0313657.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";import"./Create-8edeb959.js";import"./ItemForm-ceb885e2.js";import"./ImageCrop-db92a92e.js";import"./index-d9b76a87.js";import"./Create-93e4462e.js";import"./calculation-671db1b1.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";const{ESTIMATES:q}=B,{ESTIMATES:_,ESTIMATE_CREATE:J}=G,St=()=>{const h=D(),[l,g]=o.useState(0),{checkPermission:y}=U(),{callAxios:E,toggle:u,bool:T}=R(),[i,I]=o.useState([]),{data:A=[]}=N(""),[j,x]=o.useState(""),{has_EstimatesCreate_permission:S}=y("EstimatesCreate"),[b,f]=o.useState(),C=o.useCallback(t=>g(t),[]),w=o.useCallback(t=>I(t),[]),P=o.useCallback(t=>x(t),[]),k=o.useCallback(t=>f(t),[]),L=({values:t})=>{var r,m,n,a;const F={name:(r=t==null?void 0:t.payment_terms)==null?void 0:r.payment_term_name,value:(m=t==null?void 0:t.payment_terms)==null?void 0:m.payment_term_value};if(!i.length)c({message:H.select_item,type:"error"});else{const M=i.filter(e=>e.id!==null).map(e=>({...e,item_obj:null,warehouseId:e.warehouse_id})),W={...t,total:l,items:M,adjustment:t.adjustment||0,shipping_charge:t.shipping_charge||0,warehouse_id:j||b,estimate_date:d(t.estimate_date),expiry_date:d(t.expiry_date),sent:(t==null?void 0:t.saveAs)==="sent"||t.saveAs==="email",billing_address_id:(n=t==null?void 0:t.billing_address_id)==null?void 0:n.id,customer_id:typeof t.customer_id=="object"?(a=t.customer_id)==null?void 0:a.id:t.customer_id,payment_terms:typeof t.payment_terms!="object"?A.find(e=>e.id===t.payment_terms)||{}:F,discount_level:t==null?void 0:t.discount_level,discount_type:t.transsection_level_discount_type,discount_transaction_level:t.transection_level_discount||0};u(),E({method:"post",url:_,data:W}).then(e=>{var p;e&&(t.saveAs==="email"&&K("email",!0),c({message:e.message}),O((p=e==null?void 0:e.data)==null?void 0:p.id,!0,_),h(-1))})}};return s.jsx(s.Fragment,{children:S?s.jsxs(s.Fragment,{children:[s.jsx(z,{title:"",navigateTo:q}),s.jsx(Q,{create:!0,item:i,loading:T,onSubmit:L,url:J,handleTotal:C,handleItemList:w,handleWarehouseId:P,handlePrimaryWarehouse:k})]}):s.jsx(X,{})})};export{St as default};
