import{U as fs,e as N,F as c,i as ps,G as Ce,r as o,u as gs,aD as bs,ai as ys,j as t,y as js,M as Ee,a2 as Ns,b6 as Se,B as w,ao as vs,az as Cs,b7 as Es,E as Te,n as g,p as z,A as Ss,aj as we,a0 as Ts,b4 as ws,ak as Fs,T as Ms,o as As,l as Bs,b8 as Is}from"./index-4b3d7bc8.js";import{I as Vs,A as Os}from"./AddressModal-12b3ae58.js";import $s from"./Create-76ba1395.js";import{C as ks}from"./ContactDetailModal-bc8d3392.js";import{P as zs}from"./PaginateSelect-b668bdaf.js";import{I as Ds}from"./ItemTable-c0313657.js";const{TextArea:Fe}=Fs,{Text:Me}=Ms,{add_notes:Ls}=z,{ESTIMATES:Rs}=As,{ESTIMATE_CONTACT:Ps,ESTIMATE_ITEMS:Us,CUSTOMERS:Ws}=Bs;var[$,k]=["7","day"];const Js=({url:Ae,item:F,loading:Be,onSubmit:E,handleTotal:Ie,handleItemList:Ve,create:D=!1,handleWarehouseId:Oe,handlePrimaryWarehouse:L})=>{var J,K,ee,se,te,le,ae,ie,ne,oe;const{org_date_format:M,TimeZone:$e}=fs(),{dateWithOrgTZ:ke}=Is(`${$e}`),x=N(ke(N(new Date),M)),ze={name:"",reference:"",adjustment:0,estimate_no:"",customer_id:null,customer_email:"",customer_note:"",shipping_charge:0,payment_terms:null,expiry_date:x.add(7,"day"),terms_and_condition:"",billing_address_id:null,estimate_date:x,transsection_level_discount_type:"amount",transection_level_discount:0},[a]=c.useForm(),De=ps(),{setTrue:Le,setFalse:A}=Ce(!0),[_,f]=o.useState(),[Re,Pe]=o.useState([]),[p,B]=o.useState(),[b,S]=o.useState(!1),[I,Ue]=o.useState(0),[We,T]=o.useState(!1),[R,He]=o.useState(!1),[Ze,P]=o.useState(!1),{callAxios:U,bool:qe,toggle:W}=gs(),[h,Ge]=o.useState(),{bool:Qe,toggle:H}=Ce(!1),[Z,Xe]=o.useState(!1),[q,Ye]=o.useState(!1),{data:v=[],refetch:Je}=bs(""),{taxList:Ke,warehouses:es,formLoading:ss,sales_person:ts,details:s,details:{estimate_no:G,preference_list:y,discount_level:ls}}=ys(Ae),as=c.useWatch("adjustment",a),n=c.useWatch("customer_id",a),is=c.useWatch("estimate_date",a),ns=c.useWatch("shipping_charge",a),os=c.useWatch("transection_level_discount",a),ms=c.useWatch("transsection_level_discount_type",a),ds=v.filter(({deletable:e})=>e)||[];o.useEffect(()=>{var e;a.setFieldsValue({estimate_no:G}),a.setFieldValue("terms_and_condition",(e=y==null?void 0:y.estimate_preference)==null?void 0:e.terms)},[G,(J=y==null?void 0:y.estimate_preference)==null?void 0:J.terms]),o.useEffect(()=>{var e,l,d,r,u,m,i,j,me,de,ce,_e,re,ue,xe,he,fe,pe,ge,be,ye,je,Ne;if(s!=null&&s.estimate&&Object.keys(s==null?void 0:s.estimate).length){const hs=v==null?void 0:v.find(O=>{var ve;return(O==null?void 0:O.value)===((ve=s==null?void 0:s.estimate)==null?void 0:ve.payment_term_value)});a.setFieldsValue({...s==null?void 0:s.estimate,estimate_no:(e=s==null?void 0:s.estimate)==null?void 0:e.estimate_no,expiry_date:N((l=s==null?void 0:s.estimate)==null?void 0:l.expiry_date),estimate_date:N((d=s==null?void 0:s.estimate)==null?void 0:d.estimate_date),payment_terms:hs,transection_level_discount:(r=s.estimate)==null?void 0:r.discount_transaction_level,transsection_level_discount_type:(u=s.estimate)==null?void 0:u.discount_type,billing_address_id:(m=s==null?void 0:s.estimate)!=null&&m.billing_address?{id:(j=(i=s==null?void 0:s.estimate)==null?void 0:i.billing_address)==null?void 0:j.id,label:(de=(me=s==null?void 0:s.estimate)==null?void 0:me.billing_address)!=null&&de.attention?(_e=(ce=s==null?void 0:s.estimate)==null?void 0:ce.billing_address)==null?void 0:_e.attention:(ue=(re=s==null?void 0:s.estimate)==null?void 0:re.billing_address)==null?void 0:ue.country_name}:null,customer_id:{id:(he=(xe=s==null?void 0:s.estimate)==null?void 0:xe.contact)==null?void 0:he.id,label:(pe=(fe=s==null?void 0:s.estimate)==null?void 0:fe.contact)==null?void 0:pe.display_name}}),L((ge=s==null?void 0:s.estimate)==null?void 0:ge.warehouse_id),Pe((be=s==null?void 0:s.estimate)==null?void 0:be.estimates_details),f((ye=s==null?void 0:s.estimate)==null?void 0:ye.billing_address),B((Ne=(je=s==null?void 0:s.estimate)==null?void 0:je.contact)==null?void 0:Ne.contact_addresses),A()}},[s==null?void 0:s.estimate]),o.useEffect(()=>{var l,d,r,u,m;const e=(r=(d=(l=s==null?void 0:s.preference_list)==null?void 0:l.estimate_preference)==null?void 0:d.preferences)==null?void 0:r.estimate_expiry_age;[$,k]=e?[(u=e==null?void 0:e.split(" "))==null?void 0:u[0],(m=e==null?void 0:e.split(" "))==null?void 0:m[1]]:[7,"day"],a.setFieldsValue({expiry_date:e?x==null?void 0:x.add(Number($),k):x==null?void 0:x.add(7,"day")})},[s]),o.useEffect(()=>{Ie(I)},[I]),o.useEffect(()=>{h&&(a.setFieldsValue({customer_id:{id:h==null?void 0:h.id,label:h==null?void 0:h.display_name}}),Y(h))},[h]);const Q=e=>`${e!=null&&e.attention?(e==null?void 0:e.attention)+", ":""}${e!=null&&e.street?(e==null?void 0:e.street)+", ":""}${e!=null&&e.street_2?(e==null?void 0:e.street_2)+",":""}${e!=null&&e.city?(e==null?void 0:e.city)+", ":""}${e!=null&&e.state?(e==null?void 0:e.state)+", ":""}${e!=null&&e.zip_code?(e==null?void 0:e.zip_code)+", ":""}${e!=null&&e.country_name?(e==null?void 0:e.country_name)+", ":""}${e!=null&&e.phone?e==null?void 0:e.phone:""}`,C=()=>He(!R),V=()=>Ye(!q),X=()=>Xe(!Z),cs=()=>{T(!0),C()},Y=e=>{e?(W(),A(),U({method:"get",url:`/contacts/${e==null?void 0:e.id}/addresses`}).then(l=>{var d,r,u,m;if(l){B(l),a.setFieldsValue({payment_terms:e!=null&&e.payment_terms?{id:e==null?void 0:e.payment_terms,label:e==null?void 0:e.payment_term_name,payment_term_value:e==null?void 0:e.payment_term_value,payment_term_name:e==null?void 0:e.payment_term_name}:null,customer_email:e!=null&&e.email?e==null?void 0:e.email:null});const i=l==null?void 0:l.find(j=>(j==null?void 0:j.address_type)==="billing");i?(f(i),a.setFieldsValue({billing_address_id:{id:i==null?void 0:i.id,label:i!=null&&i.attention?i==null?void 0:i.attention:i==null?void 0:i.country_name}})):l!=null&&l.length?(f(l[0]),a.setFieldsValue({billing_address_id:{id:(d=l[0])==null?void 0:d.id,label:(r=l[0])!=null&&r.attention?(u=l[0])==null?void 0:u.attention:(m=l[0])==null?void 0:m.country_name}})):(f(null),a.setFieldsValue({billing_address_id:null,customer_email:null}))}})):(f(null),a.setFieldsValue({billing_address_id:null,customer_email:null}))},_s=e=>{W(),U({method:b?"put":"post",url:b?`${Ws}/${(n==null?void 0:n.id)||n}/addresses/${_==null?void 0:_.id}`:`contacts/${(n==null?void 0:n.id)||n}/addresses`,data:{fax:e.bill_fax,city:e.bill_city,state:e.bill_state,phone:e.bill_phone,street:e.bill_street,street_2:e.bill_street_2,zip_code:e.bill_zip_code,attention:e.bill_attention,country_id:e.bill_country_id,address_type:b?e==null?void 0:e.address_type:"additional"}}).then(l=>{var d,r;if(l){const u=(d=l==null?void 0:l.contact_address)==null?void 0:d.find(i=>(i==null?void 0:i.id)===(_==null?void 0:_.id));let m=b?u:(r=l==null?void 0:l.data)==null?void 0:r.at(-1);f(m),C(),S(!1),T(!1),P(!1),B(b?l==null?void 0:l.contact_address:l==null?void 0:l.data),a.setFieldsValue({billing_address_id:{id:m==null?void 0:m.id,label:m.attention}})}})},rs=()=>{C(),S(!0)},us=e=>{const l=p==null?void 0:p.find(d=>d.id===e);f(l),a.setFieldsValue({billing_address_id:{id:e,label:l!=null&&l.attention?l==null?void 0:l.attention:l.country_name}})},xs=[{key:"1",label:((K=s==null?void 0:s.estimate)==null?void 0:K.status)==="sent"?"Update as sent":"Save as sent",onClick:()=>E({values:{...a.getFieldsValue(),saveAs:"sent"}})},{key:"2",label:((ee=s==null?void 0:s.estimate)==null?void 0:ee.status)==="sent"?"Update and Email":"Save and Email",onClick:()=>E({values:{...a.getFieldsValue(),saveAs:"email"}})}];return t.jsx(t.Fragment,{children:ss?t.jsx(js,{}):t.jsxs("div",{className:"estimate_product_listing",children:[t.jsx(Vs,{toggle:H,refetch:Je,estimate_form:a,org_terms:ds,visible:Qe}),t.jsx(ks,{isModal:!0,bool:Z,toggle:X,detail:typeof n=="object"?n:{id:n}}),t.jsxs(c,{form:a,layout:"vertical",autoComplete:"off",onFinish:e=>{var l;return E(D?{values:{...e,discount_level:s==null?void 0:s.discount_level}}:{values:{...e,discount_level:(l=s==null?void 0:s.estimate)==null?void 0:l.discount_level}})},name:"estimate-form",requiredMark:!1,className:"adjust-tbl-main",initialValues:ze,children:[t.jsx(Ee,{className:"estimate_modal estimate_md_modal",centered:!0,width:1e3,destroyOnClose:!0,footer:!1,style:{top:0},open:R,title:"Add New Address",onCancel:()=>{C(),S(!1),T(!1)},wrapClassName:"generic_modal_style",bodyStyle:{height:"100%"},children:t.jsx(Os,{bool:qe,billing:p,editBill:b,loading:Ze,onSubmit:_s,createBill:We,setEditBill:S,setCreateBill:T,handleCancel:C,setBillLoading:P,url:`contacts/${(n==null?void 0:n.id)||n}/addresses/${_==null?void 0:_.id}`})}),t.jsx(Ee,{className:"estimate_modal estimate_lg_modal",width:1e3,footer:!1,destroyOnClose:!0,style:{top:0},title:"Add Customer",open:q,onCancel:V,centered:!0,children:t.jsx($s,{isModal:!0,isCustomerModalOpen:!0,setIsCustomerId:Ge,setIsCustomerModalOpen:V})}),t.jsxs("div",{className:"main_wrapper container-1280",children:[t.jsx(Ns,{name:D?"Create New Estimate":(se=s==null?void 0:s.estimate)==null?void 0:se.estimate_no}),t.jsxs("div",{className:"_container",children:[t.jsxs(Se,{level:4,className:"form_heading",children:["New Estimate"," "]}),t.jsxs("div",{className:"flexbox form-row-container justify-content-between",children:[t.jsxs("div",{className:"estimate_customer form_group flex-47 ",children:[t.jsx(zs,{allowClear:!0,showButton:!0,size:"large",setTrue:Le,name:"customer_id",setFalse:A,url:Ps,handleAddNew:V,handleChange:Y,placeholder:"Select or Search Customer",label:t.jsxs("label",{children:["Customer ",t.jsx("span",{className:"staric",children:"*"})]})}),n&&t.jsx(w,{type:"link",htmlType:"button",className:"view_detail",btnText:"View details",clickHandler:X})]}),t.jsxs("div",{className:"form_group flex-47 ",children:[_&&t.jsx(vs,{className:"edit_bill",onClick:rs}),t.jsx(c.Item,{label:"Billing Address",name:"billing_address_id",children:t.jsx(Cs,{size:"large",disabled:!n,onChange:us,popupClassName:"item_dropdown",placeholder:"Select billing address",options:p==null?void 0:p.map(e=>({label:Q(e),value:e==null?void 0:e.id})),dropdownRender:e=>t.jsxs(t.Fragment,{children:[t.jsx(w,{icon:t.jsx(Es,{size:25}),type:"text",size:"small",btnText:"Add new",clickHandler:cs,className:"btn-form-size btn-primary d-flex justify-center align-center w-100"}),e]})})}),t.jsx("span",{className:"bill_address_detail",children:_?Q(_):""})]}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(c.Item,{name:"customer_email",label:t.jsx("label",{children:"Email"}),children:t.jsx(Me,{children:a.getFieldValue("customer_email")})})}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(Te,{showButton:!0,loading:!1,options:v,name:"payment_terms",className:"flex_root",handleAddNew:H,label:g.PAYMENT_TERMS,placeholder:z.payment_terms})}),t.jsx(c.Item,{name:"estimate_no",label:t.jsx("label",{children:g.ESTIMATE_NO}),children:t.jsx(Me,{children:a.getFieldValue("estimate_no")})}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(Ss,{size:"large",name:"reference",label:g.REFERENCE_NO})}),t.jsxs("div",{className:"form_group flex-47 ",children:[t.jsxs("label",{children:["Estimate Date ",t.jsx("span",{className:"staric",children:"*"})]}),t.jsx(we,{isRequired:!0,size:"large",name:"estimate_date",disableDate:e=>e&&e<N(x).startOf("day"),onChange:e=>{a.setFieldsValue({expiry_date:e.add(Number($),k)})},format:M})]}),t.jsxs("div",{className:"form_group flex-47 ",children:[t.jsx("label",{children:"Expiry Date"}),t.jsx(we,{name:"expiry_date",size:"large",disableDate:e=>e&&e<N(is).startOf("day"),format:M})]}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(Te,{loading:!1,className:"flex_root",options:ts,name:"sales_person_id",label:g.SALESPERSON,placeholder:z.select_salesperson})}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(c.Item,{label:g.NOTES,name:"customer_note",className:"flex_root",children:t.jsx(Fe,{showCount:!0,maxLength:255,rows:4,placeholder:Ls})})}),t.jsx("div",{className:"form_group flex-47 ",children:t.jsx(c.Item,{className:"flex_root",name:"terms_and_condition",label:g.TERMS_AND_CONDITIONS,children:t.jsx(Fe,{showCount:!0,rows:4,maxLength:255})})})]}),t.jsxs(Se,{level:4,className:"form_heading",children:["Select Product/Services"," "]}),t.jsx("div",{className:"generic-table estimate-table",children:t.jsx(Ds,{sales:!0,showButton:!0,taxes:Ke,itemList:Re,itemUrl:"/estimates",url:Us,ModuleName:"Estimate",warehouses:es,adjustment:as,customer_id:n,totalAmount:I,handleItemList:Ve,setTotalAmount:Ue,discount_level:ls||((te=s==null?void 0:s.estimate)==null?void 0:te.discount_level),shipping_charge:ns,handleWarehouseId:Oe,currency:(le=s==null?void 0:s.base_currency)==null?void 0:le.symbol,handlePrimaryWarehouse:L,edit:s&&Object.keys(s).length,transection_level_discount:os,transsection_level_discount_type:ms})}),t.jsxs("div",{className:"button_flexbox flex-end ",children:[t.jsx(w,{type:"default",btnText:"Cancel",htmlType:"button",className:"btn-default btn-form-size cate_cancel_btn",clickHandler:()=>De(Rs)}),t.jsxs("div",{className:"d-flex align-center new_prod_btn",children:[t.jsx(w,{block:!0,loading:Be,disabled:!((ae=F[0])!=null&&ae.id),btnText:((ie=s==null?void 0:s.estimate)==null?void 0:ie.status)==="sent"?"Update as draft":g.SAVE,className:"btn-primary btn-form-size"}),t.jsx(Ts,{placement:"top",trigger:["click"],disabled:!((ne=F[0])!=null&&ne.id),menu:{items:xs},className:"h-36px p-5  icon-radius",children:t.jsx(ws,{size:25,className:`${(oe=F[0])!=null&&oe.id?"btn-primary":"disabled-svg"}`})})]})]})]})]})]})]})})};export{Js as E};
