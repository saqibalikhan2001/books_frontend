import{u as ee,r as g,O as ie,G as se,j as e,S as te,V as oe,ap as L,y as ce,J as ae,aa as F,t as xe,al as Y,$ as o,a4 as l,ay as Z,f as ue,T as j,I as de,l as w,P as me,n as ne,p as fe,o as le,U as he,an as je,H as ge,cf as be,i as pe,v as _e,cH as ye,z as Le}from"./index-4b3d7bc8.js";import{g as Se}from"./calculation-671db1b1.js";import{c as B}from"./capitalize-cfd5966b.js";import{u as re}from"./usePermissions-36032956.js";import{A as Ie}from"./ActionMenu-149e95aa.js";import{u as Re}from"./useSearchParam-ebfda256.js";import{u as Te}from"./useDetailPageProps-fa80b790.js";import{u as ve}from"./usePersistItemDetail-b111bdde.js";import{A as Ce}from"./index-9f4b88aa.js";import{A as De}from"./AccessDenied-45b92511.js";const{VscClose:ke}=de,{Title:h,Text:S}=j,{RECURRING_BILL:Be}=w,Ee=({detail:i,deleteItem:b,dataLength:p=0,handleFullScreen:d})=>{var n,_,a,C,r,y,E,D,P,z,A,N,x,M,$,G,O,U,H,V,q,X,J,K,Q,W;const{callAxios:I}=ee(),[R,T]=g.useState(!0),{curr_id:m}=JSON.parse(ie("obj")),[s,f]=g.useState(),{bool:c}=se();g.useEffect(()=>{var t;(!b||b&&p>1)&&((t=s==null?void 0:s.bill_info)==null?void 0:t.id)!==m&&I({url:`${Be}/${m||(i==null?void 0:i.id)}`}).then(u=>{f(u),T(!1)})},[i==null?void 0:i.id,c,b,p,m]);const v=g.useMemo(()=>[{title:"Items",dataIndex:"",width:130,ellipsis:!0,render:t=>e.jsxs(te,{children:[e.jsx(oe,{style:{width:30},onClick:u=>u.stopPropagation(),src:"https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png",fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png"}),e.jsx(S,{children:t.item_name})]})},{title:"Warehouse",dataIndex:"warehouses",width:80,ellipsis:!0,render:t=>e.jsx(S,{children:t==null?void 0:t.name})},{title:"Qty",dataIndex:"quantity",width:30,ellipsis:!0},{title:"Price",dataIndex:"rate",width:50,ellipsis:!0,render:t=>{var u;return e.jsx(L,{value:t||0,valueStyle:{fontSize:"13px"},prefix:(u=s==null?void 0:s.base_currency)==null?void 0:u.symbol})}},{title:"Amount",dataIndex:"amount",width:50,ellipsis:!0,render:t=>{var u;return e.jsx(L,{value:t||0,valueStyle:{fontSize:"13px"},prefix:(u=s==null?void 0:s.base_currency)==null?void 0:u.symbol})}}],[(n=s==null?void 0:s.base_currency)==null?void 0:n.symbol]);return e.jsx(e.Fragment,{children:R?e.jsx(ce,{}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:B((_=s==null?void 0:s.bill_info)==null?void 0:_.profile_name),subTitle:e.jsx(F,{color:((a=s==null?void 0:s.bill_info)==null?void 0:a.status)==="draft"?"red":"green",children:B((C=s==null?void 0:s.bill_info)==null?void 0:C.status)}),extra:[e.jsx(ke,{size:20,onClick:()=>xe(d)},"close")]}),e.jsx(Y,{}),e.jsxs(o,{children:[e.jsxs(l,{offset:1,children:[e.jsx(h,{level:4,style:{color:"green"},children:"Recurring BILL DETAILS"}),e.jsx(h,{level:5,children:(y=(r=s==null?void 0:s.bill_info)==null?void 0:r.vendor)==null?void 0:y.display_name}),e.jsxs(h,{level:5,children:["Bill No. ",(E=s==null?void 0:s.bill_info)==null?void 0:E.bill_no]}),e.jsx(F,{color:((D=s==null?void 0:s.bill_info)==null?void 0:D.status)==="draft"?"red":"green",children:B((P=s==null?void 0:s.bill_info)==null?void 0:P.status)})]}),e.jsxs(l,{offset:5,span:10,children:[e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(h,{level:5,style:{marginTop:0},children:"Start Date"})}),e.jsx(l,{style:{paddingLeft:"143px"},children:e.jsx(S,{children:Z((z=s==null?void 0:s.bill_info)==null?void 0:z.start_date)})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(h,{level:5,style:{marginTop:0},children:"End Date"})}),e.jsx(l,{style:{paddingLeft:"148px"},children:e.jsx(S,{children:Z((A=s==null?void 0:s.bill_info)==null?void 0:A.end_date)})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(h,{level:5,style:{marginTop:0},children:"Created By"})}),e.jsx(l,{style:{paddingLeft:"138px"},children:e.jsx(S,{children:B((x=(N=s==null?void 0:s.bill_info)==null?void 0:N.bill_created_by)==null?void 0:x.name)})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(h,{level:5,style:{marginTop:0},children:"Total"})}),e.jsx(l,{style:{paddingLeft:"180px"},children:e.jsx(S,{children:(M=s==null?void 0:s.bill_info)==null?void 0:M.total})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(h,{level:5,style:{marginTop:0},children:"Balance Due"})}),e.jsx(l,{style:{paddingLeft:"130px"},children:e.jsx(S,{children:($=s==null?void 0:s.bill_info)==null?void 0:$.balance_due})})]})]})]}),e.jsx(o,{children:e.jsx(l,{offset:1,children:e.jsx(ue,{bordered:!0,rowKey:"id",pagination:!1,columns:v,style:{marginTop:"8px"},dataSource:(G=s==null?void 0:s.bill_info)==null?void 0:G.bill_item_details})})}),e.jsx(o,{style:{paddingTop:"10px"},children:e.jsx(l,{offset:16,children:e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx(j,{children:"Sub Total"}),e.jsx(j,{children:"Adjustment"}),e.jsx(j,{children:"Total"}),e.jsx(j,{children:"Payment Made"})]}),e.jsxs(l,{children:[e.jsx(L,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},prefix:(O=s==null?void 0:s.base_currency)==null?void 0:O.symbol,value:Se((U=s==null?void 0:s.bill_info)==null?void 0:U.bill_item_details)||0}),e.jsx(L,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},prefix:(H=s==null?void 0:s.base_currency)==null?void 0:H.symbol,value:((V=s==null?void 0:s.bill_info)==null?void 0:V.adjustment)||0}),e.jsx(L,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},value:((q=s==null?void 0:s.bill_info)==null?void 0:q.total)||0,prefix:(X=s==null?void 0:s.base_currency)==null?void 0:X.symbol}),e.jsx(L,{style:{paddingLeft:"95px"},valueStyle:{fontSize:"15px"},value:((J=s==null?void 0:s.bill_info)==null?void 0:J.total)||0,prefix:(K=s==null?void 0:s.base_currency)==null?void 0:K.symbol})]})]})})}),e.jsx(Y,{}),e.jsxs(o,{children:[e.jsx(l,{offset:16,children:e.jsx(j,{children:"Balance Due"})}),e.jsx(l,{offset:3,children:e.jsx(L,{value:(Q=s==null?void 0:s.bill_info)==null?void 0:Q.balance_due,prefix:(W=s==null?void 0:s.base_currency)==null?void 0:W.symbol,valueStyle:{fontSize:15,paddingLeft:23}})})]})]})})},{NEW_RECURRING_BILL:Pe}=ne,{all_recurring_bills:ze}=fe,{ADD_RECURRING_BILL:Ae}=le,Ne=({enable:i=!1})=>e.jsx(e.Fragment,{children:e.jsx(me.SubHeader,{enabled:i,title:ze,btnText:Pe,navigateTo:Ae})}),{Text:Fe}=j,{RECURRING_BILL:we}=w,{NAME:k,CODE:Me,DELETE:$e,BILLS:Ge}=ne,Oe=({refetch:i,loading:b,listing:p,showDetail:d,handleClick:I,handleConfirm:R,bulkDeleteTrue:T,handleViewClick:m})=>{const{checkPermission:s}=re(),{org_date_format:f}=he(),{has_RecurringBillsDelete_permission:c}=s("RecurringBillsDelete"),v=g.useMemo(()=>[{title:"Vendor",dataIndex:"display_name",width:150,key:k,ellipsis:!0},{title:"Profile Name",dataIndex:"profile_name",key:k,width:120,ellipsis:!0},{title:"Frequency",dataIndex:"repeat_duration",key:k,width:120,ellipsis:!0},{title:"Next Bill Date",dataIndex:"next_recurring_bills_date",key:k,width:d?0:150,ellipsis:!0,render:n=>je(n,f)},{title:"Status",dataIndex:"status",key:k,ellipsis:!0,width:d?0:100,render:n=>e.jsx(F,{autoCapitalize:"",color:n==="draft"?"red":"green",children:B(n)},n)},{title:"Amount",dataIndex:"",key:Me,width:d?0:150,ellipsis:!0,render:n=>{var _,a;return e.jsxs(j,{children:[e.jsx(ge,{placement:"topLeft",title:(_=n==null?void 0:n.currency)==null?void 0:_.name,children:e.jsx(Fe,{code:!0,children:(a=n==null?void 0:n.currency)==null?void 0:a.symbol})}),`${n.total}`]})}},{title:"",dataIndex:"",width:50,key:"x",align:"center",render:n=>e.jsx(Ie,{data:n,handleClick:I,handleConfirm:R,canEdit:n.platform_type==="books",deletePermission:n.platform_type==="books"?c:!1,title:n.platform_type==="books"&&c?`${$e} ${Ge} ?`:"Permission Denied"})}],[I,R,c,d]);return e.jsx(e.Fragment,{children:e.jsx(be,{refetch:i,loading:b,listing:p,url:we,columns:v,bulkDeleteTrue:T,handleViewClick:m})})},{RECURRING_BILL:Ue}=w,{EDIT_RECURRING_BILL:He}=le,ss=()=>{const i=pe(),{bool:b,handleConfirm:p}=ee(),{checkPermission:d}=re(),{getParams:I}=Re(""),{getCurrentModule:R,checkModulePermission:T}=_e(),{status:m=void 0}=R("bills")||{},{has_RecurringBillsView_permission:s}=d("RecurringBillsView"),{bool:f,setTrue:c,setFalse:v}=se(),{memoizeHandleClick:n,detail:_,fullScreen:a,handleFullScreen:C}=Te(),{data:r,refetch:y,isLoading:E,isFetching:D}=ye(I(),{refetchOnMountOrArgChange:!0,skip:!s||T("bills")}),{handleSessionState:P}=ve(C,v,f);g.useEffect(()=>{!D&&f&&P(r==null?void 0:r.recurring_bills,"recurringbills")},[D,f,r==null?void 0:r.recurring_bills]);const z=x=>{Le(x==null?void 0:x.id,!0,"recurringbills"),i(`${He}?id=${x.id}`)},A=g.useCallback(z,[i]),N=g.useCallback(x=>p(x,Ue,y,c),[p,y,c]);return e.jsx(e.Fragment,{children:s?e.jsxs(e.Fragment,{children:[!m&&e.jsx(Ce,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),e.jsx(Ne,{enable:!m}),e.jsxs(o,{children:[e.jsx(l,{span:a?10:24,children:(r==null?void 0:r.recurring_bills)&&e.jsx(Oe,{refetch:y,showDetail:a,handleClick:A,bulkDeleteTrue:c,loading:b||E,handleConfirm:N,listing:r.recurring_bills,handleViewClick:n})}),a&&e.jsx(e.Fragment,{children:e.jsx(l,{span:14,children:(r==null?void 0:r.recurring_bills)&&e.jsx(Ee,{detail:_,refetchBills:y,deleteItem:f,handleFullScreen:C,dataLength:r.recurring_bills.data.length})})})]})]}):e.jsx(De,{})})};export{ss as default};
