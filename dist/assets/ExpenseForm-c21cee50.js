import{F as t,j as e,E as i,D as d,A as h,H as B,s as P,$ as p,a4 as a,cL as S,T as k,I as W,i as L,ai as R,r as V,aj as q,C as A,cz as U,S as H,B as $,o as O}from"./index-4b3d7bc8.js";import{k as X,l as G,m as J,n as K}from"./calculation-671db1b1.js";import{m as M}from"./index-76e73ee7.js";import{U as Q}from"./index-b8658cbe.js";const{Text:Y,Title:C}=k,{RiDeleteBinLine:Z,VscAdd:ee}=W,se=({tags:m,form:j,taxes:g,categories:n})=>{const _=t.useWatch("tax_inclusive",j),y=t.useWatch("expense_details",j),b=X(y),f=G(y,g,_);return e.jsx(e.Fragment,{children:e.jsxs("table",{style:{width:"100%",borderSpacing:0,border:"1px solid #ddd",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#d9d9d929"},children:[e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Tags"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Category"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Description"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Tax"}),e.jsx("th",{style:{textAlign:"left",padding:"8px"},children:"Amount"})]})}),e.jsx(t.List,{name:"expense_details",children:(l,{add:v,remove:z})=>e.jsxs(e.Fragment,{children:[l.map(({key:r,name:c,...u})=>e.jsx("tbody",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(0, 0, 0, 0.06)"},children:[e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"20%"},children:e.jsx("div",{style:{display:"flex"},children:m==null?void 0:m.map((s,o)=>e.jsx(e.Fragment,{children:e.jsx(i,{label:s.name,className:"flex_root",placeholder:"Select Tags",options:s.tag_details,name:[`${c}`,"expense_tags",`${o}`],rules:s.mandatory?d({message:`Select ${s==null?void 0:s.name}`}):[]})}))})}),e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"15%"},children:e.jsx(i,{...u,size:"large",label:"Category",options:n,className:"flex_root",placeholder:"Select Catgeory",name:[`${c}`,"category_id"],rules:[{required:!0,message:"please select category"}]})}),e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"20%"},children:e.jsx(h,{size:"large",label:"Description",placeholder:"Description",name:[`${c}`,"description"]})}),e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"20%"},children:e.jsx(i,{label:"Tax",...u,size:"large",options:g,className:"flex_root",name:[`${c}`,"tax_id"],placeholder:"Select Catgeory"})}),e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"20%"},children:e.jsx(h,{size:"large",type:"number",label:"Amount",name:[`${c}`,"amount"],rules:[{required:!0,message:"please enter amount"}]})}),e.jsx("td",{style:{textAlign:"left",padding:"8px",width:"5%"},children:e.jsx(B,{title:"Delete",children:e.jsx(P,{shape:"circle",onClick:()=>z(c),icon:e.jsx(Z,{size:14,color:"red"})})})})]})})),e.jsx(t.Item,{children:e.jsxs(Y,{onClick:()=>v(),style:{color:"blue",cursor:"pointer"},children:[e.jsx(ee,{color:"blue"})," Add Another Line"]})}),e.jsxs(p,{children:[e.jsx(a,{span:12,children:e.jsx(C,{level:4,children:"Sub Total ($)"})}),e.jsx(a,{span:12,children:e.jsx(C,{level:4,children:b})})]}),e.jsx(S,{size:"small",dataSource:f,renderItem:r=>e.jsxs(p,{children:[e.jsx(a,{span:12,children:e.jsx(S.Item,{children:r==null?void 0:r.label})}),e.jsx(a,{span:12,children:e.jsx(S.Item,{children:r!=null&&r.value?`${r==null?void 0:r.value}`:""})})]},r==null?void 0:r.label)}),e.jsxs(p,{children:[e.jsx(a,{span:15,children:e.jsx(C,{level:4,children:"Expense Total($)"})}),e.jsx(a,{span:9,children:e.jsx(C,{level:4,children:J(b,f,_)})})]})]})})]})})},{EXPENSE:le}=O,{AiOutlineInbox:te}=W,ne={date:"",tax_id:"",tag_id:"",report_id:"",itemize:!1,billable:!1,description:"",ref_number:null,merchant_id:null,currency_id:null,total_amount:null,tax_inclusive:!1,payment_mode_id:null,paid_through_id:null,claim_reimbursement:!0,expense_details:[{category_id:null,description:"",tax_id:"",amount:null,tag_id:""},{category_id:null,description:"",tax_id:"",amount:null,tag_id:""}],tax_type:"exclusive",total_expense:""},oe=({loading:m,url:j,onSubmit:g})=>{var u;const[n]=t.useForm(),_=L(),y=t.useWatch("tax_id",n),b=t.useWatch("total_amount",n),f=t.useWatch("tax_inclusive",n),{details:l,customers:v,vendors:z}=R(j,!0),r=()=>{_(le)};V.useEffect(()=>{if(l&&l.expense){const s=c(l.expense);n.setFieldsValue(s)}},[l,n]);const c=s=>{var N,F;let o=[],T=[],E={...s,date:M(s==null?void 0:s.date),itemize:(s==null?void 0:s.itemize)!==0,billable:(s==null?void 0:s.billable)!==0,is_personal:(s==null?void 0:s.is_personal)!==0,claim_reimbursement:(s==null?void 0:s.claim_reimbursement)!==0,total_amount:s==null?void 0:s.amount};return(s==null?void 0:s.itemize)!==0?T=s==null?void 0:s.expense_details.map(x=>{var I;let D=[];return D=(I=x==null?void 0:x.expense_tags)==null?void 0:I.map(w=>w.tag_details_id),{...x,expense_tags:D}}):((N=s==null?void 0:s.expense_tags)==null?void 0:N.length)>0&&(o=(F=s==null?void 0:s.expense_tags)==null?void 0:F.map(x=>x.tag_details_id)),{...E,expense_details:T,expense_tags:o}};return e.jsx(e.Fragment,{children:e.jsxs(t,{form:n,layout:"vertical",autoComplete:"off",name:"expense-form",onFinish:g,initialValues:ne,children:[e.jsxs(p,{children:[e.jsx(a,{span:8,children:e.jsx(t.Item,{style:{width:"350px",margin:"0 auto"},children:e.jsx(t.Item,{noStyle:!0,name:"dragger",valuePropName:"fileList",children:e.jsxs(Q.Dragger,{name:"files",action:"/upload.do",children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(te,{size:25})}),e.jsx("p",{className:"ant-upload-text",children:"Click here to Upload File"}),e.jsx("p",{className:"ant-upload-hint",children:"Browse File/ Drag here"})]})})})}),e.jsxs(a,{span:15,children:[e.jsx(q,{name:"date",isRequired:!0,label:"Expense Date"}),e.jsx(i,{label:"Vendor",name:"vendor_id",options:z,className:"flex_root",placeholder:"Select Vendor"}),e.jsx(i,{label:"Customer",name:"customer_id",options:v,className:"flex_root",placeholder:"Select Customer"}),!t.useWatch("itemize",n)&&e.jsx(i,{label:"Category",name:"category_id",className:"flex_root",placeholder:"Select Category",options:l==null?void 0:l.expense_categories,rules:d({message:"Select Category"})}),e.jsx(p,{children:e.jsx(a,{span:2,children:e.jsx(t.Item,{name:"itemize",valuePropName:"checked",children:e.jsx(A,{children:"Itemize"})})})}),e.jsx(p,{children:e.jsx(a,{span:24,children:t.useWatch("itemize",n)?e.jsx(i,{label:"Currency",name:"currency_id",className:"flex_root",placeholder:"Select Currency",options:l==null?void 0:l.currencies,rules:d({message:"Select Currency"})}):e.jsx(h,{label:"Amount",name:"total_amount",rules:d({message:"Select Amount"}),addonBefore:e.jsx(i,{size:"small",allowClear:!1,name:"currency_id",placeholder:"Select Currency",options:l==null?void 0:l.currencies,rules:d({message:"Select Currency"})})})})}),e.jsx(U,{name:"tax_inclusive",disabled:!0,label:"Tax Inclusive"}),!t.useWatch("itemize",n)&&e.jsx(k.Text,{type:"secondary",children:`| Tax Amount = ${K(y,l.taxes,b,f)}`}),t.useWatch("itemize",n)&&e.jsx(se,{form:n,tags:l.tags,taxes:l.taxes,categories:l.expense_categories}),e.jsx(t.Item,{name:"claim_reimbursement",valuePropName:"checked",children:e.jsx(A,{children:"Claim reimbursement"})}),!t.useWatch("claim_reimbursement",n)&&e.jsx(i,{placeholder:"Select",className:"flex_root",label:"Payment through",name:"payment_through_id",options:l==null?void 0:l.paid_through_accounts}),!t.useWatch("itemize",n)&&e.jsx(h,{size:"large",name:"description",label:"Description"}),!t.useWatch("itemize",n)&&e.jsx(i,{size:"large",name:"tax_id",label:"Tax",options:l==null?void 0:l.taxes}),e.jsx(t.Item,{name:"billable",valuePropName:"checked",children:e.jsx(A,{children:"Billable"})}),e.jsx(h,{size:"middle",name:"ref_number",label:"Reference#"}),!t.useWatch("itemize",n)&&((u=l.tags)==null?void 0:u.map((s,o)=>e.jsx(e.Fragment,{children:e.jsx(i,{label:s.name,className:"flex_root",placeholder:"Select Tags",options:s.tag_details,name:["expense_tags",`${o}`],rules:s.mandatory?d({message:`Select ${s.name}`}):[]})})))]})]}),e.jsxs(H,{style:{paddingLeft:"30px"},children:[e.jsx($,{btnText:"Save",loading:m}),e.jsx($,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:r})]})]})})};export{oe as E};
