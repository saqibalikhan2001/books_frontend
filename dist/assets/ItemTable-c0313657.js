import{j as a,c8 as Q,V as M,W as B,f as S,u as Ea,r as _,U as Ma,c6 as Ba,c9 as Ha,az as H,B as U,c7 as Pa,ca as Ka,bU as K,ap as V,a3 as Ga,s as pe,M as ke,cb as Ua,cc as Va,aJ as Qa,p as Ya,T as R,H as Je,cd as Xe,F as ge,n as we,bc as Ze,I as Ja,Y as Xa}from"./index-4b3d7bc8.js";import{D as Za,C as Oa,P as La}from"./react-beautiful-dnd.esm-fdc0d50f.js";import Wa from"./Create-8edeb959.js";import{C as es}from"./Create-93e4462e.js";import{c as as,d as We,e as ea,f as Ce,h as ss,i as ae}from"./calculation-671db1b1.js";import{I as ls}from"./itemDetailModal-4a763e01.js";import{u as ts}from"./usePermissions-36032956.js";const ns=(h,x,w,r)=>h.map(c=>{var D,q,Y,g;return{...c,unique_id:c==null?void 0:c.id,id:c.item_id,item_obj:{key:`${Math.random()}`,value:c==null?void 0:c.item_id,label:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:(q=(D=c==null?void 0:c.item)==null?void 0:D.images)!=null&&q.length?B((Y=c==null?void 0:c.item)==null?void 0:Y.images[0],w):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsxs("span",{className:"product_name",children:[" ",c.item_name," "]})]},extra_description:c.extra_description,label:c.item_name,item_name:c.item_name,tax_amount:c.tax_amount,discount_type:c.discount_type,discount_item_level:c.discount_item_level,warehouse_id:x||c.warehouse_id,rate:c.rate??c.purchase_order_item_unit_price,tax_id:c.tax_id||c.purchase_order_item_tax_id,account_id:c.account_id||c.purchase_order_item_account_id,tax_rate:c.tax?c.tax.rate:r!=null&&r.length?(g=r==null?void 0:r.find(J=>(J==null?void 0:J.id)===(c==null?void 0:c.purchase_order_item_tax_id)))==null?void 0:g.rate:null,total:c.rate*c.quantity,item_total_amount:c.rate*c.quantity,quantity:c.quantity||c.remaining_quantity||c.quantity_billable_without_received}}),ds=({isDataSource:h,currency:x})=>{const w=[{title:"Items",dataIndex:"item_name",key:"items"},{title:"Amount",dataIndex:"",key:"amount",render:r=>`${x}${(r.rate*r.quantity).toFixed(2)}`},{title:"Discount",dataIndex:"",key:"discount",render:r=>r.discount_type==="percent"?`${x}${(r.total*parseFloat(r.discount_item_level)/100).toFixed(2)} @ ${r.discount_item_level}%`:`${x}${parseFloat(r.discount_item_level).toFixed(2)}`},{title:"Tax",key:"tax",dataIndex:"",render:r=>r.tax_name?a.jsx("span",{className:"estimate_tax_detail",children:` ${x}${(r.total*parseFloat(r.tax_rate)/100).toFixed(2)} @ ${r.tax_name}[${r.tax_rate}%] `}):a.jsxs("span",{children:[x,"0.00"]})},{title:"Final Amount",key:"final amount",dataIndex:"",render:r=>`${x}${ss(r)}`}];return a.jsx("div",{className:"generic_modal",children:a.jsx(S,{className:"generic-table tax_table",columns:w,dataSource:h.filter(r=>r.id),pagination:!1,summary:()=>a.jsxs(S.Summary.Row,{children:[a.jsx(S.Summary.Cell,{index:0,className:"font-bold",children:"Total"}),a.jsx(S.Summary.Cell,{className:"text-right",index:1,children:`${x}${as(h)} `}),a.jsx(S.Summary.Cell,{className:"text-right",index:2,children:`${x}${We(h)} `}),a.jsx(S.Summary.Cell,{className:"text-right",index:3,children:`${x}${ea(h)} `}),a.jsx(S.Summary.Cell,{className:"text-right",index:4,children:`${x}${Ce(h).toFixed(2)} `})]})})})},{Option:I,OptGroup:Oe}=H,{RxCross2:cs,BiTrash:rs,BsPlus:Le}=Ja,{NAME:is,CODE:E,YES:us,NO:xs,DELETE:_s}=we,vs=({edit:h,sales:x,current:w,url:r="",taxes:C=[],ModuleName:c,customer_id:D,itemUrl:q="",totalAmount:Y,currency:g="",purchaseOrder:J,itemList:X=[],setTotalAmount:se,handleItemList:k,discount_level:le,adjustment:Z=0,warehouses:te=[],PO_Warehouse_Id:aa,isModal:b=!1,handleWarehouseId:fe,showButton:$e=!1,shipping_charge:z=0,purchaseAccount:sa=[],handlePrimaryWarehouse:T,transection_level_discount:ne,transsection_level_discount_type:je})=>{var Pe;const{callAxios:O}=Ea();let[de,ce]=_.useState(1);const{created_by_platform:A}=Ma(),[u,Ie]=_.useState(),[be,L]=_.useState(0),[la,re]=_.useState(1),{checkPermission:ta}=ts(),[y,Se]=_.useState(),[na,da]=_.useState(),[Te,ca]=_.useState(!1),[N,W]=_.useState(),[De,ra]=_.useState(!1),[qe,ia]=_.useState(!1),[ie,ua]=_.useState(!1),[ee,ze]=_.useState([]),[Ae,xa]=_.useState(!1),[Fe,_a]=_.useState(!1),[ma,ue]=_.useState(!1),[o,$]=_.useState([]),[G,F]=_.useState([]),{has_TaxCreate_permission:ha}=ta("TaxCreate"),{fetching:ye,options:xe,handleScroll:ga,debounceFetcher:fa,hasContentLoading:ja,handleOptionDeselect:ba}=Ba(r,!0),[i,f]=_.useState([{rate:0,id:null,key:"0",total:"",quantity:1,tax_rate:0,tax_id:null,tax_amount:0,item_name:"",label:"",item_obj:null,account_id:null,warehouse_id:null,extra_description:"",discount_item_level:0,discount_type:"percent",item_total_amount:0}]),_e={key:`${la}`,id:null,item_name:"",quantity:1,tax_rate:0,tax_id:null,tax_amount:0,label:"",item_obj:null,rate:0,discount_type:"percent",discount_item_level:0,warehouse_id:null,account_id:null,extra_description:"",total:"",item_total_amount:0},ya=()=>{f([{key:"0",id:null,item_name:"",label:"",item_obj:null,quantity:0,tax_rate:0,tax_id:null,tax_amount:0,rate:0,discount_item_level:0,warehouse_id:null,account_id:null,extra_description:"",total:"",item_total_amount:0}]),oe()};_.useEffect(()=>{if(X!=null&&X.length){const e=ns(X,aa,A,C);k(e),f(b?[...e].map((l,n)=>({...l,key:`${n}`})):[...e,_e].map((l,n)=>({...l,key:`${n}`}))),L(ae(e)),re(b?e.length:e.length+1)}},[X]),_.useEffect(()=>{if(Z||z||h||je||ne)if(le==="transaction")if(je==="percent"){let e=be*+ne/100;se(+Z+ +(z&&z)+e)}else{let e=be-+ne;se(+Z+ +(z&&z)+e)}else se(+Z+ +(z&&z)+Ce(i));else se(Ce(i))},[i,Z,z,ne,je]),_.useEffect(()=>{ie&&(ue(!0),O({url:`${q}/items?page=${de}&view=20&search=`}).then(e=>{W(e),ce(de+1),ue(!1)}))},[ie]),_.useEffect(()=>{u!=null&&u.id&&Be(u==null?void 0:u.id,u==null?void 0:u.index,"createNew")},[u==null?void 0:u.id]),_.useEffect(()=>{y!=null&&y.id&&Ee(y,y==null?void 0:y.row,y==null?void 0:y.index)},[y==null?void 0:y.id]);const oe=()=>ra(!De),ve=()=>ia(!qe),Re=()=>_a(!Fe),Ne=()=>xa(!Ae),Ee=(e,l,n)=>{var d,m,p;const t=te.find(j=>j.is_primary)||{};T==null||T(t.id);const s=[...i];s[n]={...s[n],discount_type:"percent",key:`${n}`,id:e==null?void 0:e.id,label:e==null?void 0:e.name,item_obj:{key:`${Math.random()}`,value:e==null?void 0:e.id,label:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:(d=e==null?void 0:e.images)!=null&&d.length?B(e==null?void 0:e.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsxs("span",{className:"product_name",children:[" ",e==null?void 0:e.label," "]})]},extra_description:e==null?void 0:e.description,quantity:l.quantity,discount_item_level:0,item_name:e==null?void 0:e.name,tax_id:((m=e==null?void 0:e.tax)==null?void 0:m.id)??null,tax_rate:((p=e==null?void 0:e.tax)==null?void 0:p.rate)??0,warehouse_id:t.id,account_id:(e==null?void 0:e.purchase_account_id)??null,rate:x?e==null?void 0:e.sales_unit_price:(e==null?void 0:e.purchase_unit_price)??0,total:(x?e==null?void 0:e.sales_unit_price:e==null?void 0:e.purchase_unit_price)*l.quantity,item_total_amount:(x?e==null?void 0:e.sales_unit_price:e==null?void 0:e.purchase_unit_price)*l.quantity},e!=null&&e.value&&l.id!==null?f(s):f([...s,_e]),L(ae(s)),k(s),re(j=>j+1)},oa=(e,l,n)=>{var m,p,j,v,Ke,Ge,Ue,Ve,Qe,Ye;const t=te.find(P=>P.is_primary)||{};T==null||T(t.id);const s=[...i];s[n]={...s[n],discount_type:e==null?void 0:e.discount_type,key:`${n}`,id:(m=e==null?void 0:e.item)==null?void 0:m.id,label:(p=e==null?void 0:e.item)==null?void 0:p.name,item_obj:{key:`${Math.random()}`,value:(j=e==null?void 0:e.item)==null?void 0:j.id,label:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:(Ke=(v=e==null?void 0:e.item)==null?void 0:v.images)!=null&&Ke.length?B((Ge=e==null?void 0:e.item)==null?void 0:Ge.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsx("span",{className:"product_name",children:(Ue=e==null?void 0:e.item)==null?void 0:Ue.name})]},extra_description:e==null?void 0:e.extra_description,quantity:e.quantity,discount_item_level:e==null?void 0:e.discount_item_level,item_name:(Ve=e==null?void 0:e.item)==null?void 0:Ve.name,tax_id:((Qe=e==null?void 0:e.tax)==null?void 0:Qe.id)??null,tax_rate:((Ye=e==null?void 0:e.tax)==null?void 0:Ye.rate)??0,warehouse_id:(e==null?void 0:e.warehouse_id)??t.id,account_id:e==null?void 0:e.purchase_account_id,rate:(e==null?void 0:e.rate)??0,total:(e==null?void 0:e.rate)*(e==null?void 0:e.quantity),item_total_amount:(e==null?void 0:e.rate)*(e==null?void 0:e.quantity)};const d=ee.filter(P=>(P==null?void 0:P.unique_id)!==(e==null?void 0:e.unique_id));ze(d),f(s),L(ae(s)),k(s),re(P=>P+1)},Me=(e,l)=>{let n;if(n=i.filter(t=>t.key!==String(e)),b){const t=i.find(s=>(s==null?void 0:s.unique_id)===(l==null?void 0:l.unique_id));ze([...ee,t]),f([...n,_e].map((s,d)=>({...s,key:`${d}`})))}else n.map((t,s)=>({...t,key:`${s}`})),f(n);k(n),L(ae(n))},me=(e,l,n)=>t=>{const s=Number(t),d=[...i];d[l]={...d[l],[n]:s,item_total_amount:n==="quantity"?s*e.rate:n==="rate"?s*e.quantity:e.total,total:n==="quantity"?s*e.rate:n==="rate"?s*e.quantity:e.total},f(d),L(ae(d)),k(d)},Be=(e,l,n)=>{const t=C.find(d=>d.id===e)||{},s=[...i];s[l]={...s[l],tax_id:n==="createNew"?u==null?void 0:u.id:e,tax_rate:n==="createNew"?u==null?void 0:u.rate:t.rate,tax_name:n==="createNew"?u==null?void 0:u.name:t.name},f(s),k(s)},va=e=>l=>{const n=[...i];n[e]={...n[e],account_id:l},f(n),k(n)},Na=(e,l)=>{const n=[...i];n[l.key]={...n[l.key],warehouse_id:e},fe==null||fe(e),f(n),k(n)},pa=e=>l=>{const n=[...i];n[e]={...n[e],discount_type:l},f(n),k(n)},ka=e=>l=>{const n=[...i];n[e]={...n[e],extra_description:l.target.value},f(n),k(n)},He=()=>ca(!Te),wa=e=>{Ie({index:e}),He()},Ca=(e,l)=>{Se({index:l,row:e}),ve()},$a=_.useMemo(()=>[{title:"",dataIndex:"",key:E,width:10,render:()=>a.jsx(Ha,{})},{title:"Product/Service",dataIndex:"item_obj",key:is,width:170,ellipsis:!0,editable:!0,render:(e,l,n)=>a.jsxs("div",{children:[b?a.jsx(H,{placeholder:D?"Click to Select product/service":"Please Select Customer",showSearch:!0,labelInValue:!0,filterOption:!1,value:e,placement:"bottomRight",id:`select_item${n}`,style:{width:b?300:"100%",height:"100%"},onChange:async(t,s)=>{await oa(s==null?void 0:s.dataObject,l,n);const d=document.getElementById(`select_item${n+1}`);setTimeout(()=>{d==null||d.focus()},0)},popupClassName:"item_dropdown",className:`select_item ${l!=null&&l.id?"no-border":"estimate_select_items"}`,disabled:!D,children:ee==null?void 0:ee.map(t=>{var s,d,m,p,j,v;return a.jsxs(I,{dataObject:t,value:(s=t==null?void 0:t.item)==null?void 0:s.id,label:(d=t==null?void 0:t.item)==null?void 0:d.name,children:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:(m=t==null?void 0:t.item)!=null&&m.images.length?B((p=t==null?void 0:t.item)==null?void 0:p.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsxs("div",{className:"product_text_detail",children:[a.jsxs("span",{className:"product_name",children:[" ",(j=t==null?void 0:t.item)==null?void 0:j.name," "]}),a.jsx("span",{className:"product_sku ",children:(v=t==null?void 0:t.item)==null?void 0:v.sku})]})]},`${Math.random()}`)})}):a.jsx(H,{loading:ye,placeholder:D?"Click to Select product/service":"Please Select Customer",showSearch:!0,labelInValue:!0,filterOption:!1,onSearch:fa,value:e,placement:"bottomRight",id:`select_item${n}`,onDropdownVisibleChange:t=>t&&ba(),style:{width:b?300:"100%",height:"100%"},onChange:async(t,s)=>{await Ee(s==null?void 0:s.dataObject,l,n);const d=document.getElementById(`select_item${n+1}`);setTimeout(()=>{d==null||d.focus()},0)},onPopupScroll:ga,popupClassName:"item_dropdown",className:`select_item ${l!=null&&l.id?"no-border":"estimate_select_items"}`,disabled:!D,dropdownRender:t=>ye?a.jsx(a.Fragment,{children:"loading..."}):a.jsxs(a.Fragment,{children:[$e&&a.jsx(U,{icon:a.jsx(Le,{size:25}),btnText:"Add new",clickHandler:()=>Ca(l,n),className:"btn-primary btn-form-size w-100 d-flex align-center justify-center"}),t,ja&&a.jsx("div",{style:{width:"100%",textAlign:"center"},children:a.jsx(Pa,{size:"small",style:{padding:"0 12px"}})})]}),children:xe==null?void 0:xe.map(t=>a.jsxs(I,{dataObject:t,value:t.value,label:t.label,children:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:t!=null&&t.images.length?B(t==null?void 0:t.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsxs("div",{className:"product_text_detail",children:[a.jsxs("span",{className:"product_name",children:[" ",t.label," "]}),a.jsx("span",{className:"product_sku ",children:t.sku})]})]},`${Math.random()}`))}),e&&!b&&a.jsx(U,{type:"link",htmlType:"button",className:"view_detail",btnText:"View details",clickHandler:()=>{Re(),da(e==null?void 0:e.value)}}),e?a.jsx("div",{className:"desc_box mt-20",children:a.jsx(Ka,{onChange:ka(n),value:l==null?void 0:l.extra_description,showCount:!0,rows:4,cols:4,maxLength:255,className:`${(l==null?void 0:l.id)===(e==null?void 0:e.value)}`?"my-text-area":""})}):""]})},{title:"WAREHOUSE",dataIndex:"warehouse_id",key:E,ellipsis:!0,editable:!0,width:80,hidden:J,render:(e,l)=>a.jsx(H,{disabled:b,style:{width:b?120:"100%"},className:`estimate_select ${l!=null&&l.id&&e!==null?"no-border":""}`,placeholder:"Warehouse",value:e,onChange:n=>Na(n,l),children:te.map((n,t)=>a.jsx(I,{value:n.id,children:n.label},t))})},{title:"ACCOUNT",dataIndex:"account_id",key:E,ellipsis:!0,editable:!0,hidden:x,width:70,render:(e,l,n)=>a.jsx("div",{className:"d-flex",children:a.jsx(H,{value:e,onChange:va(n),placeholder:"Select Account",className:`discount_field ${l!=null&&l.id?"no-border":""}`,children:sa.map(({accounts:t,name:s})=>a.jsx(Oe,{label:s,className:"discount_dropdown",children:t.map((d,m)=>a.jsx(I,{value:d.id,children:`${d.title}`},m))},"name"))})})},{title:b?"QTY":"QUANTITY",dataIndex:"quantity",key:E,ellipsis:!0,editable:!0,width:60,render:(e,l,n)=>a.jsx(K,{controls:!1,min:1,name:"quantity",value:parseInt(e),id:`qty_box${l.key}`,className:`qty_box ${l.id&&e!==null?"no-border":""}`,onFocus:()=>{const t=document.getElementById(`qty_box${l.key}`);setTimeout(()=>{t==null||t.select()},10)},onChange:me(l,n,"quantity")})},{title:"RATE",dataIndex:"rate",key:E,ellipsis:!0,editable:!0,width:65,render:(e,l,n)=>a.jsx(K,{stringMode:!0,min:0,name:"rate",step:.01,value:e,precision:2,controls:!1,prefix:a.jsx("span",{style:{lineHeight:"30px"},children:g}),onChange:me(l,n,"rate"),className:`rate_box ${l.id&&e!==null?"no-border":""}`,id:`rate_box${l.key}`,onFocus:()=>{const t=document.getElementById(`rate_box${l.key}`);setTimeout(()=>{t==null||t.select()},10)}})},{title:le==="item"?"Discount":"",dataIndex:"discount_item_level",key:E,ellipsis:!0,editable:!0,width:le==="item"?70:0,render:(e,l,n)=>a.jsxs("div",{style:{display:"flex"},className:"estimate_discount_field",children:[a.jsx(K,{min:0,stringMode:!0,step:.01,size:"middle",precision:2,controls:!1,name:"discount_item_level",value:e,onChange:me(l,n,"discount_item_level"),className:`discount_field ${l.id&&e!==null?"no-border":""}`,id:`discount_field${l.key}`,onFocus:()=>{const t=document.getElementById(`discount_field${l.key}`);setTimeout(()=>{t==null||t.select()},10)}}),a.jsxs(H,{className:`discount_dropdown ${l.id&&e!==null?"no-border":""}`,onChange:pa(n),value:l==null?void 0:l.discount_type,children:[a.jsx(I,{value:"percent",children:"%"}),a.jsx(I,{value:"amount",children:g})]})]})},{title:"TAX",dataIndex:"tax_id",key:E,ellipsis:!0,editable:!0,width:95,render:(e,l,n)=>a.jsx(H,{allowClear:!0,placeholder:"Select Tax",style:{width:b?120:"100%"},className:`estimate_select ${l!=null&&l.id?"no-border":""}`,value:e,onChange:t=>Be(t,n),popupClassName:"item_dropdown",dropdownRender:t=>a.jsxs(a.Fragment,{children:[$e&&a.jsx(U,{icon:a.jsx(Le,{size:25}),btnText:"Add new",clickHandler:()=>wa(n),className:"btn-primary btn-form-size w-100 d-flex align-center justify-center"}),t]}),children:a.jsx(Oe,{label:"Taxes",className:"discount_dropdown",children:u!=null&&u.id?[...C,u].map((t,s)=>!t.isGroup&&a.jsx(I,{value:t.id,children:`${t.name} [${t.rate}%]`},s)):C.map((t,s)=>!t.isGroup&&a.jsx(I,{value:t.id,children:`${t.name} [${t.rate}%]`},s))})})},{title:"AMOUNT",dataIndex:"total",key:E,ellipsis:!0,editable:!0,width:80,render:e=>a.jsx(V,{valueStyle:{fontSize:"14px"},prefix:g,precision:2,value:e||0,className:"text_center no-space"})},{title:"",dataIndex:"",width:b?30:18,key:"x",align:"center",render:(e,l,n)=>a.jsx("div",{className:"del_btn text_center",children:a.jsx(Ga,{okText:us,cancelText:xs,placement:"left",title:`${_s}  Item ?`,disabled:!l.id||(i==null?void 0:i.length)===1,onConfirm:()=>Me(n,e),children:a.jsx(pe,{size:"small",className:"no_btn","aria-disabled":"true",disabled:!l.id||(i==null?void 0:i.length)===1,children:a.jsx(rs,{size:15})},"deletebtn")},"confirm")})}].filter(e=>!e.hidden),[xe,ye,me,Me]),Ia=[{title:"Items",dataIndex:"name",render:(e,l)=>a.jsxs("div",{className:"d-flex bulk_product_inner",children:[a.jsx(M,{preview:!1,src:l!=null&&l.images.length?B(l==null?void 0:l.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{className:"product_title",children:e}),a.jsxs("span",{className:"product_sku",children:[a.jsx("strong",{children:"SKU"}),":",`${l.sku}`]})]})]}),key:"name"},{title:"Price",dataIndex:"sales_unit_price",key:"Price",render:e=>a.jsxs("div",{children:[g,e.toFixed(2)]})}],Sa=[{title:"Selected items",dataIndex:"name",render:(e,l)=>a.jsxs("div",{className:"d-flex bulk_product_inner",children:[a.jsx(M,{preview:!1,src:l!=null&&l.images.length?B(l==null?void 0:l.images[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[a.jsx("span",{className:"product_title",children:e}),a.jsxs("span",{className:"product_sku",children:[a.jsx("strong",{children:"SKU"}),":",`${l.sku}`]})]})]})},{title:"Add quantity",dataIndex:"quantity",render:(e,l,n)=>a.jsx(K,{type:"number",min:1,controls:!1,name:"quantity",value:e,onChange:Ta(n,l)})},{title:"",dataIndex:"",render:(e,l)=>a.jsx(U,{type:"link",btnText:"",icon:a.jsx(cs,{}),clickHandler:()=>qa(e)})}],he=()=>{ce(1),$([]),F([]),ua(!ie)},Ta=(e,l,n)=>t=>{let s=Number(t);const d=[...o];d[e]={...d[e],quantity:n?l.quantity+1:s},$(d)},Da={selectedRowKeys:G,onSelect:(e,l)=>{if(l){$([...o,e]);const t=[...o,e].map(s=>s.id);F(t)}else{const n=[...o],t=n.findIndex(d=>d.id===e.id);n.splice(t,1),$(n);const s=n.map(d=>d.id);F(s)}},hideSelectAll:!0};function qa(e){let l=o.filter(n=>n.id!==e.id);$(l),F(G.filter(n=>n!==(e==null?void 0:e.id)))}const za=()=>{const e=te.find(s=>s.is_primary)||{};T==null||T(e.id),ce(1),$([]),F([]);const l=o.map(s=>{var d,m,p,j,v;return{...s,id:s==null?void 0:s.id,item_name:s==null?void 0:s.name,label:s==null?void 0:s.label,item_obj:{key:`${Math.random()}`,value:s==null?void 0:s.id,label:[a.jsx(Q,{size:"large",src:a.jsx(M,{preview:!1,src:(d=s==null?void 0:s.images)!=null&&d.length?B((m=s==null?void 0:s.images)==null?void 0:m[0],A):"https://s3-us-west-2.amazonaws.com/ims-development/media/image-placeholder.svg"})}),a.jsxs("span",{className:"product_name",children:[" ",s==null?void 0:s.name," "]})]},quantity:s==null?void 0:s.quantity,tax_rate:((p=s==null?void 0:s.tax)==null?void 0:p.rate)??0,tax_id:((j=s==null?void 0:s.tax)==null?void 0:j.id)??null,tax_amount:(v=s==null?void 0:s.tax)==null?void 0:v.rate,discount_item_level:0,discount_type:"percent",rate:x?s==null?void 0:s.sales_unit_price:(s==null?void 0:s.purchase_unit_price)??0,warehouse_id:e==null?void 0:e.id,account_id:x?s==null?void 0:s.sales_account_id:(s==null?void 0:s.purchase_account_id)??null,extra_description:s==null?void 0:s.description,total:x?(s==null?void 0:s.sales_unit_price)*(s==null?void 0:s.quantity):(s==null?void 0:s.purchase_unit_price)*(s==null?void 0:s.quantity),item_total_amount:x?(s==null?void 0:s.sales_unit_price)*(s==null?void 0:s.quantity):(s==null?void 0:s.purchase_unit_price)*(s==null?void 0:s.quantity)}}),n=[...i];i.length&&n.pop();const t=[...n,...l];f([...t,_e].map((s,d)=>({...s,key:`${d}`}))),k(t),re(t==null?void 0:t.length),he()},Aa=()=>{ce(de+1),O({url:`${q}/items?page=${de}&view=20&search=`,method:"get"}).then(e=>{const l={...e,data:[...N.data,...e.data]};W(l)})},Fa=e=>{var s;if(!e.destination||((s=e==null?void 0:e.destination)==null?void 0:s.index)===(i==null?void 0:i.length)-1)return;const l=Array.from(i),[n]=l.splice(e.source.index,1);l.splice(e.destination.index,0,n);const t=l.map((d,m)=>({...d,key:`${m}`}));f([...t]),k(t)},Ra=Xa(e=>{ue(!0);const{value:l}=e.target;O({url:`${q}/items?page=&view=20&search=${l}`,method:"get"}).then(n=>{var s;ue(!1),W(n);let t=n==null?void 0:n.data.find(d=>d.name.toLowerCase()===l.toLowerCase()||d.sku.toLowerCase()===l.toLowerCase());if(t&&((s=n==null?void 0:n.data)==null?void 0:s.length)===1)if(o.some(m=>m.id===t.id)){const m=o.findIndex(v=>v.id===t.id),p=o.find(v=>v.id===t.id),j=[...o];j[m]={...j[m],quantity:p.quantity+1},$(j),e.target.value="",O({url:`${q}/items?page=&view=20`,method:"get"}).then(v=>W(v))}else F([...G,t==null?void 0:t.id]),$([...o,t]),e.target.value="",O({url:`${q}/items?page=&view=20`,method:"get"}).then(m=>W(m))})},500);return a.jsxs(a.Fragment,{children:[a.jsxs(ke,{width:1100,destroyOnClose:!0,title:"Add bulk items",open:ie,centered:!0,footer:!1,onCancel:he,wrapClassName:"generic_modal_style bulk_items_modal",className:"estimate_lg_modal",children:[a.jsx("div",{className:"",style:{margin:"0 50px"},children:a.jsxs("div",{className:"bulk_item_search_box",children:[a.jsx("input",{className:"search_box_input search_box",placeholder:"search items",onChange:Ra}),a.jsx(Ua,{})]})}),a.jsxs("div",{style:{display:"flex",margin:"0 50px",flexWrap:"wrap"},children:[a.jsx("div",{className:"mb-30 table_outer_container",style:{marginRight:10},children:a.jsx("div",{className:"bulk_items_col_one",style:{overflow:"auto"},children:a.jsx(Va,{dataLength:((Pe=N==null?void 0:N.data)==null?void 0:Pe.length)||0,next:Aa,hasMore:(N==null?void 0:N.last_page)>(N==null?void 0:N.current_page),loader:a.jsx("h4",{children:"Loading..."}),className:"table_inner",children:a.jsx(S,{className:"generic-table add_bulk_item",rowKey:e=>e.id,rowSelection:{...Da},columns:Ia,dataSource:N==null?void 0:N.data,pagination:!1,loading:ma,onRow:e=>({onClick:l=>{l.stopPropagation(),G.find(t=>t===e.id)?(F(G.filter(t=>t!==e.id)),$(o.filter(t=>t.id!==e.id))):(F([...G,e.id]),$([...o,e]))}})})})})}),a.jsx("div",{className:"mb-30 table_outer_container",children:a.jsx(S,{rowKey:e=>e.id,columns:Sa,dataSource:o,pagination:!1,className:"generic-table bulk_items_col_two"})}),a.jsxs("div",{className:"button_flexbox flex-end custom_blocklevel w-100",children:[a.jsx(U,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:he,className:"btn-default btn-form-size cate_cancel_btn"}),a.jsx(U,{btnText:"Save",clickHandler:za,className:"btn-primary btn-form-size"})]})]})]}),a.jsx(Za,{onDragEnd:Fa,children:a.jsx(Oa,{droppableId:"table",direction:"vertical",mode:"standard",type:"row",children:e=>a.jsx(S,{dataSource:i,columns:$a,pagination:!1,rowKey:"key",...e.droppableProps,ref:e.innerRef,components:{body:{row:ms}},children:e.placeholder})})}),a.jsxs("div",{className:`bill_box ${b?"justify_end":"justify_between"}`,children:[!b&&a.jsxs("div",{className:"d-flex align-center self-start",children:[a.jsx(pe,{className:"btn-form-size btn-default mr-10",disabled:!D,onClick:he,children:"Add Bulk items"}),a.jsx(Qa,{isModalOpen:De,handleConfirm:ya,toggleModal:oe,text:Ya.clearLinesConfirm}),a.jsx(pe,{className:"btn-form-size btn-default",disabled:i.length===1,onClick:oe,children:"Clear all lines"})]}),a.jsxs("div",{className:"final_payment",children:[a.jsxs("div",{className:"d-flex align-center justify_between",children:[a.jsx(R.Title,{level:5,children:"Sub Total:"}),a.jsx(V,{value:be,className:"no-space",prefix:g,precision:2})]}),a.jsx("div",{className:"d-flex align-center justify_between",children:le==="item"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"d-flex align-center",children:[a.jsx(R.Title,{level:5,children:"Discount:"}),a.jsx(Je,{placement:"right",title:" This option will show Discount on items",children:a.jsx(Xe,{onClick:Ne,size:16})})]}),a.jsx(V,{className:"no-space",prefix:g,precision:2,value:We(i)})]}):a.jsx(a.Fragment,{children:a.jsxs("div",{style:{display:"flex"},className:"estimate_discount_field",children:[a.jsx(ge.Item,{label:a.jsx(R,{"aria-level":5,children:"Discount:"}),name:"transection_level_discount",colon:!1,className:"shipping_inputbox",children:a.jsx(K,{min:0,stringMode:!0,step:.01,size:"small",precision:2,controls:!1,name:"transection_level_discount",className:"discount_field"})}),a.jsx(ge.Item,{name:"transsection_level_discount_type",colon:!1,children:a.jsxs(H,{className:"discount_dropdown",children:[a.jsx(I,{value:"percent",children:"%"}),a.jsx(I,{value:"amount",children:g})]})})]})})}),a.jsxs("div",{className:"d-flex align-center justify_between",children:[a.jsxs("div",{className:"d-flex align-center",children:[a.jsx(R.Title,{level:5,children:"Tax:"}),a.jsx(Je,{placement:"right",title:" This option will show taxes on items",children:a.jsx(Xe,{onClick:Ne,size:16})})]}),a.jsx(V,{precision:2,prefix:g,className:"no-space",value:ea(i)})]}),a.jsx("div",{className:"d-flex align-center justify_between _1px mb-10",children:a.jsx(ge.Item,{label:a.jsxs(R,{"aria-level":5,children:[we.SHIPPING_CHARGES,":"]}),name:"shipping_charge",colon:!1,className:"shipping_inputbox",children:a.jsx(K,{stringMode:!0,min:0,step:.01,precision:2,controls:!1,name:"shipping_charge",prefix:a.jsx("span",{children:g})})})}),w&&a.jsx("div",{className:"d-flex align-center justify_between _1px",children:a.jsx(ge.Item,{label:a.jsxs(R,{"aria-level":5,children:[we.ADJUSTMENT,":"]}),name:"adjustment",colon:!1,className:"shipping_inputbox no-space",children:a.jsx(K,{stringMode:!0,step:.01,precision:2,controls:!1,name:"adjustment",prefix:a.jsx("span",{children:g})})})}),a.jsxs("div",{className:`d-flex align-center justify_between  ${w?"mb-0":"mb-35 _2px"}`,children:[a.jsx(R.Title,{level:5,children:`${c} Total:`}),a.jsx(V,{className:"no-space",value:Y,prefix:g,precision:2})]}),w&&a.jsx("div",{children:a.jsxs("div",{className:"d-flex align-center justify_between _2px mb-35",children:[a.jsx(R.Title,{level:5,children:"Balance due:"}),a.jsx(V,{className:"no-space",value:Y,prefix:g,precision:2})]})})]})]}),a.jsx(ke,{footer:!1,open:Ae,onCancel:Ne,title:"Tax is applied on the subtotal before discount",wrapClassName:"generic_modal_style",width:1100,centered:!0,children:a.jsx(ds,{isDataSource:i,currency:g})}),a.jsx(es,{taxObj:u,bool:Te,toggle:He,setTaxObj:Ie,has_permission:ha}),a.jsx(ke,{className:"estimate_modal estimate_lg_modal",width:1e3,footer:!1,centered:!0,destroyOnClose:!0,title:"Add Item",style:{top:0},open:qe,onCancel:ve,wrapClassName:"generic_modal_style",bodyStyle:{height:"100%"},children:a.jsx(Wa,{isModal:!0,toggleItemModal:ve,setItemObj:Se,itemObj:y})}),a.jsx(ls,{isModal:!0,bool:Fe,detail:{id:na},toggle:Re})]})},ms=h=>{var x,w,r;return a.jsx(La,{draggableId:h["data-row-key"],index:Number(h["data-row-key"]),isDragDisabled:((r=(w=(x=h==null?void 0:h.children[0])==null?void 0:x.props)==null?void 0:w.record)==null?void 0:r.id)===null,children:C=>a.jsx("tr",{ref:C.innerRef,...C.draggableProps,...C.dragHandleProps,children:Ze.Children.map(h.children,c=>Ze.cloneElement(c,{dragging:C.dragging}))})})};export{vs as I};
