import{F as r,i as bs,G as Ce,r as n,u as gs,U as vs,aD as js,b8 as Se,ai as ps,e as y,j as l,y as ys,M as Ee,a2 as Ns,E as ie,B as R,ao as Cs,az as Ss,b7 as Es,n as u,p as te,aj as Ie,A as Fe,b6 as Is,al as Fs,a0 as ws,b4 as Ts,ak as Vs,T as Os,o as As,l as Ds}from"./index-4b3d7bc8.js";import{I as Bs,A as ks}from"./AddressModal-12b3ae58.js";import zs from"./Create-76ba1395.js";import{C as $s}from"./ContactDetailModal-bc8d3392.js";import{P as Ms}from"./PaginateSelect-b668bdaf.js";import{I as Ls}from"./ItemTable-c0313657.js";const{TextArea:we}=Vs,{Text:Te}=Os,{add_notes:Rs}=te,{INVOICES:Ps}=As,{INVOICE_CONTACTS:Ws,INVOICE_ITEMS:Hs}=Ds,Js=({url:Ve,item:P,close:Us,loading:Oe,onSubmit:W,handleTotal:Ae,toggleModal:H,handleItemList:De,create:ae=!1,isModal:f=!1})=>{var be,ge,ve,je,pe,ye;const[t]=r.useForm(),Be=bs(),{setTrue:ke,setFalse:C}=Ce(!0),[ze,U]=n.useState([]),{callAxios:ne,bool:$e,toggle:oe}=gs(),[_,v]=n.useState(),[p,$]=n.useState(),[N,Z]=n.useState(!1),[q,Me]=n.useState(0),[Le,G]=n.useState(!1),[Re,de]=n.useState(!1),[me,Pe]=n.useState(!1),[b,We]=n.useState(),[ce,He]=n.useState(!1),[Ue,Ze]=n.useState(!1),[_e,qe]=n.useState(!1),{primary_organization:Q,org_date_format:X,TimeZone:Ge}=vs(),{bool:Qe,toggle:re}=Ce(!1),Y=r.useWatch("invoice_terms",t),Xe=r.useWatch("adjustment",t),o=r.useWatch("customer_id",t),J=r.useWatch("invoice_date",t),Ye=r.useWatch("shipping_charge",t),{data:m=[],refetch:Je}=js(""),{handleDate:Ke}=Se((Q==null?void 0:Q.time_zone)||""),{taxList:es,warehouses:ss,sales_person:ls,formLoading:is,details:e,details:{invoice_no:fe,invoice_preference:K}}=ps(Ve),{dateWithOrgTZ:ts}=Se(`${Ge}`),ee=y(ts(y(new Date),X)),as={note:"",terms:null,order_no:"",adjustment:0,reference:"",invoice_no:null,warehouse_id:null,customer_id:null,shipping_charge:0,customer_email:"",invoice_terms:null,due_date:ee,sales_person_id:null,terms_and_condition:"",invoice_date:ee},ns=n.useMemo(()=>m.filter(s=>s.id===Y)[0]||{},[m,Y]),M=Ke(ns.value,J);n.useEffect(()=>{M&&M.isValid()&&t.setFieldsValue({due_date:M})},[M,J]),n.useEffect(()=>{ae&&(t.setFieldsValue({invoice_no:fe}),t.setFieldValue("terms_and_condition",K==null?void 0:K.terms))},[fe,(be=e==null?void 0:e.invoice_preference)==null?void 0:be.terms,m]),n.useEffect(()=>{var s,i,c,x,h,d,a,g,E,I,F,w,T,V,O,A,D,B,k;if(f&&(e!=null&&e.estimates)&&Object.keys(e==null?void 0:e.estimates).length){const L=m==null?void 0:m.find(j=>{var z;return(j==null?void 0:j.value)===((z=e==null?void 0:e.estimates)==null?void 0:z.payment_term_value)});t.setFieldsValue({...e,...e==null?void 0:e.estimates,order_no:(s=e==null?void 0:e.estimates)==null?void 0:s.estimate_no,invoice_date:y((i=e==null?void 0:e.estimates)==null?void 0:i.estimate_date),billing_address_id:(c=e==null?void 0:e.estimates)!=null&&c.billing_address?{id:(h=(x=e==null?void 0:e.estimates)==null?void 0:x.billing_address)==null?void 0:h.id,label:(a=(d=e==null?void 0:e.estimates)==null?void 0:d.billing_address)!=null&&a.attention?(E=(g=e==null?void 0:e.estimates)==null?void 0:g.billing_address)==null?void 0:E.attention:(F=(I=e==null?void 0:e.estimates)==null?void 0:I.billing_address)==null?void 0:F.country_name}:null,customer_id:{id:(T=(w=e==null?void 0:e.estimates)==null?void 0:w.contact)==null?void 0:T.id,label:(O=(V=e==null?void 0:e.estimates)==null?void 0:V.contact)==null?void 0:O.display_name},invoice_terms:L??m.find(j=>j.name==="Net 30")}),v((A=e==null?void 0:e.estimate)==null?void 0:A.billing_address),$((B=(D=e==null?void 0:e.estimate)==null?void 0:D.contact)==null?void 0:B.contact_addresses),U((k=e==null?void 0:e.estimates)==null?void 0:k.estimates_details),C()}},[e==null?void 0:e.estimates,f]),n.useEffect(()=>{var s;f&&(e!=null&&e.sales_order)&&Object.keys(e==null?void 0:e.sales_order).length&&(t.setFieldsValue({...e,...e==null?void 0:e.sales_order,invoice_terms:m.filter(i=>i.name==="Net 30")[0]||{}}),U((s=e==null?void 0:e.sales_order)==null?void 0:s.sales_order_item_details),C())},[e==null?void 0:e.sales_order,f]),n.useEffect(()=>{var s,i,c,x,h,d,a,g,E,I,F,w,T,V,O,A,D,B,k,L,j,z;if(e!=null&&e.invoice_info&&Object.keys(e==null?void 0:e.invoice_info).length){const us=m==null?void 0:m.find(le=>{var Ne;return(le==null?void 0:le.value)===((Ne=e==null?void 0:e.invoice_info)==null?void 0:Ne.invoice_term_value)});t.setFieldsValue({...e.invoice_info,invoice_no:(s=e==null?void 0:e.invoice_info)==null?void 0:s.invoice_no,invoice_date:y((i=e==null?void 0:e.invoice_info)==null?void 0:i.invoice_date),due_date:y((c=e==null?void 0:e.invoice_info)==null?void 0:c.due_date),invoice_terms:us,billing_address_id:(x=e==null?void 0:e.invoice_info)!=null&&x.billing_address?{id:(d=(h=e==null?void 0:e.invoice_info)==null?void 0:h.billing_address)==null?void 0:d.id,label:(g=(a=e==null?void 0:e.invoice_info)==null?void 0:a.billing_address)!=null&&g.attention?(I=(E=e==null?void 0:e.invoice_info)==null?void 0:E.billing_address)==null?void 0:I.attention:(w=(F=e==null?void 0:e.invoice_info)==null?void 0:F.billing_address)==null?void 0:w.country_name}:null,customer_id:{id:(V=(T=e==null?void 0:e.invoice_info)==null?void 0:T.customer)==null?void 0:V.id,label:(A=(O=e==null?void 0:e.invoice_info)==null?void 0:O.customer)==null?void 0:A.display_name},customer_email:(B=(D=e==null?void 0:e.invoice_info)==null?void 0:D.customer)==null?void 0:B.email}),v((k=e==null?void 0:e.invoice_info)==null?void 0:k.billing_address),U((L=e==null?void 0:e.invoice_info)==null?void 0:L.invoice_details),$((z=(j=e==null?void 0:e.invoice_info)==null?void 0:j.customer)==null?void 0:z.contact_addresses),C()}},[e==null?void 0:e.invoice_info,t]),n.useEffect(()=>{Ae(q)},[q]),n.useEffect(()=>{b&&(t.setFieldsValue({customer_id:{id:b==null?void 0:b.id,label:b==null?void 0:b.display_name}}),xe(b))},[b]);const os=m.filter(s=>s.id===Y&&s.label==="Custom")[0]||{},ds=m.filter(({org_id:s})=>s)||[],se=()=>qe(!_e),xe=s=>{s?(oe(),C(),ne({url:`contacts/${s.id}/addresses`}).then(i=>{var c,x,h,d;if(i){$(i);const a=i==null?void 0:i.find(g=>(g==null?void 0:g.address_type)==="billing");a?(v(a),t.setFieldsValue({invoice_terms:s!=null&&s.payment_terms?{id:s==null?void 0:s.payment_terms,label:s==null?void 0:s.payment_term_name,payment_term_value:s==null?void 0:s.payment_term_value,payment_term_name:s==null?void 0:s.payment_term_name}:null,billing_address_id:a!=null&&a.id?{id:a==null?void 0:a.id,label:a!=null&&a.attention?a==null?void 0:a.attention:a==null?void 0:a.country_name}:null,customer_email:s!=null&&s.email?s==null?void 0:s.email:null})):i!=null&&i.length?(v(i[0]),t.setFieldsValue({billing_address_id:{id:(c=i[0])==null?void 0:c.id,label:(x=i[0])!=null&&x.attention?(h=i[0])==null?void 0:h.attention:(d=i[0])==null?void 0:d.country_name}})):(v(null),t.setFieldsValue({billing_address_id:null,customer_email:null}))}})):(v(null),t.setFieldsValue({billing_address_id:null,customer_email:null}))},he=s=>`${s!=null&&s.attention?(s==null?void 0:s.attention)+", ":""}${s!=null&&s.street?(s==null?void 0:s.street)+", ":""}${s!=null&&s.street_2?(s==null?void 0:s.street_2)+",":""}${s!=null&&s.city?(s==null?void 0:s.city)+", ":""}${s!=null&&s.state?(s==null?void 0:s.state)+", ":""}${s!=null&&s.zip_code?(s==null?void 0:s.zip_code)+", ":""}${s!=null&&s.country_name?(s==null?void 0:s.country_name)+", ":""}${s!=null&&s.phone?s==null?void 0:s.phone:""}`,ms=s=>{oe(),ne({method:N?"put":"post",url:N?`/contacts/${(o==null?void 0:o.id)||o}/addresses/${_==null?void 0:_.id}`:`contacts/${(o==null?void 0:o.id)||o}/addresses`,data:{fax:s.bill_fax,city:s.bill_city,state:s.bill_state,phone:s.bill_phone,street:s.bill_street,street_2:s.bill_street_2,zip_code:s.bill_zip_code,attention:s.bill_attention,country_id:s.bill_country_id,address_type:N?s==null?void 0:s.address_type:"additional"}}).then(i=>{var c,x;if(i){const h=(c=i==null?void 0:i.contact_address)==null?void 0:c.find(a=>(a==null?void 0:a.id)===(_==null?void 0:_.id));let d=N?h:(x=i==null?void 0:i.data)==null?void 0:x.at(-1);v(d),S(),Z(!1),G(!1),de(!1),$(N?i==null?void 0:i.contact_address:i==null?void 0:i.data),t.setFieldsValue({billing_address_id:{id:d==null?void 0:d.id,label:d==null?void 0:d.attention}})}})},cs=()=>{S(),Z(!0)},_s=s=>{const i=p==null?void 0:p.find(c=>c.id===s);v(i),t.setFieldsValue({billing_address_id:{id:s,label:i!=null&&i.attention?i==null?void 0:i.attention:i==null?void 0:i.country_name}})},rs=()=>{G(!0),S()},S=()=>Pe(!me),fs=()=>Ze(!Ue),ue=()=>He(!ce),xs=s=>{t.setFieldsValue({invoice_date:s}),s&&s>t.getFieldValue("due_date")&&t.setFieldsValue({due_date:s})},hs=[{key:"1",label:"Save as sent",onClick:()=>W({values:{...t.getFieldsValue(),saveAs:"sent"}})},{key:"2",label:"Save and Email",onClick:()=>W({values:{...t.getFieldsValue(),saveAs:"email"}})}];return l.jsx(l.Fragment,{children:is?l.jsx(ys,{}):l.jsxs("div",{className:"estimate_product_listing",children:[l.jsx(Bs,{refetch:Je,invoice_form:t,org_terms:ds,visible:Qe,toggle:re}),l.jsx($s,{isModal:!0,bool:ce,toggle:ue,detail:typeof o=="object"?o:{id:o}}),l.jsxs(r,{form:t,layout:"vertical",autoComplete:"off",name:"invoice-form",requiredMark:!1,className:"adjust-tbl-main",initialValues:as,onFinish:s=>W({values:s}),children:[l.jsx(Ee,{className:"estimate_modal estimate_md_modal",wrapClassName:"generic_modal_style",width:1e3,centered:!0,title:"Add New Address",open:me,footer:!1,onCancel:S,destroyOnClose:!0,bodyStyle:{height:"100%"},children:l.jsx(ks,{bool:$e,billing:p,editBill:N,onSubmit:ms,loading:Re,createBill:Le,setEditBill:Z,setCreateBill:G,handleCancel:S,setBillLoading:de,url:`contacts/${(o==null?void 0:o.id)||o}/addresses/${_==null?void 0:_.id}`})}),l.jsx(Ee,{wrapClassName:"generic_modal_style",width:1e3,style:{top:0},centered:!0,footer:!1,destroyOnClose:!0,title:"Add Customer",open:_e,onCancel:se,className:"estimate_modal estimate_lg_modal",bodyStyle:{height:"100%"},children:l.jsx(zs,{isModal:!0,setIsCustomerModalOpen:se,isCustomerModalOpen:!0,setIsCustomerId:We})}),l.jsxs("div",{className:"main_wrapper container-1280",children:[!f&&l.jsx(Ns,{name:ae?"Create New Invoice":(ge=e==null?void 0:e.invoice_info)==null?void 0:ge.invoice_no}),l.jsxs("div",{className:"_container",children:[l.jsxs("div",{className:"flexbox form-row-container justify-content-between",children:[l.jsxs("div",{className:"estimate_customer form_group flex-47 ",children:[f?l.jsx(ie,{name:"customer_id",label:l.jsxs("label",{children:["Customer ",l.jsx("span",{className:"staric",children:"*"})]}),disabled:!0}):l.jsx(Ms,{allowClear:!0,size:"large",showButton:!0,setTrue:ke,name:"customer_id",disabled:f,setFalse:C,url:Ws,handleAddNew:se,handleChange:xe,placeholder:"Select or Search Customer",label:l.jsxs("label",{children:["Customer ",l.jsx("span",{className:"staric",children:"*"})]})}),o&&!f&&l.jsx(R,{type:"link",htmlType:"button",btnText:"View details",className:"view_detail",clickHandler:ue})]}),l.jsxs("div",{className:"form_group flex-47",children:[_&&l.jsx(Cs,{className:"edit_bill",onClick:cs}),l.jsx(r.Item,{label:"Billing address",name:"billing_address_id",children:l.jsx(Ss,{size:"large",disabled:!o,onChange:_s,placeholder:"Select billing address",popupClassName:"item_dropdown",options:p==null?void 0:p.map(s=>({label:he(s),value:s.id})),dropdownRender:s=>l.jsxs(l.Fragment,{children:[l.jsx(R,{icon:l.jsx(Es,{size:25}),type:"text",size:"small",btnText:"Add new",clickHandler:rs,className:"btn-form-size btn-primary d-flex justify-center align-center w-100"}),s]})})}),_?he(_):""]}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(r.Item,{name:"customer_email",label:l.jsx("label",{children:"Email"}),children:l.jsx(Te,{children:t.getFieldValue("customer_email")})})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(ie,{showButton:!0,loading:!1,name:"invoice_terms",className:"flex_root",options:m,label:u.PAYMENT_TERMS,handleAddNew:re,placeholder:te.payment_terms})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(Ie,{isRequired:!0,disableDate:s=>s&&s<y(ee).startOf("day"),name:"invoice_date",onChange:xs,format:X,label:l.jsxs("label",{children:[u.INVOICE_DATE," ",l.jsx("span",{className:"staric",children:"*"})]})})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(Ie,{name:"due_date",label:u.DUE_DATE,disabled:!Object.keys(os).length,disableDate:s=>s&&s<y(J).startOf("day"),format:X})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(r.Item,{name:"invoice_no",label:l.jsx("label",{children:u.INVOICE_NO}),children:l.jsx(Te,{children:t.getFieldValue("invoice_no")})})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(Fe,{size:"large",name:"reference",label:u.REFERENCE})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(Fe,{size:"large",name:"order_no",disabled:f,label:u.ORDER_NO,className:"mb flex_root"})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(ie,{loading:!1,className:"flex_root",options:ls,name:"sales_person_id",label:u.SALESPERSON,placeholder:te.select_salesperson})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(r.Item,{label:u.TERMS_AND_CONDITIONS,name:"terms_and_condition",className:"flex_root",children:l.jsx(we,{rows:4,showCount:!0,maxLength:255})})}),l.jsx("div",{className:"form_group flex-47 ",children:l.jsx(r.Item,{label:u.NOTES,name:"note",className:"mb flex_root",children:l.jsx(we,{rows:4,placeholder:Rs})})})]}),l.jsxs(Is,{level:4,className:"form_heading",children:["Select Product/Services"," "]}),l.jsx("div",{className:"generic-table estimate-table",children:l.jsx(Ls,{sales:!0,showButton:!0,taxes:es,current:e,isModal:f,itemList:ze,itemUrl:"/invoices",url:Hs,ModuleName:"Invoice",adjustment:Xe,warehouses:ss,totalAmount:q,customer_id:o,handleAddNew:fs,handleItemList:De,setTotalAmount:Me,shipping_charge:Ye,currency:(ve=e==null?void 0:e.base_currency)==null?void 0:ve.symbol,edit:e&&Object.keys(e).length})}),!e&&l.jsx(Fs,{}),l.jsxs("div",{className:"button_flexbox flex-end ",children:[l.jsx(R,{type:"default",btnText:"Cancel",htmlType:"button",className:"btn-default btn-form-size cate_cancel_btn",clickHandler:()=>f?H==null?void 0:H():Be(Ps)}),l.jsxs("div",{className:"d-flex align-center new_prod_btn",children:[l.jsx(R,{block:!0,loading:Oe,btnText:u.SAVE,disabled:!((je=P[0])!=null&&je.id),className:"btn-primary btn-form-size"}),l.jsx(ws,{placement:"top",trigger:["click"],disabled:!((pe=P[0])!=null&&pe.id),menu:{items:hs},className:"h-36px p-5 icon-radius",children:l.jsx(Ts,{size:25,className:`${(ye=P[0])!=null&&ye.id?"btn-primary":"disabled-svg"}`})})]})]})]})]})]})]})})};export{Js as I};
