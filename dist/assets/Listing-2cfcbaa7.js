import{u as F,U as q,r,j as a,S as E,V as X,W as Y,s as h,aa as v,f as ns,T as S,n as m,I as G,aH as ss,y as os,$ as D,a4 as u,a9 as rs,aI as ls,aJ as es,p as cs,o as as,l as R,h as L,aK as ds,aL as ts,i as is,aM as gs,G as us,aN as hs,aO as xs,J as ps,aP as fs}from"./index-4b3d7bc8.js";import{c as js}from"./capitalize-cfd5966b.js";import{s as $}from"./OrganizationSlice-3f5d7d4c.js";const{Text:O}=S,{SET_AS_DEFAULT:_s}=m,{CgOrganisation:bs,AiOutlineFileImage:ys}=G,ws=({isLoading:l,role:o={},handleClick:e,organizations:j,handleEditClick:d,handleSwitchClick:_,getCurrentSharedOrg:N})=>{const{organization_id:C}=F(),{created_by_platform:b}=q(),g=r.useMemo(()=>[{title:"Name",dataIndex:"organizations",width:160,ellipsis:!0,render:n=>a.jsxs(E,{children:[a.jsx(X,{preview:!1,style:{width:50},src:Y(n==null?void 0:n.logo,b),fallback:"https://cdn-icons-png.flaticon.com/512/456/456283.png",placeholder:a.jsx(ys,{style:{width:36,height:35}})}),a.jsx(O,{children:n==null?void 0:n.name})]})},{title:"Business ID",dataIndex:"organizations",width:90,ellipsis:!0,render:n=>a.jsx(O,{children:n==null?void 0:n.business_id})},{title:"Subscription",dataIndex:"organizations",ellipsis:!0,width:100,render:n=>{var t;return a.jsx(O,{children:(t=n==null?void 0:n.organization_plan)==null?void 0:t.name})}},{title:"Role",dataIndex:"",width:100,ellipsis:!0,render:()=>a.jsx(O,{children:o==null?void 0:o.name})},{title:"Pending Tasks",dataIndex:"",width:75,ellipsis:!0,render:()=>a.jsx(O,{children:"0"})},{title:"Actions",dataIndex:"",width:180,key:"x",align:"center",render:n=>{var t,I,y,w,z,s,x,p,f,i;return a.jsxs(E,{children:[["books","ims,books"].includes(n==null?void 0:n.platform_type)&&((t=n==null?void 0:n.organizations)==null?void 0:t.is_owner)&&!((I=n==null?void 0:n.organizations)!=null&&I.is_default)&&a.jsx(h,{shape:"round",onClick:()=>e(n==null?void 0:n.organization_id),children:_s}),["books","ims,books"].includes(n==null?void 0:n.platform_type)&&((y=n==null?void 0:n.organizations)==null?void 0:y.is_owner)&&((w=n==null?void 0:n.organizations)==null?void 0:w.is_default)&&a.jsx(O,{style:{color:"red"},children:"Default"}),["books","ims,books"].includes(n==null?void 0:n.platform_type)&&((z=n==null?void 0:n.organizations)==null?void 0:z.id)!==+C&&a.jsx(h,{shape:"round",onClick:()=>_(n==null?void 0:n.organization_id),children:"Switch"}),((s=n==null?void 0:n.organizations)==null?void 0:s.platform_type)==="books"&&((x=n.organizations)==null?void 0:x.is_owner)&&a.jsx(h,{shape:"round",onClick:()=>d(n==null?void 0:n.organization_id),children:"Edit"}),(n==null?void 0:n.platform_type)==="ims,books"&&a.jsx(v,{icon:a.jsx(bs,{style:{marginRight:"5px"}}),style:{borderRadius:"10px",padding:"7px"},color:(p=n==null?void 0:n.organizations)!=null&&p.is_owner?"success":"warning",children:"Shared"},"icon"),((f=n==null?void 0:n.organizations)==null?void 0:f.platform_type)==="ims"&&((i=n==null?void 0:n.organizations)==null?void 0:i.is_owner)&&a.jsx(h,{shape:"round",className:"pr-color",onClick:()=>{N(n==null?void 0:n.organizations)},style:{outline:"none"},children:"Share & Switch"},"1")]})}}],[o==null?void 0:o.name,e,C,d,_,N,b]);return a.jsx(ns,{pagination:!1,loading:l,columns:g,dataSource:j})},{Text:zs}=S,{CgOrganisation:ks}=G,{SET_AS_DEFAULT:Ss}=m,{ORGANIZATION_DETAIL:Ns}=as,A=({title:l,value:o})=>a.jsxs(D,{gutter:[10,0],className:"organization-details-list",children:[a.jsx(u,{span:3,children:a.jsx(S.Text,{className:"organization-key",strong:!0,children:l})}),a.jsx(u,{style:{paddingLeft:10,paddingRight:10},children:":"}),a.jsx(u,{span:6,style:{alignSelf:"center"},children:a.jsx(S,{className:"organization-value",children:o})})]}),Cs=({refetch:l,role:o={},organizations:e,handleSwitchClick:j,getCurrentSharedOrg:d})=>{const _=ss(),{organization_id:N}=F(),[C,b]=r.useState(),[g,n]=r.useState(!1),[t,I]=r.useState(!0);r.useEffect(()=>{e.length&&I(!1)},[e]);const y=()=>n(!g),w=()=>{_($({url:`${R.SET_ORGANIZATION}/${C}`,method:"post"})).unwrap().then(s=>{L({message:s.message}),n(!1),l()})},z=s=>{b(s),y()};return a.jsxs(a.Fragment,{children:[t?a.jsx(os,{}):a.jsx("div",{className:"mb-20",children:a.jsx("div",{className:"container-1280",children:a.jsx(D,{gutter:[0,10],justify:"center",children:e==null?void 0:e.map(s=>{var x,p,f,i,T,c,k,B,M,P,U,H,V,Z,W,J,Q,K;return a.jsx(u,{span:24,children:a.jsx(rs,{className:`organization_card radius-5
                    ${(x=s==null?void 0:s.organizations)!=null&&x.is_owner&&((p=s==null?void 0:s.organizations)!=null&&p.is_default)?" default_organization":""}`,children:a.jsxs("div",{className:"organization-card-widget d-flex",children:[a.jsx("div",{className:"organization-img radius-5 border overflow",children:a.jsx(X,{preview:!1,src:(f=s==null?void 0:s.organizations)!=null&&f.logo?Y((i=s==null?void 0:s.organizations)==null?void 0:i.logo,(T=s==null?void 0:s.organizations)==null?void 0:T.created_by_platform):"./img/company_logo.png"})}),a.jsxs("div",{className:"organization-card-widget-right d-flex justify-between flex-1 ml-20",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(S.Title,{level:4,className:"organization-level",children:js(s.organizations.name)}),a.jsx(A,{title:"Business ID",value:(c=s==null?void 0:s.organizations)==null?void 0:c.business_id}),a.jsx(A,{title:"Subscription",value:(B=(k=s==null?void 0:s.organizations)==null?void 0:k.organization_plan)==null?void 0:B.name}),a.jsx(A,{title:"Role",value:`${o.name??""}`}),a.jsx(A,{title:"Pending Tasks",value:"0"}),a.jsxs(D,{className:"mt-20",children:[["books","ims,books"].includes(s==null?void 0:s.platform_type)&&((M=s==null?void 0:s.organizations)==null?void 0:M.id)!==+N&&a.jsx(u,{children:a.jsx(h,{className:"btn-form-size btn-primary mr-20",onClick:()=>j(s==null?void 0:s.organization_id),children:"Switch Business"})}),a.jsxs(u,{children:[((P=s==null?void 0:s.organizations)==null?void 0:P.platform_type)==="ims"&&((U=s==null?void 0:s.organizations)==null?void 0:U.is_owner)&&a.jsx(h,{className:"btn-form-size btn-primary mr-20",onClick:()=>{d(s==null?void 0:s.organizations)},style:{outline:"none"},children:"Share & Switch"},"1"),a.jsx(ls,{to:`${Ns}?org=${s==null?void 0:s.organization_id}`,children:a.jsx(h,{className:" btn-form-size btn-default mr-10",children:"View details"})}),["books","ims,books"].includes(s==null?void 0:s.platform_type)&&((H=s==null?void 0:s.organizations)==null?void 0:H.is_owner)&&!((V=s==null?void 0:s.organizations)!=null&&V.is_default)&&a.jsx(h,{className:"no-border-btn",onClick:()=>z(s==null?void 0:s.organization_id),children:Ss})]}),a.jsx(u,{children:((Z=s==null?void 0:s.organizations)==null?void 0:Z.platform_type)==="ims"&&((W=s==null?void 0:s.organizations)==null?void 0:W.is_owner)&&a.jsx(u,{style:{lineHeight:"36px"},children:a.jsx(zs,{children:"Share this business to books before managing it"})})})]})]}),a.jsxs("div",{className:"d-flex flex-column align-center",children:[["books","ims,books"].includes(s==null?void 0:s.platform_type)&&((J=s==null?void 0:s.organizations)==null?void 0:J.is_owner)&&((Q=s==null?void 0:s.organizations)==null?void 0:Q.is_default)&&a.jsx(v,{className:"set_default mr-0 mb-8",children:"Default"}),(s==null?void 0:s.platform_type)==="ims,books"&&a.jsx(v,{className:"mr-0 mb-8",icon:a.jsx(ks,{}),style:{borderRadius:15,backgroundColor:"#E5EFFC",fontSize:"10px"},color:(K=s==null?void 0:s.organizations)!=null&&K.is_owner?"success":"warning",children:"Shared"},"icon"),a.jsx(v,{className:"mr-0",style:{borderRadius:15,backgroundColor:"gray",fontSize:"10px"},color:"white",children:(s==null?void 0:s.platform_type)==="books"?"Books":"Inventory"},"4")]})]})]})})},s.id)})})})}),a.jsx(es,{isModalOpen:g,toggleModal:y,handleConfirm:w,text:cs.setDefaultConfirm})]})},{VscClose:Is}=G,Os=({item:l,collapsed:o,closeDrawer:e,toggleInnerDrawer:j})=>a.jsx(a.Fragment,{children:a.jsx(ds,{width:350,maskClosable:!!o,contentWrapperStyle:{top:"54px"},bodyStyle:{padding:"10px"},headerStyle:{backgroundColor:"#f3f8fe",borderBottom:"1px solid rgba(0, 0, 0, 0.2)"},title:a.jsxs(E,{style:{display:"flex",alignItems:"inherit",flexDirection:"column",justifyContent:"space-between"},children:[a.jsx(S,{style:{textAlign:"end"},children:a.jsx(Is,{size:25,onClick:e,style:{cursor:"pointer"}})}),a.jsx(D,{gutter:[8,8],children:a.jsx(u,{span:24,children:l.name})})]}),destroyOnClose:!0,placement:"right",closable:!1,onClose:e,open:o,children:a.jsx(ts,{organization:l,toggleInnerDrawer:j})})}),{Title:Ts}=S,{ORGANIZATION_CREATE:As,DASHBOARD:vs}=as,Ls=()=>{const l=is(),{callAxios:o}=F(),[e,j]=r.useState({}),d=ss(),[_,N]=r.useState([]),[,C]=r.useTransition(),{handleUpdateUserWithRoles:b}=q(),[g,n]=r.useState(!1),{data:t=[]}=gs(""),{bool:I}=us(!0),{isLoading:y,data:{organizations:w=[],role:z={}}={},refetch:s}=hs("",{refetchOnFocus:!0,refetchOnMountOrArgChange:!0,refetchOnReconnect:!0});r.useEffect(()=>{N(w)},[w]);const x=r.useCallback(c=>{d($({url:`${R.SET_ORGANIZATION}/${c}`,method:"post"})).unwrap().then(k=>{L({message:k.message}),s()})},[d,s]),p=r.useCallback(c=>{d($({url:`${R.ORGANIZATIONS}/${c}`})).unwrap().then(()=>{L({message:"Organization Switch Successfully"}),d(xs(c)),s(),o({url:R.USER_PROFILE,org:c}).then(k=>{k&&b(k)}),l(vs)})},[d,b]),f=r.useCallback(c=>{l(`/organization-profile?org=${c}`)},[l]),i=r.useCallback(()=>n(!g),[g]),T=r.useCallback(c=>{j({...c,modules:t}),C(()=>{i()})},[t,i]);return a.jsxs(a.Fragment,{children:[g&&a.jsx(Os,{item:e,collapsed:g,closeDrawer:i,toggleInnerDrawer:i}),a.jsx(ps,{className:"generic_top_header",title:a.jsx(Ts,{style:{marginTop:0,marginBottom:0},level:4,children:"Manage Businesses"}),extra:a.jsxs(h,{className:"d-flex align-center btn-primary",onClick:()=>l(`${As}?org=create`),children:[a.jsx(fs,{size:15,className:"mr-5"})," Add New"]},"1")}),!1,I?a.jsx(Cs,{role:z,refetch:s,organizations:_,handleClick:x,handleEditClick:f,handleSwitchClick:p,getCurrentSharedOrg:T}):a.jsx(ws,{role:z,isLoading:y,organizations:_,handleClick:x,handleEditClick:f,handleSwitchClick:p,getCurrentSharedOrg:T})]})};export{Ls as default};
