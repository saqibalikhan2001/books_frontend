import{u as ce,j as e,P as Xs,n as zs,p as Zs,o as es,h as Y,U as Oe,H as $,ae as et,af as Xe,V as Ds,W as Rs,ag as st,T as k,l as C,ah as tt,e as xe,F as T,r as x,ai as nt,y as ss,A as Le,aj as ot,D as Ze,ak as Os,al as at,B as fe,M as ct,am as rt,an as Re,G as Ue,ao as it,ap as He,i as Ke,O as Ns,v as Vs,a3 as Ms,J as lt,aa as dt,a0 as Ls,a1 as Hs,s as ts,aq as mt,ar as _t,as as gs,at as Cs,au as ut,av as ks,aw as ws,ax as Is,E as ht,R as Je,ay as Be,az as xt,aA as ft,a2 as pt,_ as Bs,I as bt,aB as jt,z as Ws,t as vt,w as yt,aC as Nt}from"./index-4b3d7bc8.js";import{A as gt}from"./index-d9b76a87.js";import{A as Ys}from"./AccessDenied-45b92511.js";import{A as qs}from"./ActionMenu-149e95aa.js";import{T as Ct}from"./Table-9972bb2a.js";import{u as Ge}from"./usePermissions-36032956.js";import{P as Us}from"./DetailPage-c0159ae7.js";import{g as kt}from"./calculation-671db1b1.js";import{I as wt}from"./ItemDetailTable-bdf77b6e.js";import{C as Ps}from"./ContactDetailModal-bc8d3392.js";import{c as Ks}from"./capitalize-cfd5966b.js";import{P as It}from"./Processing-a1197381.js";import{R as X,p as ue,q as he,L as Ne,d as Pt,h as Tt,a as St,E as Et}from"./DetailPlusListingHeader-5d7935e9.js";import{P as Ft}from"./PaginateSelect-b668bdaf.js";import{C as Gs,u as At}from"./useCustomPagination-4b61827d.js";import{T as $t,F as zt,R as Dt}from"./ResizealeTable-fbbbae57.js";import{u as Rt}from"./useDetailPageProps-fa80b790.js";import{A as Ot}from"./index-9f4b88aa.js";import"./itemDetailModal-4a763e01.js";import"./DetailPage-51a1d58a.js";import"./ImageCrop-db92a92e.js";import"./react-beautiful-dnd.esm-fdc0d50f.js";const{NEW_INVOICE:Vt}=zs,{all_invoices:Mt}=Zs,{ADD_INVOICE:Lt}=es,Ts=({enable:n=!1,noData:t=!1})=>{const{callAxios:m}=ce(),d=[{key:"1",label:"Export invoices",onClick:()=>{m({method:"post",url:"/invoices/export",data:{filter:"all",starting_date:"",ending_date:""}}).then(_=>{let u="data:text/csv;charset=utf-8,"+_,a=encodeURI(u),f=document.createElement("a");f.setAttribute("href",a),f.setAttribute("download","all_invoices.csv"),document.body.appendChild(f),f.click(),Y({message:"All invoices exported successfully"})})}}];return e.jsx(e.Fragment,{children:e.jsx(Xs.SubHeader,{invoice:!0,show:t,enabled:n,invoiceItems:d,title:Mt,btnText:Vt,navigateTo:Lt})})},Ht=({details:n,attachments:t,handleImage:m,multipleDownloads:o,singleAttachmentDelete:d})=>{const{callAxios:_}=ce(),{Title:u}=k,{created_by_platform:a}=Oe(),f=r=>{_({url:`${C.INVOICES}/${r}/download-attachment`}).then(l=>{const h=document.createElement("a");h.href=l==null?void 0:l.file,h.download=`${l==null?void 0:l.name}.${l==null?void 0:l.type}`,h.click()})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(u,{level:5,children:"Attachments"})}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"myattachement",children:[e.jsx($,{title:"Upload",children:e.jsx(et,{size:20})}),e.jsx("input",{type:"file",name:"myfile",id:"myattachement",onChange:m,style:{display:"none"}})]}),(t==null?void 0:t.length)>0&&e.jsx($,{title:"Download All",children:e.jsx(Xe,{size:18,onClick:o})})]})]}),e.jsx("div",{className:"w-100 attachment_gallery",style:{flexDirection:"row",display:"flex"},children:t==null?void 0:t.map((r,l)=>{var h,v,w;return e.jsxs("div",{className:"attachement_image",children:[e.jsx(Ds,{preview:!1,style:{width:100,height:100},src:["png","jpg","jpeg","webp"].includes(r==null?void 0:r.attachment_type)?Rs(r==null?void 0:r.attachment,a):"https://s3-us-west-2.amazonaws.com/ims-development/static/media/file.png"}),e.jsxs("div",{className:"image_icon_overlay",children:[e.jsx($,{title:"Download",children:e.jsx(Xe,{size:18,onClick:()=>f(r==null?void 0:r.id)})}),((w=(v=(h=n==null?void 0:n.invoice_info)==null?void 0:h.invoice_details[0])==null?void 0:v.item)==null?void 0:w.is_attachment_deletable)&&e.jsx($,{title:"Delete",children:e.jsx(st,{size:20,onClick:()=>d(r==null?void 0:r.id)})})]})]},l)})})]})})},Bt=({details:n})=>{var t;return e.jsx(e.Fragment,{children:e.jsx(tt,{url:`${C.INVOICES}/${(t=n==null?void 0:n.invoice_info)==null?void 0:t.id}/activity-log`})})},Wt=xe(new Date),Yt={note:"",reference:"",payment_no:null,payment_made:null,payment_mode:null,payment_date:Wt},qt=({url:n,loading:t,onSubmit:m,toggleModal:o})=>{var r;const[d]=T.useForm(),[_,u]=x.useState(!0),{details:a,paymentModes:f}=nt(n);return x.useEffect(()=>{var l,h;a!=null&&a.invoice&&Object.keys(a==null?void 0:a.invoice).length&&(d.setFieldsValue({...a==null?void 0:a.invoice,payment_mode:(l=a.payment_methods[0])==null?void 0:l.value,payment_made:(h=a==null?void 0:a.invoice)==null?void 0:h.payment_due}),u(!1))},[a==null?void 0:a.invoice]),_?e.jsx(ss,{}):e.jsx("div",{className:"main_wrapper",children:e.jsx("div",{className:"form_box generic_modal",children:e.jsx(T,{name:"payement-received-form",form:d,layout:"vertical",autoComplete:"off",onFinish:m,initialValues:Yt,children:e.jsxs("div",{className:"flexbox form-row-container justify-content-between mt-18",children:[e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(Le,{size:"middle",name:"total",disabled:!0,label:"Amount",className:"input_field mb flex_root"})}),e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(ot,{isRequired:!0,disableDate:!0,name:"payment_date",label:"Payment Date"})}),e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(Le,{disabled:!0,size:"middle",name:"payment_due",label:"Payment Due",className:"input_field mb flex_root"})}),e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(T.Item,{name:"payment_mode",label:"Payment Mode",className:"input_field flex_root",rules:Ze({message:"Payment Mode is Required!"}),children:e.jsx(gt,{options:f,placeholder:"Select Payment Mode"})})}),e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(Le,{size:"middle",type:"number",name:"payment_made",label:"Payment Received",className:"input_field mb flex_root",max:(r=a==null?void 0:a.invoice)==null?void 0:r.payment_due,rules:Ze({message:"Payment Received Required"})})}),e.jsx("div",{className:"form_group flex-47 mb-30",children:e.jsx(Le,{name:"reference",className:"input_field",size:"middle",label:"Reference"})}),e.jsx("div",{className:"form_group receive_payment_text_area mb-30",children:e.jsx(T.Item,{label:"Customer Notes",name:"note",className:"flex_root",children:e.jsx(Os.TextArea,{rows:3})})}),e.jsx(at,{}),e.jsxs("div",{className:"button_flexbox flex-end form-row-container mb-30",children:[e.jsx(fe,{className:"btn-default btn-form-size mr-20",type:"default",btnText:"Cancel",htmlType:"button",clickHandler:o}),e.jsx(fe,{className:"btn-primary btn-form-size",block:!0,style:{width:"120px"},btnText:"Save",loading:t})]})]})})})})},Ut=({url:n,onSubmit:t,loading:m,showModal:o,toggleModal:d,has_permission:_})=>e.jsx(e.Fragment,{children:e.jsx(ct,{className:"estimate_modal estimate_md_modal",width:1e3,footer:null,destroyOnClose:!0,centered:!0,onOk:d,open:o,style:{top:0},maskClosable:!1,onCancel:d,title:_&&"New Received Payment",wrapClassName:"generic_modal_style",bodyStyle:{height:"100%"},children:_?e.jsx(qt,{url:n,loading:m,onSubmit:t,toggleModal:d}):e.jsx(Ys,{})})}),{INVOICE_PAYMENT_RECEIVED:Kt}=C,Js=({url:n,refetch:t,showModal:m,toggleModal:o,invoice_id:d,has_permission:_,refetchInvoices:u})=>{const{callAxios:a,toggle:f,bool:r}=ce(),l=h=>{f(),a({method:"post",url:Kt,data:{...h,invoice_id:d,payment_date:rt(h.payment_date)}}).then(v=>{v&&(Y({message:v.message}),o(),u(),t())})};return e.jsx(e.Fragment,{children:e.jsx(Ut,{url:n,loading:r,onSubmit:l,showModal:m,toggleModal:o,has_permission:_})})},{Text:Ss}=k,{NAME:Qe,SYMBOL:Gt,DELETE:Jt}=zs,Qt=({url:n,loading:t,fetchList:m,showButton:o,handleConfirm:d,toggleModal:_,has_permission:u})=>{const{org_date_format:a}=Oe(),f=x.useMemo(()=>[{title:"Date",dataIndex:"payment_date",key:Qe,width:50,ellipsis:!0,render:r=>Re(r,a)},{title:"Payment No",dataIndex:"",key:Gt,width:80,ellipsis:!0,render:r=>{var l,h;return e.jsxs(k,{children:[e.jsx($,{placement:"topLeft",title:(l=r==null?void 0:r.currency)==null?void 0:l.name,children:e.jsx(Ss,{children:(h=r==null?void 0:r.currency)==null?void 0:h.symbol})}),`${r.payment_no}`]})}},{title:"Payment Mode",dataIndex:"payment_mode",key:Qe,ellipsis:!0,width:70},{title:"Amount",dataIndex:"",key:Qe,width:50,ellipsis:!0,render:r=>{var l,h;return e.jsxs(k,{children:[e.jsx($,{placement:"topLeft",title:(l=r==null?void 0:r.currency)==null?void 0:l.name,children:e.jsx(Ss,{children:(h=r==null?void 0:r.currency)==null?void 0:h.symbol})}),`${r.payment_made}`]})}},{title:"",dataIndex:"",width:20,key:"x",align:"center",render:r=>e.jsx(qs,{data:r,handleConfirm:d,canEdit:!1,deletePermission:u,title:u?`${Jt} "${r.payment_no}" Payments ?`:"Access Denied"})}],[u]);return e.jsx(e.Fragment,{children:e.jsx(Ct,{url:n,bool:t,rowKey:"payment_no",fetchList:m,columns:f,showButton:o,toggleModal:_})})},{PAYMENT_RECEIVED:Xt,ADVANCE_PAYMENT:Zt,CREATE:en}=C,sn=({url:n,detail:t,refetch:m,fetchList:o,refetchInvoices:d})=>{var I,y,p;const{checkPermission:_}=Ge(),{bool:u,toggle:a}=Ue(),{callAxios:f,bool:r,toggle:l}=ce(),{has_InvoicePaymentRecordCreate_permission:h}=_("InvoicePaymentRecordCreate"),{has_InvoicePaymentRecordDelete_permission:v}=_("InvoicePaymentRecordDelete"),w=D=>{l(),f({method:"delete",url:`${Zt}/${D.payment_no}`}).then(F=>{F&&(Y({message:F.message}),m(),d())})},N=x.useCallback(w,[m,d]);return e.jsxs(e.Fragment,{children:[u&&e.jsx(Js,{showModal:u,refetch:m,toggleModal:a,refetchInvoices:d,invoice_id:(I=t==null?void 0:t.invoice_info)==null?void 0:I.id,has_permission:h,url:`${Xt}${(y=t==null?void 0:t.invoice_info)==null?void 0:y.id}${en}`}),e.jsx(e.Fragment,{children:e.jsx(Qt,{url:n,loading:r,fetchList:o,toggleModal:a,handleConfirm:N,showButton:((p=t==null?void 0:t.invoice_info)==null?void 0:p.status)!=="paid",has_permission:v})})]})},{TextArea:tn}=Os,nn=({details:n})=>{var a,f,r,l,h,v,w,N,I,y,p,D,F,R;const[t]=T.useForm(),{callAxios:m}=ce(),[o,d]=x.useState(!1),_=T.useWatch("notes",t),u=()=>{var s;d(!o),o&&m({url:`${C.INVOICES}/${(s=n==null?void 0:n.invoice_info)==null?void 0:s.id}${C.INVOICES_NOTE}`,method:"put",data:{customer_note:_}}).then(O=>{O&&Y({message:O.message})})};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{details:n,tableData:(a=n==null?void 0:n.invoice_info)==null?void 0:a.invoice_details}),e.jsx("div",{className:"product-details-right ",children:e.jsxs("div",{className:" d-flex justify_between",children:[e.jsxs(T,{form:t,className:"_estimate_term_and_conditions",children:[e.jsxs("div",{children:[e.jsx("div",{className:"product_note",children:e.jsx(k.Title,{level:5,className:"fw-md",children:"Terms & Conditions"})}),e.jsx(k.Text,{className:"text mb-20",children:n==null?void 0:n.terms_and_condition})]}),e.jsxs("div",{className:"product-details-right",children:[e.jsxs("div",{className:"d-flex justify_between align-center",children:[e.jsx(k.Title,{level:5,className:"fw-md",children:"Memo"}),e.jsx(fe,{type:"link",clickHandler:u,btnText:o?"Save":e.jsxs(e.Fragment,{children:[e.jsx(it,{}),e.jsx("span",{children:"Edit"})]}),className:o?"save_btn _btn":"edit_btn _btn"})]}),e.jsx(T.Item,{name:"notes",children:e.jsx(tn,{disabled:!o,showCount:!0,maxLength:255,rows:4,defaultValue:(f=n==null?void 0:n.invoice_info)==null?void 0:f.note})})]})]}),e.jsxs("div",{className:"summary-estimate-sec",children:[e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx(k.Title,{level:5,className:"fw-bold",children:"Sub Total:"}),e.jsx(He,{precision:2,className:"no-space",prefix:(l=(r=n==null?void 0:n.invoice_info)==null?void 0:r.base_currency)==null?void 0:l.symbol,value:kt((h=n==null?void 0:n.invoice_info)==null?void 0:h.invoice_details)||0})]}),e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx(k.Title,{level:5,className:"fw-bold",children:"Shipping:"}),e.jsx(He,{precision:2,className:"no-space",value:((v=n==null?void 0:n.invoice_info)==null?void 0:v.shipping_charge)||0,prefix:(N=(w=n==null?void 0:n.invoice_info)==null?void 0:w.base_currency)==null?void 0:N.symbol})]}),e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx(k.Title,{level:5,className:"fw-bold",children:"Adjusments:"}),e.jsx(He,{precision:2,className:"no-space",value:((I=n==null?void 0:n.invoice_info)==null?void 0:I.adjustment)||0,prefix:(p=(y=n==null?void 0:n.invoice_info)==null?void 0:y.base_currency)==null?void 0:p.symbol})]}),e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx(k.Title,{level:5,className:"fw-bold",children:"Invoice Total:"}),e.jsx(He,{precision:2,className:"no-space",value:(D=n==null?void 0:n.invoice_info)==null?void 0:D.total,prefix:(R=(F=n==null?void 0:n.invoice_info)==null?void 0:F.base_currency)==null?void 0:R.symbol})]})]})]})})]})},{Title:on}=k,{INVOICES:We,SENT:an,PAYMENT_RECEIVED:cn,CREATE:rn}=C,ln=({data:n,detail:t,setparam:m,setFalse:o,handleConfirm:d,refetchInvoices:_})=>{var Ce,ke,we,Ie,Pe,Te,Se,Ee,Fe,Ae,$e,ze,De,i,A,ee,H,me,_e,ns,os,as,cs,rs,is,ls,ds,ms,_s,us,hs,xs,fs,ps,bs,js;const u=Ke(),{callAxios:a}=ce(),[f,r]=x.useState(),{bool:l,setTrue:h}=Ue(),[v,w]=x.useState("1"),[N,I]=x.useState(!1),[y,p]=x.useState(!1),[D,F]=x.useState(!1),{checkPermission:R}=Ge(),[s,O]=x.useState(),g=JSON.parse(Ns("obj")),[M,q]=x.useState([]),[U,K]=x.useState(!1),W=JSON.parse(Ns("email")),{bool:G,setTrue:P}=Ue(),{checkModulePermission:S}=Vs(),{bool:se,toggle:Z}=Ue(),{created_by_platform:pe,org_date_format:te}=Oe(),[J,re]=x.useState(!1),{has_InvoiceEdit_permission:ie}=R("InvoiceEdit"),le=S("invoices"),{has_InvoiceDelete_permission:L}=R("InvoiceDelete"),{has_InvoiceCreate_permission:be}=R("InvoiceCreate"),{has_InvoicePaymentRecordCreate_permission:de}=R("InvoicePaymentRecordCreate");x.useEffect(()=>{I(!!W)},[W]),x.useEffect(()=>{((t==null?void 0:t.id)??(g==null?void 0:g.curr_id))&&(F(!0),a({url:`${We}/${(t==null?void 0:t.id)??(g==null?void 0:g.curr_id)}`}).then(b=>{O(b),q(b.invoice_info.attachments),o==null||o(!1),F(!1)}))},[t==null?void 0:t.id,g==null?void 0:g.curr_id,l]);const ne=()=>I(!N),oe=()=>re(!J),je=()=>{var b;p(!0),a({url:`/invoices/${(b=s==null?void 0:s.invoice_info)==null?void 0:b.id}/pdf?download=true`}).then(j=>{var Q,B;const E=document.createElement("a");E.href=j,E.download=`${(B=(Q=s==null?void 0:s.invoice_info)==null?void 0:Q.customer)==null?void 0:B.display_name} Statement.pdf`,E.click(),p(!1)}).catch(()=>p(!1))},ve=()=>{var b;p(!0),a({url:`/invoices/${(b=s==null?void 0:s.invoice_info)==null?void 0:b.id}/pdf`}).then(j=>{r(j),K(!0),p(!1)}).catch(()=>p(!1))},ae=b=>{var j,E;if(w("4"),b.target.files!==void 0){p(!0);const Q=new FormData;Q.append("subjectId",(j=s==null?void 0:s.invoice_info)==null?void 0:j.id),Q.append("name",(E=s==null?void 0:s.invoice_info)==null?void 0:E.invoice_no),Q.append("files[0]",b.target.files[0]),a({url:"/invoices/attachments",method:"post",data:Q}).then(B=>{p(!1),Y({message:B==null?void 0:B.message}),q([...M,B==null?void 0:B.data[0]]),P()})}},ye=b=>{p(!0),a({url:`${C.INVOICES}${C.ATTACHMENT}/${b}`,method:"delete"}).then(j=>{p(!1),Y({message:j==null?void 0:j.message}),q(M==null?void 0:M.filter(E=>(E==null?void 0:E.id)!==b)),h()})},c=()=>{var b;p(!0),a({url:`${C.INVOICES}/${(b=s==null?void 0:s.invoice_info)==null?void 0:b.id}/download-all`}).then(j=>{const E=document.createElement("a");E.href=j==null?void 0:j.file,E.download=`${j==null?void 0:j.name}.${j==null?void 0:j.type}`,E.click(),p(!1)})},z=x.useCallback(()=>{var b;return a({url:`${We}/${(b=s==null?void 0:s.invoice_info)==null?void 0:b.id}${an}`,method:"put",data:{}}).then(j=>{j&&(Y({message:j.message}),P(),_())})},[s,y]),Ve=()=>{Z()},ge=x.useMemo(()=>{var b;return[{key:"1",label:"Details",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(nn,{details:s})})},{key:"2",label:"Payments",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(sn,{detail:s,refetch:P,fetchList:G,refetchInvoices:_,url:`${We}/${(b=s==null?void 0:s.invoice_info)==null?void 0:b.id}/payments`})})},{key:"4",label:"Attachments",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(Ht,{details:s,attachments:M,handleImage:ae,multipleDownloads:c,singleAttachmentDelete:ye})})},{key:"5",label:"History",children:e.jsx(e.Fragment,{children:s&&Object.keys(s).length>0&&e.jsx(Bt,{details:s})})}]},[s,G,_,y,v]),Me=x.useMemo(()=>{var b,j,E,Q,B,vs,ys;return[{key:"0",label:"Duplicate",onClick:()=>{var V;return u(`/invoice/clone?id=${(V=s==null?void 0:s.invoice_info)==null?void 0:V.id}`)}},{key:"1",label:"Mark as sent",onClick:z,disabled:((b=s==null?void 0:s.invoice_info)==null?void 0:b.status)!=="draft"},{key:"2",label:e.jsx(Ms,{placement:"left",disabled:!(((j=s==null?void 0:s.invoice_info)==null?void 0:j.platform_type)==="books"&&L)||((E=s==null?void 0:s.invoice_info)==null?void 0:E.status)!=="draft",title:`Are you sure you want to delete "${(Q=s==null?void 0:s.invoice_info)==null?void 0:Q.invoice_no}"?`,okText:((B=s==null?void 0:s.invoice_info)==null?void 0:B.platform_type)==="books"&&L?"YES":"OK",cancelText:"No",showCancel:((vs=s==null?void 0:s.invoice_info)==null?void 0:vs.platform_type)==="books"&&L,onCancel:V=>V==null?void 0:V.stopPropagation(),onConfirm:V=>{V==null||V.stopPropagation(),d(s==null?void 0:s.invoice_info,We,P,n,"/invoices",m)},children:e.jsx($,{title:"Delete",children:e.jsx("label",{style:{cursor:((ys=s==null?void 0:s.invoice_info)==null?void 0:ys.platform_type)==="books"&&L?"pointer":"not-allowed",width:"100%",display:"block"},onClick:V=>V==null?void 0:V.stopPropagation(),children:"Delete"})})},"confirm"),disabled:!1}]},[P,s,u,z,d,L,n,m]);return e.jsx(e.Fragment,{children:D?e.jsx(ss,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{animation:"fadeInRight",animationDuration:"0.5s"},children:e.jsx("div",{style:{opacity:y?.5:1,pointerEvents:y?"none":"auto"},children:e.jsx(lt,{className:" __items_details_header __estimate_detials_header",title:(Ce=s==null?void 0:s.invoice_info)==null?void 0:Ce.invoice_no,subTitle:e.jsx(dt,{className:`generic-bagde
                    ${(ke=s==null?void 0:s.invoice_info)!=null&&ke.status&&((we=s==null?void 0:s.invoice_info)==null?void 0:we.status)==="partially paid"?"partially-paid":(Ie=s==null?void 0:s.invoice_info)==null?void 0:Ie.status}`,children:Ks((Pe=s==null?void 0:s.invoice_info)!=null&&Pe.status&&((Te=s==null?void 0:s.invoice_info)==null?void 0:Te.status)==="partially paid"?"PRTL Paid":(Se=s==null?void 0:s.invoice_info)==null?void 0:Se.status)}),extra:[e.jsx(e.Fragment,{children:!N&&e.jsxs(e.Fragment,{children:[e.jsx(Ls.Button,{menu:{items:Me},trigger:["click"],icon:e.jsx(Hs,{}),className:"mr-10 btn-edit",children:e.jsx("div",{style:{cursor:((Ee=s==null?void 0:s.invoice_info)==null?void 0:Ee.status)==="draft"&&ie?"pointer":"not-allowed",width:"100%"},onClick:()=>{var b,j;return((b=s==null?void 0:s.invoice_info)==null?void 0:b.status)==="draft"&&ie?u(`/invoice-edit?id=${(j=s==null?void 0:s.invoice_info)==null?void 0:j.id}`):null},children:"Edit"})}),e.jsx(ts,{type:"primary",onClick:Ve,disabled:(s==null?void 0:s.invoice_info.status)!=="draft"||!(!le&&be),children:"Receive payment"})]})})],footer:e.jsxs(e.Fragment,{children:[!N&&e.jsxs("div",{className:"__estimate_content_side",children:[e.jsxs("div",{className:"_estimate_detial_page",children:[e.jsxs("div",{className:"d-flex mb-30",children:[e.jsx("div",{className:"__customer_image",children:e.jsx(Ds,{className:"customer-dp",preview:!1,src:(Ae=(Fe=s==null?void 0:s.invoice_info)==null?void 0:Fe.customer)!=null&&Ae.photo?Rs((ze=($e=s==null?void 0:s.invoice_info)==null?void 0:$e.customer)==null?void 0:ze.photo,pe):"https://s3-us-west-2.amazonaws.com/ims-development/media/default-user-image-placeholder.svg",placeholder:e.jsx(mt,{style:{width:34,height:34}})})}),e.jsxs("div",{className:"__estimate_detials",children:[e.jsxs("div",{className:"account_receipt d-flex __estimate_receipt",children:[e.jsx($,{placement:"bottom",title:"PDF",children:e.jsx("img",{className:"mr-10",src:"https://s3-us-west-2.amazonaws.com/ims-development/static/media/PDF.svg",alt:"",onClick:je})}),e.jsx($,{placement:"bottom",title:"Print",children:e.jsx("img",{className:"mr-10",src:"https://s3-us-west-2.amazonaws.com/ims-development/static/media/Print.svg",alt:"",onClick:ve})})," ",e.jsx($,{placement:"bottom",title:"Email",children:e.jsx("img",{className:"mr-5",src:"https://ims-development.s3.us-west-2.amazonaws.com/static/media/email.svg",alt:"",onClick:ne})}),e.jsxs("label",{htmlFor:"myattachements",className:"",children:[e.jsx($,{placement:"bottom",title:"Attachment",children:e.jsx(_t,{size:"25px",onClick:ae})}),e.jsx("input",{type:"file",name:"myfile",id:"myattachements",onChange:ae,style:{display:"none"}})]})]}),e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx("span",{className:"fw-md",children:"Reference number:"}),e.jsx("span",{children:(A=(i=(De=s==null?void 0:s.invoice_info)==null?void 0:De.invoice_created_by)==null?void 0:i.users_organizations)==null?void 0:A.license_no})]}),e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx(gs,{size:"18px"}),e.jsx("span",{onClick:oe,className:"_display_name estimates-name cursor",children:(H=(ee=s==null?void 0:s.invoice_info)==null?void 0:ee.customer)==null?void 0:H.display_name})]}),e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx(Cs,{size:"18px"}),e.jsx("span",{className:"_display_name",children:(_e=(me=s==null?void 0:s.invoice_info)==null?void 0:me.customer)==null?void 0:_e.company_name})]})]})]}),e.jsxs("div",{className:"product-details",children:[e.jsx("div",{className:"mb-20",children:e.jsx(on,{level:4,children:"Bill to"})}),e.jsxs("div",{className:"d-flex justify_between",children:[e.jsxs("div",{className:"__estimate_details_left ",children:[e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx(gs,{size:"18px"}),e.jsx("span",{className:"_display_name",children:(os=(ns=s==null?void 0:s.invoice_info)==null?void 0:ns.customer)==null?void 0:os.display_name})]}),e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx(Cs,{size:"18px"}),e.jsx("span",{children:(cs=(as=s==null?void 0:s.invoice_info)==null?void 0:as.customer)==null?void 0:cs.company_name})]}),e.jsxs("div",{className:"mb-20 __customer_info",children:[e.jsx(ut,{size:"18px"}),e.jsx("span",{children:(is=(rs=s==null?void 0:s.invoice_info)==null?void 0:rs.billing_address)==null?void 0:is.country_name})]})]}),e.jsxs("div",{className:"__estimate_details_right ",children:[e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx("span",{className:"fw-md w-102 mr-10",children:"Issue date:"})," ",e.jsx("span",{children:Re((ls=s==null?void 0:s.invoice_info)==null?void 0:ls.created_at,te)})]}),e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx("span",{className:"fw-md w-102  mr-10",children:"Expiry date:"}),e.jsx("span",{children:Re((ds=s==null?void 0:s.invoice_info)==null?void 0:ds.due_date,te)})]}),e.jsxs("div",{className:"__customer_info mb-10",children:[e.jsx("span",{className:"fw-md w-102  mr-10",children:"Payment terms:"}),e.jsx("span",{children:(ms=s==null?void 0:s.invoice_info)==null?void 0:ms.invoice_term_name})]})]})]})]}),y&&e.jsx(It,{})]}),e.jsxs("div",{className:"bg-white",children:[N?e.jsx(ks,{setEmail:I,handleEmail:ne,emailUrl:`${C.INVOICES}/${((_s=s==null?void 0:s.invoice_info)==null?void 0:_s.id)??(g==null?void 0:g.curr_id)}/mail`}):e.jsx(ws,{items:ge,defaultActiveKey:v,onChange:Is,className:"__items-details_container __estimate_tab_container"}),J&&e.jsx(Ps,{isModal:!0,bool:J,toggle:oe,detail:{id:(hs=(us=s==null?void 0:s.invoice_info)==null?void 0:us.customer)==null?void 0:hs.id}})]})]}),e.jsxs("div",{className:"bg-white",children:[N?e.jsx(ks,{setEmail:I,handleEmail:ne,emailUrl:`${C.INVOICES}/${((xs=s==null?void 0:s.invoice_info)==null?void 0:xs.id)??(g==null?void 0:g.curr_id)}/mail`}):e.jsx(ws,{items:ge,defaultActiveKey:v,onChange:Is,className:"__items-details_container __estimate_tab_container"}),J&&e.jsx(Ps,{isModal:!0,bool:J,toggle:oe,detail:{id:(ps=(fs=s==null?void 0:s.invoice_info)==null?void 0:fs.customer)==null?void 0:ps.id}})]})]})})})}),U&&e.jsx(Us,{isModalOpen:U,setIsModalOpen:K,pdf:f}),se&&e.jsx(Js,{refetch:P,showModal:se,toggleModal:Z,refetchInvoices:_,invoice_id:(bs=s==null?void 0:s.invoice_info)==null?void 0:bs.id,has_permission:de,url:`${cn}${(js=s==null?void 0:s.invoice_info)==null?void 0:js.id}${rn}`})]})})},{Text:Ye}=k,dn=(n,t,m,o,d,_,u,a,f,r)=>{var w,N,I,y,p,D,F,R,s,O,g,M,q,U,K,W,G,P,S,se,Z,pe,te,J,re,ie,le,L,be,de,ne,oe,je,ve,ae,ye;const{org_date_format:l}=Oe(),{checkPermission:h}=Ge(),{has_InvoiceDelete_permission:v}=h("InvoiceDelete");return[{Header:"Date",id:"invoice_date",accessor:c=>c,Cell:({value:c})=>e.jsxs("div",{className:"product_info align-center",children:[e.jsxs("div",{className:"product-title",children:[e.jsx(Ye,{children:Re(c==null?void 0:c.invoice_date,l)}),n&&e.jsx("div",{className:"stock_info",children:e.jsxs(Ye,{className:"single_line_name",children:[c==null?void 0:c.display_name," "]})})]}),n&&e.jsx(Ye,{code:!0,className:"center-badge",children:e.jsx("div",{className:c?`generic-bagde ${c!=null&&c.status&&(c==null?void 0:c.status)==="partially paid"?"partially-paid":c==null?void 0:c.status}`:"",children:Ks(c!=null&&c.status&&(c==null?void 0:c.status)==="partially paid"?"PRTL Paid":c==null?void 0:c.status)})})]}),minWidth:120,width:n?322:X("invoice_date",(w=t.table_setting)==null?void 0:w.preferences,(N=t.table_setting)==null?void 0:N.freez_table_width),locked:ue("invoice_date",(I=t.table_setting)==null?void 0:I.preferences),default:!0,sort_order:he("invoice_date",(y=t.table_setting)==null?void 0:y.preferences)},{Header:"",id:"action",resizable:!1,isResizing:!1,disableResizing:!0,getResizerProps:()=>{},defaultResizeableColumn:!1,disableSortBy:!0,accessor:c=>c,disabledSort:!0,width:n?45:X("action",(p=t.table_setting)==null?void 0:p.preferences,(D=t.table_setting)==null?void 0:D.freez_table_width),minWidth:n?45:10,locked:!0,icon:!1,Cell:({value:c})=>e.jsx(qs,{invoice:!0,data:c,sentMark:f,sendEmail:r,showDetail:n,handlePdf:o,handleClick:_,handleClone:m,currentStatus:c==null?void 0:c.status,handleConfirm:u,convertToInvoice:a,canEdit:c.platform_type==="books",deletePermission:c.platform_type==="books"?v:!1,title:c.platform_type==="books"&&v?`Are you sure you want to delete "${c.invoice_no}"?`:"Permission Denied"})},{Header:"Invoice number",accessor:"invoice_no",width:n?0:X("invoice_no",(F=t.table_setting)==null?void 0:F.preferences,(R=t.table_setting)==null?void 0:R.freez_table_width),locked:ue("invoice_no",(s=t.table_setting)==null?void 0:s.preferences),is_lockable:Ne("invoice_no",(O=t.table_setting)==null?void 0:O.preferences),sort_order:he("invoice_no",(g=t.table_setting)==null?void 0:g.preferences)},{Header:"Customer",Cell:({value:c})=>e.jsx("span",{className:"single_line_name",children:c}),accessor:"display_name",width:n?0:X("display_name",(M=t.table_setting)==null?void 0:M.preferences,(q=t.table_setting)==null?void 0:q.freez_table_width),locked:ue("display_name",(U=t.table_setting)==null?void 0:U.preferences),is_lockable:Ne("display_name",(K=t.table_setting)==null?void 0:K.preferences),sort_order:he("display_name",(W=t.table_setting)==null?void 0:W.preferences)},{Header:"Amount",id:"total",accessor:c=>c,width:n?0:X("total",(G=t.table_setting)==null?void 0:G.preferences,(P=t.table_setting)==null?void 0:P.freez_table_width),locked:ue("total",(S=t.table_setting)==null?void 0:S.preferences),is_lockable:Ne("total",(se=t.table_set8ting)==null?void 0:se.preferences),sort_order:he("total",(Z=t.table_setting)==null?void 0:Z.preferences),Cell:({cell:{value:c}})=>{var z;return e.jsx(k,{children:`${(z=c==null?void 0:c.currency)==null?void 0:z.symbol}${c.total.toFixed(2)}`})}},{Header:"Balance",id:"payment_due",accessor:c=>c,width:n?0:X("payment_due",(pe=t.table_setting)==null?void 0:pe.preferences,(te=t.table_setting)==null?void 0:te.freez_table_width),locked:ue("payment_due",(J=t.table_setting)==null?void 0:J.preferences),is_lockable:Ne("payment_due",(re=t.table_set8ting)==null?void 0:re.preferences),sort_order:he("payment_due",(ie=t.table_setting)==null?void 0:ie.preferences),Cell:({cell:{value:c}})=>{var z;return e.jsx(k,{children:`${(z=c==null?void 0:c.currency)==null?void 0:z.symbol}${c.payment_due.toFixed(2)}`})}},{Header:"Status",accessor:"status",width:n?0:X("status",(le=t.table_setting)==null?void 0:le.preferences,(L=t.table_setting)==null?void 0:L.freez_table_width),locked:ue("status",(be=t.table_setting)==null?void 0:be.preferences),is_lockable:Ne("status",(de=t.table_setting)==null?void 0:de.preferences),sort_order:he("status",(ne=t.table_setting)==null?void 0:ne.preferences),Cell:({cell:{value:c}})=>e.jsx("div",{className:`generic-bagde ${c&&c==="partially paid"?"partially-paid":c}`,children:c==="partially paid"?"PRTL Paid":c})},{Header:"Due date",id:"due_date",accessor:c=>c,width:n?0:X("due_date",(oe=t.table_setting)==null?void 0:oe.preferences,(je=t.table_setting)==null?void 0:je.freez_table_width),locked:ue("due_date",(ve=t.table_setting)==null?void 0:ve.preferences),is_lockable:Ne("due_date",(ae=t.table_setting)==null?void 0:ae.preferences),sort_order:he("due_date",(ye=t.table_setting)==null?void 0:ye.preferences),Cell:({value:c})=>e.jsx(Ye,{children:Re(c==null?void 0:c.due_date,l)})}]},mn=({pagination:n,setparam:t,handleSortPopOver:m})=>{const[o]=T.useForm(),d=T.useWatch("sort",o),_=T.useWatch("sort_column",o),[u,a]=x.useState("asc"),f=r=>{a(r.target.value)};return e.jsx("div",{className:"_generic_popupover_main",children:e.jsxs(T,{className:"inner_spacing",form:o,initialValues:{sort:n.sort||"asc",sort_column:n.sort_column||"name"},onFinish:r=>{t({...n,sort:r.sort,sort_column:r==null?void 0:r.sort_column}),m(!1)},style:{maxWidth:600,minWidth:250},children:[e.jsx("div",{className:"form_group  mb-20",children:e.jsx(ht,{label:"",size:"middle",name:"sort_column",className:"adjustment-field",placeholder:"Sort by column",options:[[{id:"estimate_date",label:"Estimate date"}]]})}),e.jsxs("div",{className:"form_group  mb-20",children:[e.jsx("label",{children:"Sort order"}),e.jsx(T.Item,{name:"sort",children:e.jsxs(Je.Group,{value:u,onChange:f,className:"important-block",children:[e.jsx(Je,{value:"asc",className:"block",children:"Ascending"}),e.jsx(Je,{value:"desc",className:"block",children:"Descending"})]})})]}),e.jsx("div",{className:"d-flex  pb-8 justify-center",children:e.jsx(fe,{className:"btn-primary w-96px h-36px",btnText:"Apply",disabled:n.sort===d&&n.sort_column===_})})]})})},_n=[{key:1,value:"custom",label:"Custom"},{key:2,value:"today",label:"Today"},{key:3,value:"yesterday",label:"Yesterday"},{key:4,value:"this_week",label:"This week"},{key:5,value:"this_month",label:"This month"},{key:6,value:"this_qaurter",label:"This Quarter"},{key:7,value:"this_year",label:"This Year"},{key:8,value:"last_week",label:"Last week"},{key:9,value:"last_month",label:"Last month"},{key:10,value:"last_qaurter",label:"Last Quarter"},{key:11,value:"last_year",label:"Last Year"},{key:12,value:"last_365_days",label:"Last 365 days"}],{RangePicker:un}=ft,qe=xe(new Date),{INVOICE_CONTACTS:hn}=C,xn=({form:n,pagination:t,handleOpenChange:m,setparam:o})=>{const{org_date_format:d}=Oe(),_=T.useWatch("date_range",n),u=T.useWatch("custom_ranges",n),a=t.start_range.split(" ")[0]??"",f=t.end_range.split(" ")[0]??"",r=l=>{o({...t,contactId:l.id})};return e.jsx("div",{className:"_generic_popupover_main",children:e.jsxs(T,{form:n,initialValues:{date_range:t.date_range||"today",filter:(t==null?void 0:t.filter)||"all",custom_ranges:t.date_range==="custom"?[xe(t==null?void 0:t.start_range),xe(t==null?void 0:t.end_range)]:[qe,qe]},onFinish:l=>{o({...t,filter:l==null?void 0:l.filter,date_range:l==null?void 0:l.date_range,start_range:l.custom_ranges?`${Be(l.custom_ranges[0])} 00:00:00`:"",end_range:l.custom_ranges?`${Be(l.custom_ranges[1])} 23:59:59`:""}),m(!1)},style:{maxWidth:600},children:[e.jsxs("div",{className:"form_group  mb-20",children:[e.jsx("label",{children:"Date"}),e.jsx(T.Item,{name:"date_range",className:"adjustment-field",children:e.jsx(xt,{size:"middle",options:_n.sort((l,h)=>l.key-h.key)})})]}),_==="custom"&&e.jsxs("div",{className:"form_group  mb-20",children:[e.jsx("label",{children:"Date Range"}),e.jsx(T.Item,{name:"custom_ranges",rules:Ze({message:"Date Range required!"}),children:e.jsx(un,{format:d,separator:e.jsx("label",{children:"-"}),placeholder:[d,d]})})]}),e.jsxs("div",{className:"form_group  mb-20",children:[e.jsx("label",{children:"Customer"}),e.jsx(Ft,{allowClear:!0,showButton:!0,size:"large",required:!1,name:"customer_id",url:hn,handleChange:l=>r(l),placeholder:"Select or Search Customer"})]}),e.jsxs("div",{className:"d-flex _generic_popupover_actions",children:[e.jsx(fe,{className:"btn-default mr-15 w-96px h-36px",type:"text",disabled:!0,clickHandler:()=>{n.setFieldsValue({date_range:"today",filter:"all",custom_ranges:[qe,qe],customer_id:""})},btnText:"Reset"}),e.jsx(fe,{btnText:"Apply",disabled:t.date_range===_&&t.date_range==="custom"&&a===Be(u==null?void 0:u[0])&&t.date_range==="custom"&&f===Be(u==null?void 0:u[1]),className:"btn-primary w-96px h-36px"})]})]})})},{Title:fn}=k,{GoPlus:pn,RiEqualizerFill:Bn}=bt,bn=({form:n,Prev:t,Next:m,refetch:o,popOver:d,listing:_,setparam:u,moduleName:a,navigateTo:f,handlePage:r,pagination:l,sortPopOver:h,handleRowSize:v,selectedProducts:w,handleSortPopOver:N,handleFullScreen:I,handleOpenChange:y})=>{const p=Ke();return e.jsxs("div",{className:"product_detail_pagination",children:[e.jsxs("div",{className:"breadcrumb_row",children:[e.jsx(pt,{name:"",detailPage:!0,refetch:o,moduleName:a,handleFullScreen:I}),e.jsxs("div",{className:"add_btn_outer",children:[e.jsx($,{placement:"bottom",title:"Add new invoice",children:e.jsx(ts,{icon:e.jsx(pn,{}),onClick:()=>p(f)})}),!w.length&&e.jsxs(x.Fragment,{children:[e.jsx($,{placement:"bottom",title:"sort",children:e.jsx(Bs,{title:e.jsx(fn,{className:"text-align",level:5,children:"Sorting"}),trigger:"click",open:h,onOpenChange:N,content:e.jsx(mn,{setparam:u,pagination:l,handleSortPopOver:N}),placement:"bottomRight",overlayClassName:"adjust-filter-main",children:e.jsxs("svg",{className:"sort-icon another-filter",xmlns:"http://www.w3.org/2000/svg",width:"17.831",height:"15.138",viewBox:"0 0 17.831 15.138",children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-path",children:e.jsx("rect",{id:"Rectangle_2085","data-name":"Rectangle 2085",width:"17.831",height:"15.138",fill:"#6e6e6e"})})}),e.jsxs("g",{id:"Group_11160","data-name":"Group 11160",clipPath:"url(#clip-path)",children:[e.jsx("path",{id:"Path_10301","data-name":"Path 10301",d:"M4.982.237a.81.81,0,0,0-1.145,0l-3.6,3.6A.81.81,0,0,0,1.382,4.982L3.6,2.762c0,.018,0,.036,0,.054V14.328a.81.81,0,1,0,1.62,0V2.816c0-.018,0-.036,0-.054l2.22,2.22A.81.81,0,0,0,8.581,3.837Z",transform:"translate(0 0)",fill:"#6e6e6e"}),e.jsx("path",{id:"Path_10302","data-name":"Path 10302",d:"M136.876,10.157a.81.81,0,0,0-1.145,0l-2.22,2.22c0-.018,0-.036,0-.054V.811a.81.81,0,1,0-1.62,0V12.323c0,.018,0,.036,0,.054l-2.22-2.22a.81.81,0,0,0-1.145,1.145l3.6,3.6a.81.81,0,0,0,1.145,0l3.6-3.6a.81.81,0,0,0,0-1.145",transform:"translate(-119.283 -0.001)",fill:"#6e6e6e"})]})]})})}),e.jsx(Qs,{form:n,popOver:d,setparam:u,pagination:l,handleOpenChange:y})]})]})]}),!w.length&&e.jsx(Gs,{Prev:t,Next:m,paginate:l,handlePage:r,className:"pagination_row",handleRowSize:v,totalPages:_.invoices.last_page})]})},Es=({showDetail:n,selectedProducts:t,items:m})=>e.jsxs("div",{className:n?"product-detail-list product_list":"product_list",children:[e.jsxs(k.Title,{className:"selected_product",level:3,children:[t.length," ","Invoices Selected"]}),e.jsx(Ls,{menu:{items:m},trigger:["click"],children:e.jsxs("span",{style:{cursor:"pointer"},children:["Batch Actions ",e.jsx(Hs,{})]})})]}),Qs=({form:n,popOver:t,setparam:m,pagination:o,handleOpenChange:d})=>e.jsx($,{placement:"bottom",title:"Filter",children:e.jsx(Bs,{title:"",open:t,trigger:"click",content:e.jsx(xn,{form:n,setparam:m,pagination:o,handleOpenChange:d}),placement:"bottomRight",onOpenChange:d,overlayClassName:"adjust-filter-main custom-dropdown width_px",children:e.jsx("img",{style:{marginRight:"15px"},src:"https://s3-us-west-2.amazonaws.com/ims-development/static/media/Filter.svg",alt:"",className:"popup-over another-filter"})})}),Fs=({pagination:n,listing:t,setparam:m})=>{const o=d=>{(n==null?void 0:n.filter)===d?m({...n,filter:""}):m({...n,filter:d})};return e.jsxs("div",{className:"filter-top align-center",children:[e.jsxs("div",{className:"filter-badge newBluish_Shade widePerfection cursor",onClick:()=>o("sent"),children:[e.jsx(k.Text,{className:"key",children:t==null?void 0:t.total_sent_invoices_amount}),e.jsxs(k.Text,{className:"value",children:[t==null?void 0:t.total_sent_invoices," Sent"]})]}),e.jsxs("div",{className:"filter-badge newRedish_Shade cursor widePerfection",onClick:()=>o("overdue"),children:[e.jsx(k.Text,{className:"key",children:t==null?void 0:t.total_over_due_invoices_amount}),e.jsxs(k.Text,{className:"value",children:[t==null?void 0:t.total_over_due_invoices," Overdue"]})]}),e.jsxs("div",{className:"filter-badge newgreenish_shade cursor widePerfection",onClick:()=>o("paid"),children:[e.jsx(k.Text,{className:"key",children:t==null?void 0:t.total_paid_invoices_amount}),e.jsxs(k.Text,{className:"value",children:[t==null?void 0:t.total_paid_invoices," Paid"]})]})]})},As=xe(new Date),jn=({Prev:n,Next:t,refetch:m,listing:o,setparam:d,showDetail:_,handlePage:u,pagination:a,handleClick:f,handleRowSize:r,handleConfirm:l,handleViewClick:h,sidebarPosition:v,handleFullScreen:w})=>{var ge,Me,Ce,ke,we,Ie,Pe,Te,Se,Ee,Fe,Ae,$e,ze,De;const[N]=T.useForm(),I=Ke(),{callAxios:y}=ce(),[p,D]=x.useState(),[F,R]=x.useState(!1),[s,O]=x.useState(!1),[g,M]=x.useState(),[q,U]=x.useState(!1),[K,W]=x.useState(!1),[G,P]=x.useState(),[S,se]=x.useState([]),[Z,pe]=x.useState([]),[te,J]=x.useState([]),re=()=>{setTimeout(()=>{R(!F)},2e3)},ie=()=>{d({...a,page:1,filter:"",sort_by:"invoice_date",order_by:"desc",date_range:"",start_range:"",end_range:"",contactId:""})},le=i=>{N.setFieldsValue({filter:a.filter||"all",date_range:a.date_range||"today",custom_ranges:a.date_range==="custom"?[xe(a==null?void 0:a.start_range),xe(a==null?void 0:a.end_range)]:[As,As]}),O(i)},L=i=>pe(i),be=i=>U(i),de=i=>J(i),ne=i=>I(`${es.INVOICE_ClONE}?id=${i==null?void 0:i.id}`),oe=i=>{y({url:`${C.INVOICES}/${i==null?void 0:i.id}/pdf`}).then(A=>{D(A),W(!0)})},je=x.useCallback(i=>y({url:`${C.INVOICES}/${i==null?void 0:i.id}${C.INVOICES}`,method:"post",data:i}).then(A=>{A&&(Y({message:A.message}),m())}),[m]),ve=x.useCallback(i=>y({url:`${C.INVOICES}/${i==null?void 0:i.id}${C.SENT}`,method:"put"}).then(A=>{A&&(Y({message:A.message}),m())}),[m]),ae=()=>{var A;const i=(A=o==null?void 0:o.invoices)==null?void 0:A.data.map(ee=>ee==null?void 0:ee.id);y({method:"post",url:`${C.INVOICES}/exportCurrentView`,data:{ids:i}}).then(ee=>{let H="data:text/csv;charset=utf-8,"+ee,me=encodeURI(H),_e=document.createElement("a");_e.setAttribute("href",me),_e.setAttribute("download","invoices.csv"),document.body.appendChild(_e),_e.click(),Y({message:"Invoices exported successfully"})})},ye=i=>{jt("email",!0),Ws(i==null?void 0:i.id,!0,C.INVOICES),w(!0)},c=i=>{let A={};A={ids:S.map(H=>{var me;return(me=H==null?void 0:H.original)==null?void 0:me.id})},y({method:i==="delete"?"delete":"put",url:i==="delete"?C.INVOICES:`${C.INVOICES}/${i}`,data:A}).then(H=>{Y({message:H==null?void 0:H.message}),m(),i==="delete"&&vt(w)})},z=dn(_,o,ne,oe,()=>null,f,l,je,ve,ye),Ve=[{key:"3",label:e.jsx(Ms,{placement:"left",title:"Are you sure you want to delete selected invoice?",okText:"Yes",cancelText:"No",showCancel:!0,onCancel:i=>i==null?void 0:i.stopPropagation(),onConfirm:i=>{i==null||i.stopPropagation(),c("delete")},children:e.jsx($,{title:"Delete",children:e.jsx("label",{style:{display:"block",width:"100%"},onClick:i=>i==null?void 0:i.stopPropagation(),children:"Delete"})})},"confirm")}];return e.jsxs("div",{className:"item_listing",children:[_&&e.jsx(bn,{form:N,Prev:n,Next:t,refetch:m,popOver:s,listing:o,setparam:d,handlePage:u,pagination:a,moduleName:"Invoices",sortPopOver:q,navigateTo:"/invoice-new",handleRowSize:r,selectedProducts:S,handleSortPopOver:be,handleFullScreen:w,handleOpenChange:le}),S.length>0&&_&&e.jsx(e.Fragment,{children:e.jsx(Es,{items:Ve,showDetail:_,selectedProducts:S})}),S.length>0&&!_&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"custom-filter",children:e.jsx(Fs,{pagination:a,listing:o,setparam:d})}),e.jsx(Es,{items:Ve,showDetail:_,selectedProducts:S})]}),!S.length&&!_&&e.jsxs("div",{className:"custom-filter",children:[e.jsx(Fs,{pagination:a,listing:o,setparam:d}),e.jsxs("div",{className:"filter-bottom",children:[e.jsxs("div",{className:"d-flex",children:[e.jsx(Qs,{form:N,popOver:s,setparam:d,pagination:a,handleOpenChange:le}),((a==null?void 0:a.contactId)||(a==null?void 0:a.date_range)||(a==null?void 0:a.filter))&&e.jsx(ts,{type:"link",className:"d-flex align-items-end clear_filter_btn",onClick:ie,children:"Clear filters"})]}),e.jsxs("div",{className:"d-flex align-center",children:[e.jsx($,{placement:"bottom",title:"Export invoices in current view",children:e.jsx(Xe,{size:18,onClick:ae,className:"downLoad"})}),e.jsx($t,{url:"item",refetch:m,table_slug:"invoices",ColumnhideRef:g,ColumnOrderRef:G,handleSetCheck:re,setcolsheader:L,tableSetting:o.table_setting,colsHeader:Z,preferences:(ge=o.table_setting)==null?void 0:ge.preferences,columns:z.filter(i=>i.locked===!1),column_reset_button:(Me=o==null?void 0:o.table_setting)==null?void 0:Me.column_reset_button,freeze_table_width:(Ce=o.table_setting)==null?void 0:Ce.freez_table_width}),e.jsx(Gs,{Prev:n,Next:t,paginate:a,handlePage:u,className:"pagination_row",handleRowSize:r,totalPages:o.invoices.last_page})]})]})]}),e.jsx("div",{style:{animation:_?"fadeInLeft":"",animationDuration:"0.5s"},className:"my-custom-table",children:e.jsxs("div",{id:"wrapper",className:"item_table",children:[e.jsx("div",{className:"sticky_table",children:e.jsx(zt,{loading:!1,refetch:m,setparam:d,table_slug:"invoices",showDetail:_,pagination:a,ReturnWidth:X,data:(ke=o==null?void 0:o.invoices)==null?void 0:ke.data,total:(we=o==null?void 0:o.invoices)==null?void 0:we.total,handleViewClick:h,sidebarPosition:v,setcolsheader:L,selectedProducts:S,tableSetting:o.table_setting,colsHeader:Z,setSelectedProducts:se,preferences:(Ie=o.table_setting)==null?void 0:Ie.preferences,colsHeaderForlockedCols:te,columns:z.filter(i=>i.locked===!0),handleTableFilterslockedcols:de,detailPageColumns:["selection","invoice_date","action"],defaultFreezTableWidth:Pt((Pe=o.table_setting)==null?void 0:Pe.freez_table_width),actionPref:Tt((Te=o.table_setting)==null?void 0:Te.action_preference,(Se=z.filter(i=>i.locked===!0))==null?void 0:Se.length)})}),!_&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"no_sticky_table",children:e.jsx(Dt,{check:F,refetch:m,loading:!1,setparam:d,table_slug:"invoices",pagination:a,ReturnWidth:X,data:(Ee=o==null?void 0:o.invoices)==null?void 0:Ee.data,handleSetCheck:re,handleViewClick:h,sidebarPosition:v,setcolsheader:L,setColumnHideRef:M,selectedProducts:S,tableSetting:o.table_setting,setColumnOrderRef:P,colsHeader:Z,setSelectedProducts:se,preferences:(Fe=o.table_setting)==null?void 0:Fe.preferences,colsHeaderForlockedCols:te,columns:z==null?void 0:z.filter(i=>i.locked===!1),handleTableFilterslockedcols:de,defaultUnFreezTableWidth:St((Ae=o.table_setting)==null?void 0:Ae.freez_table_width),freeze_table_width:($e=o.table_setting)==null?void 0:$e.freez_table_width,column_reset_button:(ze=o==null?void 0:o.table_setting)==null?void 0:ze.column_reset_button})})})]})}),e.jsx("div",{className:"item_listing_count",children:e.jsxs("p",{children:["Total Invoices : ",(De=o==null?void 0:o.invoices)==null?void 0:De.total]})}),K&&e.jsx(Us,{isModalOpen:K,setIsModalOpen:W,pdf:p})]})},{INVOICES:$s}=C,{EDIT_INVOICE:vn}=es,Wn=()=>{var W,G;const n=Ke(),{bool:t,handleConfirm:m}=ce(),{checkPermission:o}=Ge(),{paginate:d,Prev:_,Next:u,handlePage:a,handleRowSize:f,handlePagination:r}=At("invoices"),{getCurrentModule:l,checkModulePermission:h}=Vs(),{status:v=void 0}=l("invoices")||{},{has_InvoiceView_permission:w}=o("InvoiceView"),N=yt(P=>P.sidebarReducer),{detail:I,setbool:y,fullScreen:p,bool:D,handleFullScreen:F,memoizeHandleClick:R}=Rt(),{data:s,refetch:O,isFetching:g}=Nt({paginate:d,sidebarPosition:N},{refetchOnMountOrArgChange:!0,skip:!w||h("invoices")}),M=P=>{Ws(P==null?void 0:P.id,!0,$s),n(`${vn}?id=${P.id}`)},q=x.useCallback(M,[n]),U=x.useCallback(P=>{var S;return m(P,$s,O,(S=s==null?void 0:s.invoices)==null?void 0:S.data,"/invoices",r)},[m,O,(W=s==null?void 0:s.invoices)==null?void 0:W.data,r]),K=()=>{r({...d,page:1,filter:"",sort_by:"invoice_date",order_by:"desc",search:"",date_range:"",start_range:"",end_range:"",contactId:""})};return e.jsx(e.Fragment,{children:w?e.jsx(e.Fragment,{children:t||g?e.jsx(ss,{}):(s==null?void 0:s.invoices.data.length)>0?e.jsx("div",{className:"product_detail_listing",style:{animation:"slideInLeft",animationDuration:"0.5s"},children:e.jsxs(e.Fragment,{children:[!v&&e.jsx(Ot,{showIcon:!0,type:"info",message:"Module Permissions",description:"Please Enable Module Permissions To See Details"}),!p&&e.jsx(Ts,{enable:!v}),e.jsxs("div",{className:p?"scrollbar_container":"",children:[!D&&e.jsx("div",{className:p?"list":"full_screen",children:(s==null?void 0:s.invoices)&&e.jsx(jn,{Prev:_,Next:u,listing:s,refetch:O,loading:g,pagination:d,showDetail:p,handlePage:a,handleClick:q,setparam:r,handleRowSize:f,handleConfirm:U,sidebarPosition:N,handleFullScreen:F,handleViewClick:R,className:"generic-table item-table"})}),p&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"content_side estimates-content",children:(s==null?void 0:s.invoices)&&e.jsx(ln,{detail:I,loading:D,setFalse:y,refetchInvoices:O,setparam:r,data:(G=s==null?void 0:s.invoices)==null?void 0:G.data,handleConfirm:U})})})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Ts,{enable:!v,noData:!0}),e.jsxs("div",{style:{display:"flex",height:"600px",alignItems:"center",flexDirection:"column",justifyContent:"center"},children:[e.jsx(Et,{}),e.jsx("span",{children:"No data found"}),e.jsx(fe,{type:"link",btnText:"Go Back",clickHandler:K})]})]})}):e.jsx(Ys,{})})};export{Wn as default};
