import{F as l,u as Ae,j as e,M as Ve,S as w,ak as z,B as b,al as j,I as Oe,l as _e,e as G,i as Me,G as L,r,U as ke,b8 as Pe,ai as Le,aD as Ye,$ as d,a4 as i,A as ie,n,D as ne,E as Y,p as R,aj as oe,C as we,T as de,ap as re,bU as ce,o as ze}from"./index-4b3d7bc8.js";import{R as Ge}from"./RepeatModal-0fdc96f9.js";import{P as Ue}from"./PaginateSelect-b668bdaf.js";import{I as qe}from"./ItemTable-c0313657.js";const{INVOICE_TERMS:Be}=_e,{VscAdd:He,MdOutlineRemoveCircleOutline:We}=Oe,$e=({toggle:g,visible:_,refetch:S,org_terms:C})=>{const[D]=l.useForm(),{callAxios:F,bool:v,toggle:c}=Ae(),a=f=>{c(),F({method:"put",url:Be,data:f}).then(p=>{p&&(c(),S())})};return e.jsx(e.Fragment,{children:e.jsx(Ve,{footer:null,destroyOnClose:!0,open:_,onCancel:g,title:"Invoice Terms",maskClosable:!1,children:e.jsxs(l,{form:D,name:"dynamic_form_nest_item",onFinish:a,autoComplete:"off",children:[e.jsx(l.List,{name:"invoice_terms",initialValue:C,children:(f,{add:p,remove:T})=>e.jsxs(e.Fragment,{children:[f.map(({key:A,name:h,...m})=>e.jsxs(w,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(l.Item,{...m,name:[h,"name"],rules:[{required:!0,message:"Name Required"}],children:e.jsx(z,{placeholder:"Enter Term Name"})}),e.jsx(l.Item,{...m,name:[h,"value"],rules:[{required:!0,message:"Value Required"}],children:e.jsx(z,{placeholder:"Enter Value"})}),e.jsx(We,{size:20,onClick:()=>T(h)})]},A)),e.jsx(l.Item,{children:e.jsx(b,{size:"middle",type:"ghost",icon:e.jsx(He,{}),btnText:"Add New",clickHandler:()=>p()})})]})}),e.jsx(j,{}),e.jsxs(w,{className:"steps-action",children:[e.jsx(b,{size:"middle",type:"default",btnText:"Cancel",htmlType:"button",clickHandler:g}),e.jsx(b,{size:"middle",btnText:"Save",loading:v})]})]})})})},{TextArea:me}=z,xe=G(new Date),{RECURRING_INVOICES:Je}=ze,{RECURRING_INVOICE_CONTACTS:Qe,RECURRING_INVOICE_ITEMS:Xe}=_e,Ze={note:"",terms:null,order_no:"",adjustment:0,profile_name:"",customer_id:null,shipping_charge:0,end_date:xe,invoice_terms:null,never_expires:!1,start_date:xe,sales_person_id:null,repeat_duration:null,terms_and_condition:""},ls=({url:g,close:_,loading:S,onSubmit:C,handleTotal:D,handleItemList:F,create:v=!1,isModal:c=!1})=>{var H,W,$,J,Q,X,Z;const[a]=l.useForm(),f=Me(),{bool:p,toggle:T}=L(!1),[A,h]=r.useState(0),{primary_organization:m}=ke(),[fe,pe]=r.useState([]),[V,he]=r.useState(0),{bool:ue,setTrue:je,setFalse:U}=L(!0),{bool:be,toggle:q}=L(!1),{handleDate:ge}=Pe((m==null?void 0:m.time_zone)||""),{taxList:ve,warehouses:Te,sales_person:Ne,repeat_duration:o,details:s}=Le(g),{data:x=[],refetch:ye}=Ye(""),B=l.useWatch("invoice_terms",a),N=l.useWatch("never_expires",a),O=r.useMemo(()=>x.filter(t=>t.id===B)[0]||{},[x,B]),M=a.getFieldValue("start_date"),y=ge(O.value,M),Ee=x.filter(({org_id:t})=>t)||[],Ie=l.useWatch("adjustment",a),Re=l.useWatch("shipping_charge",a),Se=t=>{const E=o==null?void 0:o.find(I=>I.id===t);a.setFieldsValue({repeat_duration:E})};r.useEffect(()=>{var t,E,I,K,ee,se,ae,te,le;if(s!=null&&s.invoice_info&&Object.keys(s==null?void 0:s.invoice_info).length){let k;/\d/.test((t=s==null?void 0:s.invoice_info)==null?void 0:t.repeat_duration)?k=((E=s==null?void 0:s.invoice_info)==null?void 0:E.repeat_duration.split(" ")[0])+" "+((I=o==null?void 0:o.find(P=>{var u;return P.value===((u=s==null?void 0:s.invoice_info)==null?void 0:u.repeat_duration.split(" ")[1])}))==null?void 0:I.label):k=(K=o==null?void 0:o.find(P=>{var u;return P.value===((u=s==null?void 0:s.invoice_info)==null?void 0:u.repeat_duration)}))==null?void 0:K.label,a.setFieldsValue({...s.invoice_info,repeat_duration:k,invoice_terms:(ee=s==null?void 0:s.invoice_info)==null?void 0:ee.invoice_term_id,never_expires:!((se=s==null?void 0:s.invoice_info)!=null&&se.end_date),start_date:G((ae=s==null?void 0:s.invoice_info)==null?void 0:ae.start_date,"YYYY-MM-DD"),end_date:G((te=s==null?void 0:s.invoice_info)==null?void 0:te.end_date,"YYYY-MM-DD")}),pe((le=s==null?void 0:s.invoice_info)==null?void 0:le.invoice_details),U()}},[s==null?void 0:s.invoice_info,a]),r.useEffect(()=>{y&&y.isValid()&&a.setFieldsValue({end_date:y}),N?a.setFieldsValue({end_date:null}):!N&&!O.value&&a.setFieldsValue({end_date:M})},[y,O,M]),r.useEffect(()=>{v&&a.setFieldsValue({invoice_terms:x.filter(t=>t.name==="Net 30")[0]||{}})},[v,x]),r.useEffect(()=>{D(V)},[V]);const Ce=r.useCallback(t=>h(t),[]),De=()=>T(),Fe=t=>{a.setFieldsValue({start_date:t}),t&&t>a.getFieldValue("end_date")&&a.setFieldsValue({end_date:t})};return e.jsxs(e.Fragment,{children:[e.jsx($e,{visible:p,toggle:T,refetch:ye,org_terms:Ee}),e.jsx(Ge,{form:a,visible:be,toggle:q,repeat_duration:o}),e.jsxs(l,{form:a,layout:"vertical",autoComplete:"off",onFinish:C,name:"invoice-form",initialValues:Ze,children:[e.jsx(d,{children:e.jsx(i,{span:8,offset:1,children:e.jsx(Ue,{setTrue:je,name:"customer_id",setFalse:U,label:"Customer Name",url:Qe,placeholder:"Select or Search Customer"})})}),e.jsxs("div",{className:ue?"hide":"display",children:[e.jsxs(d,{children:[e.jsxs(i,{span:6,offset:1,children:[e.jsx(ie,{size:"middle",name:"profile_name",className:"mb flex_root",label:n.PROFILE_NAME,rules:ne({message:"Profile Name Required"})}),e.jsx(Y,{repeat_opt:!0,className:"flex_root",name:"repeat_duration",label:n.REPEAT_EVERY,placeholder:R.duration,options:o||[],handleToggle:q,handleChange:Se,rules:ne({message:"Repeat Duration Required"})})]}),e.jsxs(i,{span:6,offset:1,children:[e.jsx(ie,{size:"middle",name:"order_no",disabled:c,label:n.ORDER_NO,className:"mb flex_root"}),e.jsx(Y,{create_opt:!0,name:"invoice_terms",options:x||[],className:"flex_root",disabled:N,handleToggle:De,label:n.PAYMENT_TERMS,placeholder:R.select_terms})]})]}),e.jsxs(d,{children:[e.jsx(i,{span:6,offset:1,children:e.jsx(oe,{disableDate:!0,name:"start_date",label:n.START_ON,onChange:Fe})}),e.jsx(i,{span:6,offset:1,children:e.jsx(oe,{name:"end_date",label:n.END_DATE,disabled:N})}),e.jsx(i,{style:{paddingTop:35,paddingLeft:10},children:e.jsx(l.Item,{name:"never_expires",valuePropName:"checked",noStyle:!0,children:e.jsx(we,{children:"Never Expires"})})})]}),e.jsx(d,{children:e.jsx(i,{span:6,offset:1,children:e.jsx(Y,{loading:!1,className:"flex_root",options:Ne,name:"sales_person_id",label:n.SALESPERSON,placeholder:R.select_salesperson})})}),e.jsx(qe,{sales:!0,taxes:ve,isModal:c,itemList:fe,adjustment:Ie,warehouses:Te,url:Xe,handleSubTotal:Ce,handleItemList:F,setTotalAmount:he,shipping_charge:Re,currency:(H=s==null?void 0:s.base_currency)==null?void 0:H.symbol,edit:s&&Object.keys(s).length}),e.jsx(j,{}),e.jsxs(d,{children:[e.jsx(i,{span:8,offset:1,children:e.jsx(l.Item,{label:n.NOTES,name:"note",className:"mb flex_root",children:e.jsx(me,{rows:1})})}),e.jsxs(i,{span:8,offset:4,children:[e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(de.Title,{level:5,style:{marginTop:8},children:"Sub Total"})}),e.jsx(i,{offset:14,children:e.jsx(re,{value:A,prefix:(W=s==null?void 0:s.base_currency)==null?void 0:W.symbol})})]}),e.jsx(d,{children:e.jsx(i,{children:e.jsx(l.Item,{label:n.ADJUSTMENT,name:"adjustment",colon:!1,children:e.jsx(ce,{name:"adjustment",addonAfter:($=s==null?void 0:s.base_currency)==null?void 0:$.symbol,placeholder:`${(J=s==null?void 0:s.base_currency)==null?void 0:J.symbol}0.00`})})})}),e.jsx(d,{children:e.jsx(i,{children:e.jsx(l.Item,{label:n.SHIPPING_CHARGES,name:"shipping_charge",colon:!1,children:e.jsx(ce,{min:0,name:"shipping_charge",addonAfter:(Q=s==null?void 0:s.base_currency)==null?void 0:Q.symbol,placeholder:`${(X=s==null?void 0:s.base_currency)==null?void 0:X.symbol}0.00`})})})})]})]}),e.jsx(j,{}),e.jsxs(d,{children:[e.jsx(i,{offset:13,children:e.jsx(de.Title,{level:4,style:{marginTop:0},children:"Total"})}),e.jsx(i,{offset:5,children:e.jsx(re,{value:V,prefix:(Z=s==null?void 0:s.base_currency)==null?void 0:Z.symbol})})]}),e.jsx(j,{}),e.jsx(d,{children:e.jsx(i,{span:10,offset:1,children:e.jsx(l.Item,{label:n.TERMS_AND_CONDITIONS,name:"terms_and_condition",className:"flex_root",children:e.jsx(me,{rows:4,name:"terms_and_condition",placeholder:R.terms_and_conditions})})})}),e.jsx(j,{}),e.jsxs(w,{className:c?"steps-action":"",style:{paddingLeft:"46px"},children:[e.jsx(b,{btnText:s!=null&&s.invoice_info&&Object.keys(s==null?void 0:s.invoice_info).length?n.UPDATE:n.CREATE,style:{width:"120px"},loading:S,block:!0}),e.jsx(b,{type:"default",btnText:"Cancel",htmlType:"button",clickHandler:()=>c?_==null?void 0:_():f(Je)})]})]})]})]})};export{ls as R};
